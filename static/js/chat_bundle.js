/*! For license information please see chat_bundle.js.LICENSE.txt */
(()=>{"use strict";var e={679:(e,t,n)=>{n.d(t,{_:()=>c});var r=n(655),o=new WeakMap,i=new WeakMap,s=function(){function e(){this.onabort=null,o.set(this,[]),i.set(this,!1)}return Object.defineProperty(e.prototype,"aborted",{get:function(){if(!i.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");return i.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"none",{get:function(){return new e},enumerable:!1,configurable:!0}),e.prototype.addEventListener=function(e,t){if(!o.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");o.get(this).push(t)},e.prototype.removeEventListener=function(e,t){if(!o.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");var n=o.get(this),r=n.indexOf(t);r>-1&&n.splice(r,1)},e.prototype.dispatchEvent=function(e){throw new Error("This is a stub dispatchEvent implementation that should not be used.  It only exists for type-checking purposes.")},e}();function a(e){if(!e.aborted){e.onabort&&e.onabort.call(e);var t=o.get(e);t&&t.slice().forEach((function(t){t.call(e,{type:"abort"})})),i.set(e,!0)}}var c=function(e){function t(t){var n=e.call(this,t)||this;return n.name="AbortError",n}return(0,r.ZT)(t,e),t}(Error);!function(){function e(e){var t=this;if(this._signal=new s,e){Array.isArray(e)||(e=arguments);for(var n=0,r=e;n<r.length;n++){var o=r[n];o.aborted?this.abort():o.addEventListener("abort",(function(){t.abort()}))}}}Object.defineProperty(e.prototype,"signal",{get:function(){return this._signal},enumerable:!1,configurable:!0}),e.prototype.abort=function(){a(this._signal)},e.timeout=function(e){var t=new s,n=setTimeout(a,e,t);return"function"==typeof n.unref&&n.unref(),t}}()},181:(e,t,n)=>{var r,o=(r=n(696))&&"object"==typeof r&&"default"in r?r.default:r,i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{};function s(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function a(e,t){return e(t={exports:{}},t.exports),t.exports}var c=a((function(e,t){e.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.fetchWithTimeout=function(e,t){var n,r=new Promise((function(t,r){fetch(e).then((function(e){clearTimeout(n),t(e)})).catch((function(e){clearTimeout(n),r(e)}))}));if(0!==t){var o=new Promise((function(r,o){n=setTimeout(o,t,new Error("Fetch for '"+e.url+"' timed out"))}));return Promise.race([r,o])}return r},t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type "+typeof e}};var r=function(){function e(){this.start=Date.now()}return Object.defineProperty(e.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.start},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=r},function(e,t,n){var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),a=function(e){function t(t){var n=e.call(this,t)||this;return n.name="CancelationError",n}return r(t,e),t}(Error),c=function(){function e(t,n,r){this.logger=t,this.maxBackoffInMs=n,this.initialDelay=r,this.backoffCount=0,this.id=++e.idCounter}return e.prototype.delay=function(e){var t=this;if(void 0!==this.timerHandle)throw new Error("Retry sequence logical failure");if(-1===this.backoffCount)return new Promise((function(e,t){t(new a("Cancelled"))}));var n=this.calculateNextBackoffMs();return this.backoffCount++,this.logger.info("[RegistrarClient] Backing off "+e+" for "+n+" milliseconds with ID "+this.id),new Promise((function(r,o){t.cancelFunc=o,t.timerHandle=setTimeout((function(){t.logger.info("[RegistrarClient] Back off for "+e+" with ID "+t.id+" complete"),t.timerHandle=void 0,r()}),n)}))},e.prototype.cancel=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),void 0!==this.cancelFunc&&this.cancelFunc(new a("Cancelled"))),this.backoffCount=-1},e.prototype.calculateNextBackoffMs=function(){var e=1+.4*(Math.random()-.5),t=this.initialDelay*Math.pow(2,this.backoffCount)*e;return t=Math.round(t),Math.min(this.maxBackoffInMs,t)},e.idCounter=0,e}(),u=function(){function e(e,t,n){this.logger=e,this.skypeTokenProvider=t,this.options=n,this.backoffs={}}return e.prototype.setTelemetryLogger=function(e){this.eventLogger=e},e.prototype.register=function(e,t){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.performRegistration(e,t,"pr_set_registration")];case 1:return n.sent(),this.cachedRegistrationParams=[e,t],[2]}}))}))},e.prototype.unregister=function(){return o(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this.logger.info("[RegistrarClient] sending unregister request"),e=new Request(this.options.registrarUrl+"/"+this.options.registrationId,{method:"DELETE",mode:"cors",headers:new Headers({accept:"application/json, text/javascript"})}),[4,this.callRegistrar(e,"pr_delete_registration")];case 1:return t.sent(),[2]}}))}))},e.prototype.cancelPendingRequests=function(){var e=this;Object.keys(this.backoffs).forEach((function(t){e.backoffs[t].cancel()})),this.backoffs={}},e.prototype.resendRegistration=function(){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:if(!this.cachedRegistrationParams)throw new Error("Re-registration failed because there is no registration parameters cached");return[4,this.performRegistration(this.cachedRegistrationParams[0],this.cachedRegistrationParams[1],"pr_resend_registration")];case 1:return e.sent(),[2]}}))}))},e.prototype.performRegistration=function(e,t,n){return o(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return this.logger.info("[RegistrarClient] Sending register request"),r={clientDescription:e,registrationId:this.options.registrationId,nodeId:"",transports:t},o=new Request(this.options.registrarUrl,{method:"POST",mode:"cors",headers:new Headers({"content-type":"application/json",accept:"application/json, text/javascript"}),body:s.toJson(r)}),[4,this.callRegistrar(o,n)];case 1:return i.sent(),[2]}}))}))},e.prototype.startBackoff=function(){var e=new c(this.logger,this.options.maxRetryDelayMs,this.options.initialRetryDelayMs);return this.backoffs[e.id]=e,e},e.prototype.stopBackoff=function(e){e.cancel(),delete this.backoffs[e.id]},e.prototype.getSkypeToken=function(){return o(this,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:e=this.startBackoff(),r.label=1;case 1:return r.trys.push([1,3,,8]),this.logger.info("[RegistrarClient] Asking for a new skypetoken"),[4,this.skypeTokenProvider(!0)];case 2:return t=r.sent(),this.stopBackoff(e),[2,t];case 3:r.sent(),r.label=4;case 4:return r.trys.push([4,6,,7]),[4,e.delay("Fetching a new skypetoken")];case 5:return r.sent(),[3,8];case 6:throw n=r.sent(),this.stopBackoff(e),n;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}}))}))},e.prototype.callRegistrar=function(e,t){return o(this,void 0,void 0,(function(){var n,r,o,a,c,u,l,d,p,h,f,m,g;return i(this,(function(i){switch(i.label){case 0:return n=this.startBackoff(),[4,this.skypeTokenProvider(!1)];case 1:r=i.sent(),this.setSkypeTokenHeader(e,r),o=new s.Timespan,i.label=2;case 2:a=void 0,i.label=3;case 3:return i.trys.push([3,8,13,14]),c=e.clone(),[4,s.fetchWithTimeout(c,this.options.requestTimeoutMs)];case 4:return 401!==(a=i.sent()).status?[3,6]:(u=this.setSkypeTokenHeader,l=[e],[4,this.getSkypeToken()]);case 5:return u.apply(this,l.concat([i.sent()])),[3,20];case 6:if(a.status>=500&&a.status<600)throw new Error("Fetch for '"+e.url+"' failed with "+a.status+" "+a.statusText);i.label=7;case 7:return[3,14];case 8:d=i.sent(),this.logger.error("[RegistrarClient] Request failed with "+d),i.label=9;case 9:return i.trys.push([9,11,,12]),[4,n.delay("Registrar call retry")];case 10:return i.sent(),[3,20];case 11:throw p=i.sent(),this.logger.error("[RegistrarClient] Request cancelled"),this.stopBackoff(n),p;case 12:return[3,14];case 13:return this.sendTelemetryEvent(t,e,a,o),[7];case 14:return this.stopBackoff(n),a.ok?[2,a]:[3,15];case 15:h=void 0,i.label=16;case 16:return i.trys.push([16,18,,19]),m=(f=JSON).stringify,[4,a.json()];case 17:return h=m.apply(f,[i.sent()]),[3,19];case 18:return i.sent(),h="no details",[3,19];case 19:throw g="Fetch for '"+e.url+"' failed with "+a.status+" "+a.statusText+" ("+h+", MS-CV: "+a.headers.get("MS-CV")+")",this.logger.error("[RegistrarClient] "+g),new Error(g);case 20:return[3,2];case 21:return[2]}}))}))},e.prototype.setSkypeTokenHeader=function(e,t){e.headers.set("X-Skypetoken",t)},e.prototype.sendTelemetryEvent=function(e,t,n,r){if(void 0!==this.eventLogger){var o={name:e,properties:{url:{value:t.url},result_code:{value:void 0!==n?n.status:0},begin_timestamp:{value:r.startTime},elapsed:{value:r.duration}}};this.eventLogger.logEvent(o)}},e}();t.RegistrarClient=u,t.createRegistrarClient=function(e,t,n){return new u(e,t,n)}}])}));s(c);var u=a((function(e,t){var n;e.exports=(n=c,function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=17)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.name=e,this.logger=t}return e.prototype.debug=function(e){this.logger.debug("["+this.name+"] "+e)},e.prototype.info=function(e){this.logger.info("["+this.name+"] "+e)},e.prototype.warn=function(e){this.logger.warn("["+this.name+"] "+e)},e.prototype.error=function(e){this.logger.error("["+this.name+"] "+e)},e}();t.Logger=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.constants={TROUTER_INIT:"trouterinit",TROUTER_READY_EVENT:"trouterReadyEvent",TROUTER_READY_TIMEOUT:"trouterReadyTimeout",TROUTER_TOKEN_REQUEST:"trouterTokenRequest",TROUTER_TOKEN_GET_SUCCEEDED:"trouterTokenGetSucceeded",TROUTER_TOKEN_GET_FAILED:"trouterTokenGetFailed",TROUTER_RECONNECTING:"trouterReconnecting",RENEWAL:"renewal",NEW_CONNECTION:"newConnection",ENDPOINT_REGISTRATION_FAILED:"endpointRegistrationFailed"},t.CLIENT_VERSION="2021.48.01.1",t.HANDLED_MESSAGE_ACK=200,t.UNHANDLED_MESSAGE_ACK=404,t.FAILED_MESSAGE_ACK=500},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Unknown=0]="Unknown",e[e.Active=1]="Active",e[e.Inactive=2]="Inactive"}(t.UserActivityState||(t.UserActivityState={}));var r=function(){};t.HttpHeaders=r,function(e){e[e.Unknown=0]="Unknown",e[e.Connected=2]="Connected",e[e.Disconnected=3]="Disconnected",e[e.Switching=9]="Switching"}(t.TrouterState||(t.TrouterState={}))},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.toJson=function(e){try{return JSON.stringify(e)}catch(t){return"Unable to serialize object of type "+typeof e}},t.calculateTtlInSec=function(e){var t=Math.round((new Date).getTime()/1e3);return void 0!==e&&e>t?e-t:0},t.calculateExpireTsInSec=function(e){return Math.round((new Date).getTime()/1e3)+e},t.fetchWithTimeout=function(e,t){return r(this,void 0,void 0,(function(){var n,r,i;return o(this,(function(o){return r=new Promise((function(t,r){fetch(e).then((function(e){clearTimeout(n),t(e)})).catch((function(e){clearTimeout(n),r(e)}))})),0!==t?(i=new Promise((function(r,o){n=setTimeout(o,t,new Error("Fetch for '"+e.url+"' timed out"))})),[2,Promise.race([r,i])]):[2,r]}))}))};var i=function(){function e(e){this.base=void 0!==e?e:this.createCorrelationVectorBase(),this.extension=0}return e.extend=function(t){return new e(t)},e.prototype.increase=function(){this.extension++},e.prototype.value=function(){return this.base+"."+this.extension},e.prototype.createCorrelationVectorBase=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0987654321/+",t="AQgw",n="",r=0;r<21;r++)n+=e.charAt(Math.floor(Math.random()*e.length));return n+t.charAt(Math.floor(Math.random()*t.length))},e}();t.CorrelationVector=i;var s=function(){function e(){this.start=Date.now()}return Object.defineProperty(e.prototype,"duration",{get:function(){return Date.now()-this.start},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.start},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.start=Date.now()},e}();t.Timespan=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),o=function(){function e(e,t,n,r,o,i,s){this.connectionId=e,this.connectedClientId=t,this.domId=n,this.unsecureUrl=r,this.url=o,this.c2cUrlBase=i,this.expirationTsSec=s}return e.prototype.getRemainingTtlInSec=function(){return r.calculateTtlInSec(this.expirationTsSec)},e}();t.ServerState=o,function(e){e[e.Unknown=0]="Unknown",e[e.Modified=1]="Modified",e[e.Snapshot=2]="Snapshot",e[e.Connected=3]="Connected"}(t.UserActivityEventReason||(t.UserActivityEventReason={}))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=function(){function e(e){this.logger=e,this.messageHandlers=[]}return e.prototype.register=function(e){if(this.messageHandlers.some((function(t){return t===e})))throw new Error("Registering the same handler twice is not allowed");this.messageHandlers.push(e)},e.prototype.clear=function(){this.logger.debug("Clearing message handlers"),this.messageHandlers=[]},e.prototype.active=function(){return this.messageHandlers.length>0},e.prototype.handleMessage=function(e){for(var t={resultCode:r.UNHANDLED_MESSAGE_ACK,isHandled:!1},n=0,o=this.messageHandlers;n<o.length;n++){var i=o[n],s=this.safeExecuteHandle(i,e);if(void 0!==s&&(void 0===s.isHandled||s.isHandled))return void 0===s.resultCode&&(s.resultCode=r.HANDLED_MESSAGE_ACK),s}return t},e.prototype.safeExecuteHandle=function(e,t){try{return e.handleMessage(t)}catch(e){return void this.logger.warn("A trouter message handler is throwing exceptions. exception: "+e)}},e}();t.MessageHandlerRegistry=o},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0}),t.addCacheAsBackupTo=function(e){var t,n=this;return function(i){return r(n,void 0,void 0,(function(){return o(this,(function(n){return i&&(t=void 0),[2,new Promise((function(n,r){e(i).then((function(e){t=e,n(e)})).catch((function(e){void 0!==t&&t.length>0&&n(t),r(e)}))}))]}))}))}}},function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),s=n(2),a=n(0),c=n(14),u=n(16),l=function(){function e(e,t){this.state=e,this.correlationVector=void 0!==t?t:i.CorrelationVector.extend()}return e.prototype.getStateString=function(){switch(this.state){case s.UserActivityState.Active:return"active";case s.UserActivityState.Inactive:return"inactive";case s.UserActivityState.Unknown:return"unknown";default:return"undefined"}},e.prototype.toEventObject=function(){return{state:this.getStateString(),cv:this.correlationVector.value()}},e.prototype.toEventJSON=function(){return i.toJson(this.toEventObject())},e}();t.UserActivityObject=l;var d=function(){function e(e,t,n,r){this.logFunc=e,this.options=t,this.tokenProvider=n,this.listener=r,this.logger=new a.Logger("Manager",e),this.logger.info("Created TrouterManager with options "+i.toJson(this.options)),this.fsm=new u.TrouterManagerFsm(e,this),this.baseEndpointUrl="",this.processedMessageLoss={},this.userActivityObject=new l(s.UserActivityState.Unknown)}return e.prototype.start=function(){this.fsm.start()},e.prototype.stop=function(e){this.fsm.stop(e)},e.prototype.configure=function(e){this.options=e,void 0!==this.firstConnection&&this.firstConnection.configure(e),void 0!==this.secondConnection&&this.secondConnection.configure(e),this.logger.info("Reconfigured TrouterManager with options "+i.toJson(this.options))},e.prototype.checkConnection=function(e){void 0!==this.firstConnection&&this.firstConnection.checkConnection(e),void 0!==this.secondConnection&&this.secondConnection.checkConnection(e)},e.prototype.resendRegistration=function(){return r(this,void 0,void 0,(function(){return o(this,(function(e){return void 0!==this.secondConnection?(this.logger.info("Resending registration on the second/new connection"),[2,this.secondConnection.resendRegistration()]):void 0!==this.firstConnection?(this.logger.info("Resending registration on the first/current connection"),[2,this.firstConnection.resendRegistration()]):(this.logger.info("No connection to resend registration on, will be done upon (re)connect"),[2])}))}))},e.prototype.getServerState=function(){if(void 0!==this.firstConnection)return this.firstConnection.getServerState()},e.prototype.getState=function(){return this.fsm.getState()},e.prototype.startFirstConnection=function(){var e=new c.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider,this.userActivityObject);this.firstConnection=e,this.getConnectionCache().then((function(t){e.start(t)})).catch()},e.prototype.startSecondConnection=function(e){var t=new c.TrouterConnection(this.logFunc,this.options,this,this.tokenProvider,this.userActivityObject);this.secondConnection=t,void 0!==this.firstConnection&&this.firstConnection.disableRegistrationsAndAutoReconnect(),e?this.getConnectionCache().then((function(e){t.start(e)})).catch():t.start()},e.prototype.stopFirstConnection=function(e){void 0!==this.firstConnection&&(this.storedFirstConnection=this.firstConnection,this.firstConnection.stop(e),this.firstConnection=void 0)},e.prototype.stopSecondConnection=function(e){void 0!==this.secondConnection&&(this.secondConnection.stop(e),this.secondConnection=void 0)},e.prototype.stopSecondConnectionDelayed=function(){if(void 0!==this.secondConnection){var e=this.secondConnection;this.secondConnection=void 0,this.logger.info("Closing an inactive connection in "+Math.round(this.options.lingeringConnectionDelayMs/1e3)+"s"),setTimeout((function(){e.stop(!0)}),this.options.lingeringConnectionDelayMs)}},e.prototype.forceStopLingeringConnection=function(){this.storedFirstConnection&&(this.storedFirstConnection.stop(!1),this.storedFirstConnection=void 0)},e.prototype.switchConnections=function(){var e=this.firstConnection;this.firstConnection=this.secondConnection,this.secondConnection=e},e.prototype.doesSecondConnectionExist=function(){return void 0!==this.secondConnection},e.prototype.dispatchConnected=function(){if(void 0!==this.firstConnection){var e=this.firstConnection.getServerState(),t="/"===e.url.slice(-1)?e.url.slice(0,-1):e.url,n={baseEndpointUrl:t,newEndpointUrl:t!==this.baseEndpointUrl,c2cUrlBase:e.c2cUrlBase,clientId:e.connectedClientId,connectionId:e.connectionId,connectionTtlSec:e.getRemainingTtlInSec()};this.baseEndpointUrl=t,this.listener.onTrouterConnected(e.url,n)}},e.prototype.dispatchReconnecting=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.dispatchStopped=function(){this.listener.onTrouterDisconnected&&this.listener.onTrouterDisconnected()},e.prototype.dispatchRegistrationState=function(e){this.options.registrationStateCallback&&this.options.registrationStateCallback(e)},e.prototype.onDownstreamRequest=function(e,t,n){var r={id:t.id,method:t.method,path:"/"+t.shortUrl,body:t.body,headers:t.headers},o={id:t.id,status:0,headers:{},body:"",send:function(){return o.status<=100||o.status>=999?3:(n.writeHead(o.status,o.headers),n.end(o.body))}};this.listener.onTrouterRequest(r,o)},e.prototype.onConnected=function(e){this.fsm.onConnected(e===this.firstConnection)},e.prototype.onRegistered=function(e){this.fsm.onRegistered(e===this.firstConnection)},e.prototype.onUnregistered=function(e){this.fsm.onUnregistered(e===this.firstConnection||e===this.storedFirstConnection)},e.prototype.onReconnecting=function(e){this.fsm.onReconnecting(e===this.firstConnection)},e.prototype.onReconnectIsRequired=function(e,t){this.fsm.onReconnectionRequired(e===this.firstConnection,t)},e.prototype.onDisconnected=function(e){this.fsm.onDisconnected(e===this.storedFirstConnection),this.storedFirstConnection=void 0},e.prototype.onUserActivityStateAccepted=function(e){this.listener.onTrouterUserActivityStateAccepted&&this.listener.onTrouterUserActivityStateAccepted(e)},e.prototype.onConnectionParametersUpdated=function(e){this.setConnectionCache(e)},e.prototype.setUserActivityState=function(e,t){return this.userActivityObject=new l(e,i.CorrelationVector.extend(t)),void 0!==this.secondConnection?(this.logger.info("Setting user activity "+this.userActivityObject.toEventJSON()+" on the second/new connection"),void this.secondConnection.setUserActivityState(this.userActivityObject)):void 0!==this.firstConnection?(this.logger.info("Setting user activity "+this.userActivityObject.toEventJSON()+" on the first/current connection"),void this.firstConnection.setUserActivityState(this.userActivityObject)):void 0},e.prototype.onTrouterMessageLost=function(e){var t=this;if(this.listener.onTrouterMessageLoss)if(e&&e.length){var n=e.filter((function(e){return void 0!==t.processedMessageLoss[e.tag+"-"+e.etag]}));if(n.length&&(this.logger.warn("onTrouterMessageLoss - removing duplicates and sending event to server"),this.sendProcessedDroppedIndicators(n),!(e=e.filter((function(e){return void 0===t.processedMessageLoss[e.tag+"-"+e.etag]}))).length))return void this.logger.warn("onTrouterMessageLoss - All the data are duplicated");if(!this.listener.onTrouterMessageLoss(e.map((function(e){return e.tag}))))return void this.logger.warn("onTrouterMessageLoss - flow tags have not been processed by listeners");e.forEach((function(e){t.processedMessageLoss[e.tag+"-"+e.etag]=""})),this.sendProcessedDroppedIndicators(e)}else this.logger.warn("onTrouterMessageLoss - no flow tags have been provided")},e.prototype.getConnectionCache=function(){var e=this;return this.options.connectionCache?(this.logger.debug("Querying host's connection cache"),this.options.connectionCache.onGetTrouterConnectionCache().then((function(e){return e?JSON.parse(e):void 0})).catch((function(t){return e.logger.warn("Invalid connection cache content provided: "+t),e.connectionCache}))):Promise.resolve(this.connectionCache)},e.prototype.setConnectionCache=function(e){if(this.connectionCache=e,this.options.connectionCache)try{this.options.connectionCache.onSetTrouterConnectionCache(JSON.stringify(e))}catch(e){this.logger.warn("Error setting external connection cache: "+e)}},e.prototype.sendProcessedDroppedIndicators=function(e){return void 0!==this.firstConnection?void this.firstConnection.sendProcessedDroppedIndicators(e):void 0!==this.secondConnection?void this.secondConnection.sendProcessedDroppedIndicators(e):void 0},e}();t.TrouterManager=d},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.logger=e}return e.prototype.getPromise=function(){var e=this;return void 0!==this.url?(this.logger.debug("[TrouterUrlPromise] returning previously resolved url: "+this.url),Promise.resolve(this.url)):(void 0===this.pendingPromise?(this.logger.debug("[TrouterUrlPromise] creating and returning promise"),this.pendingPromise=new Promise((function(t,n){e.pendingPromiseResolveRef=t,e.pendingPromiseRejectRef=n}))):this.logger.debug("[TrouterUrlPromise] returning existing promise"),this.pendingPromise)},e.prototype.resolveUrl=function(e){this.url=e,this.logger.debug("[TrouterUrlPromise] got url: "+this.url);var t=this.pendingPromiseResolveRef;this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("[TrouterUrlPromise] resolving promise"),t(e))},e.prototype.rejectUrl=function(e){this.logger.debug("[TrouterUrlPromise] aborting");var t=this.pendingPromiseRejectRef;this.url=void 0,this.pendingPromise=void 0,this.pendingPromiseResolveRef=void 0,this.pendingPromiseRejectRef=void 0,void 0!==t&&(this.logger.debug("[TrouterUrlPromise] rejecting promise"),t(e))},e.prototype.resetUrl=function(){this.logger.debug("[TrouterUrlPromise] resetting url"),this.url=void 0},e}();t.TrouterUrlPromise=r},function(e,t,n){(function(e,n){!function(e,t){var n=e;n.version="0.9.6",n.protocol=1,n.transports=[],n.j=[],n.sockets={},n.connect=function(e,r){var o,i,s=n.util.parseUri(e);t&&t.location&&(s.protocol=s.protocol||t.location.protocol.slice(0,-1),s.host=s.host||(t.document?t.document.domain:t.location.hostname),s.port=s.port||t.location.port),o=n.util.uniqueUri(s);var a={host:s.host,secure:"https"==s.protocol,port:s.port||("https"==s.protocol?443:80),query:s.query||""};return n.util.merge(a,r),!a["force new connection"]&&n.sockets[o]||(i=new n.Socket(a)),!a["force new connection"]&&i&&(n.sockets[o]=i),(i=i||n.sockets[o]).of(s.path.length>1?s.path:"")}}(n.exports,void 0===e?window:e);var r=n.exports;!function(e,t){var n=e.util={},r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){for(var t=r.exec(e||""),n={},i=14;i--;)n[o[i]]=t[i]||"";return n},n.uniqueUri=function(e){var n=e.protocol,r=e.host,o=e.port;return"document"in t?(r=r||document.domain,o=o||("https"==n&&"https:"!==document.location.protocol?443:document.location.port)):(r=r||"localhost",o||"https"!=n||(o=443)),(n||"http")+"://"+r+":"+(o||80)},n.query=function(e,t){var r=n.chunkQuery(e||""),o=[];for(var i in n.merge(r,n.chunkQuery(t||"")),r)r.hasOwnProperty(i)&&o.push(i+"="+r[i]);return o.length?"?"+o.join("&"):""},n.chunkQuery=function(e){for(var t,n={},r=e.split("&"),o=0,i=r.length;o<i;++o)(t=r[o].split("="))[0]&&(n[t[0]]=t[1]);return n};var i=!1;n.load=function(e){if("document"in t&&"complete"===document.readyState||i)return e();n.on(t,"load",e,!1)},n.on=function(e,t,n,r){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,r)},n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS))return new XMLHttpRequest;if(!e)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}return null},"undefined"!=typeof window&&n.load((function(){i=!0})),n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts)return e();n.load((function(){setTimeout(e,100)}))},n.merge=function(e,t,r,o){var i,s=o||[],a=void 0===r?2:r;for(i in t)t.hasOwnProperty(i)&&n.indexOf(s,i)<0&&("object"==typeof e[i]&&a?n.merge(e[i],t[i],a-1,s):(e[i]=t[i],s.push(t[i])));return e},n.mixin=function(e,t){n.merge(e.prototype,t.prototype)},n.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n},n.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.intersect=function(e,t){for(var r=[],o=e.length>t.length?e:t,i=e.length>t.length?t:e,s=0,a=i.length;s<a;s++)~n.indexOf(o,i[s])&&r.push(i[s]);return r},n.indexOf=function(e,t,n){var r=e.length;for(n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++);return r<=n?-1:n},n.toArray=function(e){for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t},n.ua={},n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(e){return!1}return null!=e.withCredentials}(),n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}(void 0!==r?r:n.exports,void 0===e?window:e),function(e,t){function n(){}e.EventEmitter=n,n.prototype.on=function(e,n){return this.$events||(this.$events={}),this.$events[e]?t.util.isArray(this.$events[e])?this.$events[e].push(n):this.$events[e]=[this.$events[e],n]:this.$events[e]=n,this},n.prototype.addListener=n.prototype.on,n.prototype.once=function(e,t){function n(){r.removeListener(e,n),t.apply(this,arguments)}var r=this;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){for(var o=-1,i=0,s=r.length;i<s;i++)if(r[i]===n||r[i].listener&&r[i].listener===n){o=i;break}if(o<0)return this;r.splice(o,1),r.length||delete this.$events[e]}else(r===n||r.listener&&r.listener===n)&&delete this.$events[e]}return this},n.prototype.removeAllListeners=function(e){return this.$events&&this.$events[e]&&(this.$events[e]=null),this},n.prototype.listeners=function(e){return this.$events||(this.$events={}),this.$events[e]||(this.$events[e]=[]),t.util.isArray(this.$events[e])||(this.$events[e]=[this.$events[e]]),this.$events[e]},n.prototype.emit=function(e){if(!this.$events)return!1;var n=this.$events[e];if(!n)return!1;var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n.apply(this,r);else{if(!t.util.isArray(n))return!1;for(var o=n.slice(),i=0,s=o.length;i<s;i++)o[i].apply(this,r)}return!0}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t){if(t&&t.parse)return e.JSON={parse:t.parse,stringify:t.stringify};throw new Error("JSON not available")}(void 0!==r?r:n.exports,"undefined"!=typeof JSON?JSON:void 0),function(e,t){var n=e.parser={},r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],o=n.reasons=["transport not supported","client not handshaken","unauthorized"],i=n.advice=["reconnect"],s=t.JSON,a=t.util.indexOf;n.encodePacket=function(e){var t=a(r,e.type),n=e.id||"",c=e.endpoint||"",u=e.ack,l=null;switch(e.type){case"error":var d=e.reason?a(o,e.reason):"",p=e.advice?a(i,e.advice):"";""===d&&""===p||(l=d+(""!==p?"+"+p:""));break;case"message":""!==e.data&&(l=e.data);break;case"event":var h={name:e.name};e.args&&e.args.length&&(h.args=e.args),l=s.stringify(h);break;case"json":l=s.stringify(e.data);break;case"connect":e.qs&&(l=e.qs);break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+s.stringify(e.args):"")}var f=[t,n+("data"==u?"+":""),c];return null!=l&&f.push(l),f.join(":")},n.encodePayload=function(e){var t="";if(1==e.length)return e[0];for(var n=0,r=e.length;n<r;n++)t+="�"+e[n].length+"�"+e[n];return t};var c=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){if(!(a=e.match(c)))return{};var t=a[2]||"",n=(e=a[5]||"",{type:r[a[1]],endpoint:a[4]||""});switch(t&&(n.id=t,a[3]?n.ack="data":n.ack=!0),n.type){case"error":var a=e.split("+");n.reason=o[a[0]]||"",n.advice=i[a[1]]||"";break;case"message":n.data=e||"";break;case"event":try{var u=s.parse(e);n.name=u.name,n.args=u.args}catch(e){}n.args=n.args||[];break;case"json":try{n.data=s.parse(e)}catch(e){}break;case"connect":n.qs=e||"";break;case"ack":if((a=e.match(/^([0-9]+)(\+)?(.*)/))&&(n.ackId=a[1],n.args=[],a[3]))try{n.args=a[3]?s.parse(a[3]):[]}catch(e){}break;case"disconnect":n.reason=e}return n},n.decodePayload=function(e){if("�"==e.charAt(0)){for(var t=[],r=1,o="";r<e.length;r++)"�"==e.charAt(r)?(t.push(n.decodePacket(e.substr(r+1).substr(0,o))),r+=Number(o)+1,o=""):o+=e.charAt(r);return t}return[n.decodePacket(e)]}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t){function n(e,t){this.socket=e,this.sessid=t,this.connectErrorCallback=void 0,this.isOpened=!1}e.Transport=n,t.util.mixin(n,t.EventEmitter),n.prototype.onData=function(e){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==e){var n=t.parser.decodePayload(e);if(n&&n.length)for(var r=0,o=n.length;r<o;r++)this.onPacket(n[r])}return this},n.prototype.onPacket=function(e){return this.socket.setHeartbeatTimeout(),"heartbeat"==e.type?this.onHeartbeat():("connect"==e.type&&""==e.endpoint&&this.onConnect(),"error"==e.type&&"reconnect"==e.advice&&(this.isOpened=!1),this.socket.onPacket(e),this)},n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout((function(){e.onDisconnect()}),this.socket.closeTimeout)}},n.prototype.onDisconnect=function(){return this.close&&this.isOpened&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},n.prototype.onConnect=function(){return this.socket.onConnect(),this.connectErrorCallback=void 0,this},n.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},n.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))},n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})},n.prototype.onOpen=function(){this.isOpened=!0,this.clearCloseTimeout(),this.socket.onOpen()},n.prototype.onClose=function(){this.isOpened=!1,this.socket.onClose(),this.onDisconnect()},n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},n.prototype.ready=function(e,t){t.call(this)},n.prototype.clearEventHandlers=function(){return this}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t,n){function r(e){if(this.options={port:80,secure:!1,document:"document"in n&&document,resource:"socket.io",transports:t.transports.slice(),"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},t.util.merge(this.options,e),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.disconnected=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"unload",(function(){r.disconnectSync()}),!1)}this.options["auto connect"]&&this.connect()}function o(){}e.Socket=r,t.util.mixin(r,t.EventEmitter),r.prototype.of=function(e){return this.namespaces[e]||(this.namespaces[e]=new t.SocketNamespace(this,e),""!==e&&this.namespaces[e].packet({type:"connect"})),this.namespaces[e]},r.prototype.publish=function(){var e;for(var t in this.emit.apply(this,arguments),this.namespaces)this.namespaces.hasOwnProperty(t)&&(e=this.of(t)).$emit.apply(e,arguments)},r.prototype.handshake=function(e){function n(t){t instanceof Error?r.onError(t.message):e.apply(null,t.split(":"))}var r=this,i=this.options;if(!r.disconnected){var s=["http"+(i.secure?"s":"")+":/",i.host+":"+i.port,i.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var a=document.getElementsByTagName("script")[0],c=document.createElement("script");c.src=s+"&jsonp="+t.j.length,a.parentNode.insertBefore(c,a),t.j.push((function(e){n(e),c.parentNode.removeChild(c)}))}else{var u=t.util.request();u.open("GET",s,!0),u.withCredentials=!0,u.onreadystatechange=function(){4==u.readyState&&(u.onreadystatechange=o,200==u.status?n(u.responseText):!r.reconnecting&&r.onError(u.responseText))},u.send(null)}}},r.prototype.getTransport=function(e){for(var n,r=e||this.transports,o=0;n=r[o];o++)if(t.Transport[n]&&t.Transport[n].check(this)&&(!this.isXDomain()||t.Transport[n].xdomainCheck()))return new t.Transport[n](this,this.sessionid);return null},r.prototype.connect=function(e){if(this.connecting||this.disconnected)return this;var n=this;return this.handshake((function(r,o,i,s){function a(){if(!n.connected&&!n.disconnected)if(n.connecting=!1,clearTimeout(n.connectTimeoutTimer),n.options["try multiple transports"]){for(;n.remainingTransports.length>0&&n.remainingTransports.splice(0,1)[0]!=n.transport.name;);n.remainingTransports.length?c(n.remainingTransports):n.publish("connect_failed")}else n.publish("connect_failed")}function c(e){if(n.transport&&(n.transport.clearTimeouts(),n.transport.clearEventHandlers()),n.transport=n.getTransport(e),!n.transport||n.disconnected)return n.publish("connect_failed");n.transport.ready(n,(function(){n.connecting=!0,n.publish("connecting",n.transport.name),n.transport.open(a),n.options["connect timeout"]&&(n.connectTimeoutTimer=setTimeout((function(){a()}),n.options["connect timeout"]))}))}n.sessionid=r,n.closeTimeout=1e3*i+2e3,n.heartbeatTimeout=1e3*o+2e3,n.transports=s?t.util.intersect(s.split(","),n.options.transports):n.options.transports,n.setHeartbeatTimeout(),n.remainingTransports=n.transports.slice(0),c(n.transports),n.once("connect",(function(){clearTimeout(n.connectTimeoutTimer),e&&"function"==typeof e&&e()}))})),this},r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var e=this;this.heartbeatTimeoutTimer=setTimeout((function(){e.transport.onClose()}),this.heartbeatTimeout)},r.prototype.packet=function(e){return this.connected&&!this.doBuffer?this.transport.packet(e):this.buffer.push(e),this},r.prototype.setBuffer=function(e){this.doBuffer=e,!e&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},r.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this.disconnected=!0,this},r.prototype.disconnectSync=function(){var e=t.util.request(),n=this.resource+"/"+t.protocol+"/"+this.sessionid;e.open("GET",n,!0),this.onDisconnect("booted")},r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e},r.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},r.prototype.onOpen=function(){this.open=!0},r.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)},r.prototype.onError=function(e){e&&e.advice&&"reconnect"===e.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",e&&e.reason?e.reason:e)},r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(t||n)&&(this.transport.close(),this.transport.clearTimeouts(),t&&(this.publish("disconnect",e),"booted"!=e&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},r.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces)n.namespaces.hasOwnProperty(e)&&""!==e&&n.namespaces[e].packet({type:"connect"});n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer),n.removeListener("connect_failed",t),n.removeListener("connect",t),n.reconnecting=!1,delete n.reconnectionAttempts,delete n.reconnectionDelay,delete n.reconnectionTimer,delete n.redoTransports,n.options["try multiple transports"]=o}function t(){if(n.reconnecting)return n.connected?e():n.connecting&&n.reconnecting?n.reconnectionTimer=setTimeout(t,1e3):void(n.reconnectionAttempts++>=r?n.redoTransports?(n.publish("reconnect_failed"),e()):(n.on("connect_failed",t),n.options["try multiple transports"]=!0,n.transport=n.getTransport(),n.redoTransports=!0,n.connect()):(n.reconnectionDelay<i&&(n.reconnectionDelay*=2),n.connect(),n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts),n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)))}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var n=this,r=this.options["max reconnection attempts"],o=this.options["try multiple transports"],i=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(t,this.reconnectionDelay),this.on("connect",t)}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),function(e,t){function n(e,t){this.socket=e,this.name=t||"",this.flags={},this.json=new r(this,"json"),this.ackPackets=0,this.acks={}}function r(e,t){this.namespace=e,this.name=t}e.SocketNamespace=n,t.util.mixin(n,t.EventEmitter),n.prototype.$emit=t.EventEmitter.prototype.emit,n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},n.prototype.packet=function(e){return e.endpoint=this.name,this.socket.packet(e),this.flags={},this},n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};return"function"==typeof t&&(n.id=++this.ackPackets,n.ack=!0,this.acks[n.id]=t),this.packet(n)},n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};return"function"==typeof n&&(r.id=++this.ackPackets,r.ack="data",this.acks[r.id]=n,t=t.slice(0,t.length-1)),r.args=t,this.packet(r)},n.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},n.prototype.onPacket=function(e){function n(){r.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var r=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(e.reason||"booted"):this.$emit("disconnect",e.reason||"");break;case"message":case"json":var o=["message",e.data];"data"==e.ack?o.push(n):e.ack&&this.packet({type:"ack",ackId:e.id}),this.$emit.apply(this,o);break;case"event":o=[e.name].concat(e.args),"data"==e.ack&&o.push(n),this.$emit.apply(this,o);break;case"ack":this.acks[e.ackId]&&(this.acks[e.ackId].apply(this,e.args),delete this.acks[e.ackId]);break;case"error":e.advice?this.socket.onError(e):"unauthorized"==e.reason?this.$emit("connect_failed",e.reason):this.$emit("error",e.reason)}},r.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},r.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(void 0!==r?r:n.exports,void 0!==r?r:n.parent.exports),function(e,t,n){function r(e){t.Transport.apply(this,arguments)}function o(){}e.websocket=r,t.util.inherit(r,t.Transport),r.prototype.name="websocket",r.prototype.open=function(e){var r,o=t.util.query(this.socket.options.query),i=this;return this.connectErrorCallback=e,r||(r=n.MozWebSocket||n.WebSocket),this.websocket=new r(this.prepareUrl()+o),this.websocket.onopen=function(){i.onOpen(),i.socket.setBuffer(!1)},this.websocket.onmessage=function(e){i.onData(e.data)},this.websocket.onclose=function(){i.onClose(),i.socket.setBuffer(!0)},this.websocket.onerror=function(e){i.onError(e)},this},r.prototype.send=function(e){return this.websocket.send(e),this},r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++)this.packet(e[t]);return this},r.prototype.close=function(){return this.websocket.close(),this},r.prototype.onError=function(e){void 0!==this.connectErrorCallback&&(this.connectErrorCallback(),this.connectErrorCallback=void 0),this.socket.onError(e)},r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n},r.xdomainCheck=function(){return!0},r.prototype.clearEventHandlers=function(){return this.websocket&&(this.websocket.onopen=this.websocket.onmessage=this.websocket.onclose=this.websocket.onerror=o),this},t.transports.push("websocket")}(void 0!==r?r.Transport:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),function(e,t,n){function r(e){e&&(t.Transport.apply(this,arguments),this.sendBuffer=[])}function o(){}e.XHR=r,t.util.inherit(r,t.Transport),r.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},r.prototype.payload=function(e){for(var n=[],r=0,o=e.length;r<o;r++)n.push(t.parser.encodePacket(e[r]));this.send(t.parser.encodePayload(n))},r.prototype.send=function(e){return this.post(e),this},r.prototype.post=function(e){var t=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),n.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=function(){this.onload=o,t.socket.setBuffer(!1)}:this.sendXHR.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=o,t.posting=!1,200==this.status?(t.socket.setBuffer(!1),clearTimeout(t.sendXHR.ackTimeoutTimer)):t.onClose())},this.sendXHR.send(e),t.sendXHR.ackTimeoutTimer=setTimeout((function(){t.onClose()}),t.socket.options.ackTimeoutMs)},r.prototype.close=function(){return this.onClose(),this},r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +new Date);if(n.open(e||"GET",this.prepareUrl()+r,!0),"POST"==e)try{n.setRequestHeader?n.setRequestHeader("Content-type","text/plain;charset=UTF-8"):n.contentType="text/plain"}catch(e){}return n},r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},r.check=function(e,r){try{var o=t.util.request(r),i=n.XDomainRequest&&o instanceof XDomainRequest,s=(e&&e.options&&e.options.secure?"https:":"http:")!=n.location.protocol;if(o&&(!i||!s))return!0}catch(e){}return!1},r.xdomainCheck=function(){return r.check(null,!0)},r.prototype.clearEventHandlers=function(){return this.sendXHR&&(this.sendXHR.onreadystatechange=this.sendXHR.onload=o),this}}(void 0!==r?r.Transport:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function o(){}e["xhr-polling"]=r,t.util.inherit(r,t.Transport.XHR),t.util.merge(r,t.Transport.XHR),r.prototype.name="xhr-polling",r.prototype.open=function(e){return this.connectErrorCallback=e,t.Transport.XHR.prototype.open.call(this),!1},r.prototype.get=function(){if(this.isOpened){var e=this;this.xhr=this.request(),n.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=function(){e.connectErrorCallback=void 0,this.onload=o,this.onerror=o,e.onData(this.responseText),e.get()},this.xhr.onerror=function(){e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)}):this.xhr.onreadystatechange=function(){4==this.readyState&&(this.onreadystatechange=o,200==this.status?(e.connectErrorCallback=void 0,e.onData(this.responseText),e.get()):(e.onClose(),void 0!==e.connectErrorCallback&&(e.connectErrorCallback(),e.connectErrorCallback=void 0)))},this.xhr.send(null)}},r.prototype.onClose=function(){if(t.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=o;try{this.xhr.abort()}catch(e){}this.xhr=null}},r.prototype.ready=function(e,n){var r=this;t.util.defer((function(){n.call(r)}))},r.prototype.clearEventHandlers=function(){return t.Transport.XHR.prototype.clearEventHandlers.call(this),this.xhr&&(this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=o),this},t.transports.push("xhr-polling")}(void 0!==r?r.Transport:n.exports,void 0!==r?r:n.parent.exports,void 0===e?window:e),t.io=r}).call(t,n(10),n(11)(e))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,o=n(3),i=n(1),s=n(0),a=function(e){this.id=e,this.status=200,this.headers={},this.body=""};t.ResponseData=a,function(e){e.Connected="trouter_js_client_connected",e.Disconnected="trouter_js_client_disconnected",e.Error="trouter_js_client_error",e.Progress="trouter_js_client_progress",e.Response="trouter_js_client_response",e.Request="trouter_js_client_request",e.CheckConnection="trouter_js_client_check_connection",e.Registration="trouter_js_client_registration",e.Unregistration="trouter_js_client_unregistration"}(r=t.ClientEventName||(t.ClientEventName={}));var c=function(e,t,n,r,o){this.stepName=e,this.operation=t,this.delta=n,this.ts=r,this.error=o};t.TrackerStep=c;var u=function(){};t.Properties=u;var l=function(){this.numberOfPingReplies=0,this.connectedTimestamp=0,this.isNewUrl=!1,this.transportType="",this.connectionNumber=0},d=function(){this.enabled=!1,this.numberOfStepsToMaintain=40,this.logHealthCheckError=!1,this.sendProgressTimeoutSecs=55,this.logSendPingError=!1,this.maxBackoffInMs=12e4,this.trouter_js_client_connected=!1,this.trouter_js_client_disconnected=!1,this.trouter_js_client_error=!1,this.trouter_js_client_progress=!1,this.trouter_js_client_response=!1,this.trouter_js_client_request=!1,this.trouter_js_client_registration=!1,this.trouter_js_client_unregistration=!1,this.trouter_js_client_check_connection=!0},p=function(){function e(e,t,n,r,i,a,c){this.clientId=t,this.clientInfo=n,this.getServerState=r,this.endpointId=i,this.clientCorrelationID=a,this.environment=c,this.logger=new s.Logger("ConnectionTracker",e),this.clientCorrelationID=void 0!==a?a:"",this.steps=[],this.connectionAttempt=0,this.totalStepCount=0,this.beginTimestamp=new o.Timespan,this.eventLogSettings=new d,this.connectedInfo=new l}return e.prototype.enable=function(e){this.eventLogSettings.enabled=!0,this.eventLogger=e},e.prototype.disable=function(){this.eventLogSettings.enabled=!1},e.prototype.sendProgress=function(e){this.steps.length>0&&this.sendTelemetry(r.Progress,e,this.steps)},e.prototype.cancelProgressTimer=function(){void 0!==this.progressTimeout&&(clearTimeout(this.progressTimeout),this.progressTimeout=void 0)},e.prototype.resetProgressSendTimer=function(){var e=this;this.cancelProgressTimer(),void 0!==this.eventLogSettings.sendProgressTimeoutSecs&&this.eventLogSettings.sendProgressTimeoutSecs>0&&(this.progressTimeout=setTimeout((function(){e.sendProgress({reason:"timeout",timeoutSecs:e.eventLogSettings.sendProgressTimeoutSecs})}),1e3*this.eventLogSettings.sendProgressTimeoutSecs))},e.prototype.setConnectedInfo=function(e,t){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=Date.now(),this.connectedInfo.isNewUrl=e,this.connectedInfo.transportType=t,++this.connectedInfo.connectionNumber},e.prototype.clearConnectedInfo=function(){this.connectedInfo.numberOfPingReplies=0,this.connectedInfo.connectedTimestamp=0,this.connectedInfo.isNewUrl=!0,this.connectedInfo.transportType=""},e.prototype.copyProperties=function(e,t){for(var n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];t.hasOwnProperty(o)&&void 0!==t[o]&&(e[o.replace(/-/g,"_")]={value:t[o]})}},e.prototype.increasePingResponseCount=function(){++this.connectedInfo.numberOfPingReplies},e.prototype.sendTelemetry=function(e,t,n){try{if(!0===this.eventLogSettings.enabled&&!0===this.eventLogSettings[e]&&void 0!==this.eventLogger){var r=this.getServerState(),s={name:e,properties:{connectionAttempt:{value:this.connectionAttempt},epid:{value:this.endpointId},clientCorrelationID:{value:this.clientCorrelationID},steps:{value:o.toJson(n)},clientID:{value:this.clientId},eventVersion:{value:3},environment:{value:this.environment},cv:{value:i.CLIENT_VERSION},ua:{value:this.clientInfo.ua},connectionId:{value:r.connectionId},connectedClientId:{value:r.connectedClientId},domId:{value:r.domId},url:{value:r.unsecureUrl},surl:{value:r.url},ttlInSecs:{value:r.getRemainingTtlInSec()},numberOfPingReplies:{value:this.connectedInfo.numberOfPingReplies},connectedTimestamp:{value:this.connectedInfo.connectedTimestamp},isNewUrl:{value:this.connectedInfo.isNewUrl},transportType:{value:this.connectedInfo.transportType},connectionNumber:{value:this.connectedInfo.connectionNumber}}};this.copyProperties(s.properties,t),this.eventLogger.logEvent(s)}}catch(t){this.logger.warn("error in sending event "+e+": "+o.toJson(t))}},e.prototype.createStep=function(e,t,n){return new c(e,t,this.beginTimestamp.duration,Date.now(),n)},e.prototype.addStep=function(e,t,n){if(!1!==this.eventLogSettings.enabled&&(0===this.steps.length&&this.beginTimestamp.reset(),this.steps.push(this.createStep(e,t,n)),++this.totalStepCount,void 0!==this.eventLogSettings.numberOfStepsToMaintain&&this.steps.length>this.eventLogSettings.numberOfStepsToMaintain)){var o=this.steps.slice(0);this.steps.length=0,this.sendTelemetry(r.Progress,{reason:"flush"},o)}},e.prototype.trackStart=function(e){this.addStep(e,"start")},e.prototype.trackEnd=function(e){this.addStep(e,"end")},e.prototype.trackError=function(e,t,n,o){void 0===n&&(n=!0),"health"===e&&!0!==this.eventLogSettings.logHealthCheckError||"ping"===e&&!1===this.eventLogSettings.logSendPingError||(void 0===o&&(o="error"),!0===n&&this.addStep(e,o,t),this.sendTelemetry(r.Error,{},[this.createStep(e,o,t)]))},e.prototype.trackProgress=function(e,t){this.addStep(e,t)},e.prototype.trackConnected=function(e,t){this.setConnectedInfo(e,t);var n=this.steps.slice(0),o=this.totalStepCount,i=this.beginTimestamp.duration;this.steps.length=0,this.totalStepCount=0,this.sendTelemetry(r.Connected,{stepCount:n.length,totalStepCount:o,connectionEstablishmentMs_Total:i},n),this.cancelProgressTimer()},e.prototype.trackDisconnected=function(e){e.sessionLengthMS=Date.now()-this.connectedInfo.connectedTimestamp,this.sendTelemetry(r.Disconnected,e,[]),this.resetProgressSendTimer()},e.prototype.trackNewConnection=function(){++this.connectionAttempt},e.prototype.trackRequest=function(e,t){var n={};void 0!==t&&(n.hasError=!0,n.error=t);try{if(e){n.requestID=e.id,n.httpMethod=e.method,n.url=e.url,n.bodyLength=e.body.length,n.shortUrl=e.shortUrl,n.requestTimeStamp=e.startTS,n.correlationVector=e.correlationVector;for(var i=e.headers,s=0,a=Object.keys(i);s<a.length;s++){var c=a[s];i.hasOwnProperty(c)&&(n[c]=i[c])}}}catch(e){n.hasError=!0,n.error=n.error+" error creating request context "+o.toJson(e)}this.sendTelemetry(r.Request,n,[])},e.prototype.trackResponse=function(e,t,n,i){var s={};void 0!==i&&(s.hasError=!0,s.error=i);try{if(s.responseTimestamp=void 0!==n?n.sentTS:Date.now(),e){s.requestID=e.id,s.httpMethod=e.method,s.shortUrl=e.shortUrl,s.correlationVector=e.correlationVector;for(var a=e.headers,c=0,u=Object.keys(a);c<u.length;c++){var l=u[c];a.hasOwnProperty(l)&&(s[l]=a[l])}}n&&(s.latencyMS=t,s.responseCode=n.status,s.responseLength=n.body.length)}catch(e){s.hasError=!0,s.error=s.error+" error creating response context "+o.toJson(e)}this.sendTelemetry(r.Response,s,[])},e.prototype.sendResponseError=function(e,t,n){this.trackResponse(t,void 0,n,e)},e.prototype.close=function(){this.sendProgress({reason:"closed"}),this.steps.length=0,this.cancelProgressTimer()},e.prototype.mergeSettings=function(e){if(e){this.eventLogSettings.numberOfStepsToMaintain=Math.min(40,Math.max(10,void 0!==e.numberOfStepsToMaintain?e.numberOfStepsToMaintain:0));var t=Math.min(3600,Math.max(55,void 0!==e.sendProgressTimeoutSecs?e.sendProgressTimeoutSecs:0));this.eventLogSettings.logHealthCheckError=e.logHealthCheckError,this.eventLogSettings.logSendPingError=e.logSendPingError;for(var n=0,o=Object.keys(r).map((function(e){return r[e]}));n<o.length;n++){var i=o[n];e.hasOwnProperty(i)&&void 0!==e[i]&&(this.eventLogSettings[i]=e[i])}this.eventLogSettings.sendProgressTimeoutSecs!==t&&(this.eventLogSettings.sendProgressTimeoutSecs=t,this.resetProgressSendTimer())}},e}();t.ConnectionTracker=p},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.logger=e,this.maxBackoffInMs=t,this.backoffId=0,this.backoffCount=0}return e.calculateNextBackoffMs=function(e,t){var n=1+.4*(Math.random()-.5),r=1e3*Math.pow(2,e)*n;return r=Math.round(r),Math.min(t,r)},e.prototype.setMaxBackoffMs=function(e){this.maxBackoffInMs=e},e.prototype.backoff=function(t,n){var r=this;void 0!==this.timerHandle&&(this.logger.debug("Clearing current back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0);var o=e.calculateNextBackoffMs(this.backoffCount,this.maxBackoffInMs);this.backoffId++,this.backoffCount++,this.logger.info("Backing off "+t+" for "+o+" milliseconds with ID "+this.backoffId),this.timerHandle=setTimeout((function(){r.logger.info("Back off for "+t+" with ID "+r.backoffId+" complete, invoking handler"),r.timerHandle=void 0,n()}),o)},e.prototype.reset=function(){void 0!==this.timerHandle&&(this.logger.debug("Resetting back off"),clearTimeout(this.timerHandle),this.timerHandle=void 0),this.backoffCount=0},e}();t.ExponentialBackoff=r},function(e,t,n){var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e};Object.defineProperty(t,"__esModule",{value:!0});var o=n(18),i=n(3),s=n(12),a=n(1),c=n(13),u=n(2),l=n(4),d=n(0),p=n(15),h=n(9),f=function(){this.cv=a.CLIENT_VERSION,this.ua="",this.hr="",this.v=""},m=function(){this["force new connection"]=!0,this.reconnect=!1,this.query="",this.ackTimeoutMs=5e3},g="MS-CV",y=function(){function e(e){this.cvCounter=0;var t=JSON.parse(e);this.startTS=t.hasOwnProperty("startTS")?t.startTS:0,this.url=t.hasOwnProperty("url")?t.url:"",this.shortUrl=t.hasOwnProperty("shortUrl")?t.shortUrl:"",this.body=t.hasOwnProperty("body")?t.body:"",this.headers=t.hasOwnProperty("headers")?t.headers:{},this.id=t.hasOwnProperty("id")&&"number"==typeof t.id?t.id:-1,this.method=t.hasOwnProperty("method")?t.method:"",this.replied=!1,this.timedout=!1,this.timeoutTimerId=0,this.receivedCv=this.headers[g],this.updateCvHeader()}return Object.defineProperty(e.prototype,"correlationVector",{get:function(){return this.receivedCv?this.receivedCv+"."+this.cvCounter:""},enumerable:!0,configurable:!0}),e.prototype.on=function(e,t){"data"===e?this.dataCallback=t:"end"===e&&("function"==typeof this.dataCallback&&this.dataCallback(this.body),t())},e.prototype.incrementCorrelationVector=function(){++this.cvCounter,this.updateCvHeader()},e.prototype.updateCvHeader=function(){var e=this.correlationVector;e&&(this.headers[g]=e)},e}(),v=function(){function e(e,t,n){this.request=e,this.responseData=t,this.sendResponse=n}return e.prototype.writeHead=function(e,t){this.responseData.status=e,this.responseData.headers=t},e.prototype.write=function(e){this.responseData.body+=e},e.prototype.end=function(e){return e&&(this.responseData.body+=e),this.sendResponse(this.request,this.responseData)},e}(),b=function(e){this.name=e,this.args={},this.timeoutTimerId=0},T=function(){function e(e,t,n,r,i){var u=this;this.options=t,this.manager=n,this.tokenProvider=r,this.connectionId="",this.inIncallMode=!1,this.connectionAttempt=0,this.connectedClientId="",this.c2cUrlBase="",this.allocationErrorsInRow=0,this.pendingTimers={},this.lastDisconnectReason="",this.UNKNOWN_TRANSPORT="unknown_transport",this.logger=new d.Logger("Connection",e),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff=new c.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.tokenBackoff=new c.ExponentialBackoff(this.logger,this.timeoutOptions.maxBackoffMs),this.clientID=Date.now(),"undefined"!=typeof window&&window.location&&(this.domId=window.location.hostname),this.clientInfo=new f,this.clientInfo.cv=a.CLIENT_VERSION,this.clientInfo.ua="",this.options&&this.options.clientInfo&&(this.clientInfo.ua=this.safeString(this.options.clientInfo.ua),this.clientInfo.v=this.safeString(this.options.clientInfo.v)),this.connectionTracker=new s.ConnectionTracker(e,this.clientID,this.clientInfo,(function(){return u.getServerState()}),this.options.endpointId,this.options.clientCorrelationID,this.options.environment),this.applyConnectionTrackerOptions(t);var l=this.options.incallModeTimeoutMs>0;if(this.fsm=new p.TrouterFsm(e,this,l),t.registration){var h={registrarUrl:t.registration.registrarUrl,registrationId:t.registration.registrationId,requestTimeoutMs:t.timeoutOptions.fetchTimeoutMs,initialRetryDelayMs:1e3,maxRetryDelayMs:t.timeoutOptions.maxBackoffMs};this.registrarClient=o.createRegistrarClient(e,this.tokenProvider,h)}this.userActivityState=i}return e.prototype.start=function(e){this.logger.info("Starting"),this.externalConnectParams=e,this.fsm.start()},e.prototype.stop=function(e){this.logger.info("Stopping"),this.connectionTracker.close(),this.fsm.stop(e)},e.prototype.configure=function(e){var t=this.options.trouterUrl!==e.trouterUrl;this.options=e,this.applyConnectionTrackerOptions(e),t&&(this.logger.info("Configuration changed. Reconnection required."),this.fsm.onReconnectRequired(!1))},e.prototype.checkConnection=function(e){this.logger.info("checkConnection called with "+e),this.fsm.checkConnection(e),e&&this.connectionTracker.sendTelemetry(s.ClientEventName.CheckConnection,{disconnectDetected:e},[])},e.prototype.disableRegistrationsAndAutoReconnect=function(){this.stopRegisterTimer(),this.resetRegisterBackoff(),this.fsm.disableAutoReconnect()},e.prototype.getServerState=function(){return new l.ServerState(this.connectionId,this.connectedClientId,this.domId?this.domId:"",this.allocateResult?this.allocateResult.url:"",this.allocateResult?this.allocateResult.surl:"",this.c2cUrlBase,this.connectionExpireTimestampInSecs)},e.prototype.getToken=function(e,t){var n=this;this.logger.info("Getting token "+(t?"with backoff":"without backoff"));var r=function(){n.connectionTracker.trackStart("token"),n.tokenProvider(!e).then((function(e){n.logger.debug("token is received"),n.connectionTracker.trackEnd("token"),n.fsm.onTokenReceived(e)})).catch((function(t){var r=i.toJson(t.stack);n.logger.error("Getting token failed, will retry after timeout. Error: "+r),n.connectionTracker.trackError("token",r),n.getToken(e,!0)}))};t?this.tokenBackoff.backoff("getting token",r):(this.tokenBackoff.reset(),r())},e.prototype.startConnectionTimer=function(){var e=this;this.stopConnectionTimer(),this.logger.debug("Starting connection timeout for "+this.timeoutOptions.connectionTimeoutMs+" ms"),this.connectionTimeoutId=setTimeout((function(){e.logger.info("Connection timeout is fired"),e.fsm.onConnectingTimeout()}),this.timeoutOptions.connectionTimeoutMs)},e.prototype.stopConnectionTimer=function(){this.connectionTimeoutId&&(this.logger.debug("Stopping connection timeout"),clearTimeout(this.connectionTimeoutId),this.connectionTimeoutId=void 0)},e.prototype.startPingTimer=function(){var e=this;"websocket"===this.transportTypeName?(this.logger.debug("Starting ping timeout for "+this.timeoutOptions.pingTimeoutMs+" ms"),this.pingTimerId=setInterval((function(){e.logger.info("Ping interval fired"),e.fsm.onPingInterval()}),this.timeoutOptions.pingTimeoutMs)):this.logger.debug("Not starting ping for transport "+this.transportTypeName)},e.prototype.stopPingTimer=function(){this.pingTimerId&&(this.logger.debug("Stopping ping timeout"),this.clearPingResponseTimer(),clearInterval(this.pingTimerId),this.pingTimerId=void 0)},e.prototype.shouldSkipRegistration=function(){return void 0===this.options.registration},e.prototype.hasCustomRegisterTtl=function(){return this.options.registration&&this.options.registration.registrarTtlSec},e.prototype.startRegisterTimer=function(){var e=this;void 0!==this.registrationTimerId&&this.stopRegisterTimer();var t=this.getRegistrationTtl()-30;this.logger.debug("Starting registration timeout for "+t+" sec"),this.registrationTimerId=setTimeout((function(){e.logger.info("Registration timeout is fired"),e.registrationTimerId=setTimeout((function(){e.registrationTimerId=void 0,e.logger.debug("Re-registration did not happen in time"),e.dispatchUnregistered()}),3e4),e.fsm.onRegistrationTimeout()}),1e3*t)},e.prototype.stopRegisterTimer=function(){this.registrationTimerId&&(this.logger.debug("Stopping registration timeout"),clearTimeout(this.registrationTimerId),this.registrationTimerId=void 0)},e.prototype.resendRegistration=function(){if(!this.registrarClient)throw new Error("Trouter Client not configured to handle registrations");return this.registrarClient.resendRegistration()},e.prototype.buildSocketIoUrlParams=function(){if(!this.allocateResult)throw new Error("Allocate result is undefined in buildSocketIoUrlParams()");for(var e={},t=this.allocateResult.connectparams,n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];t.hasOwnProperty(o)&&void 0!==t[o]&&(e[o]=t[o])}return e.v="v4",e.tc=encodeURI(i.toJson(this.clientInfo)),e.timeout=this.timeoutOptions.pingTimeoutMs/1e3,e.auth="true",this.options.endpointId&&(e.epid=this.options.endpointId),this.userActivityState.state!==u.UserActivityState.Unknown&&(e.userActivity=encodeURI(i.toJson(this.userActivityState.toEventObject()))),this.appendConnectedClientIds(this.buildQuery(e),!0)},e.prototype.startSocketIo=function(){var e=this;if(this.logger.info("Starting socket io"),this.connectionTracker.trackStart("connectSocket"),!this.allocateResult)throw new Error("Allocate result is undefined in startSocketIo()");var t=this.options.ioOptions||new m;if(t["force new connection"]=!0,t.reconnect=!1,t.query=this.buildSocketIoUrlParams(),this.logger.info("connecting to "+this.allocateResult.socketio+"?"+t.query),this.stopSocketIo(),this.socket=(this.options.io||h).connect(this.allocateResult.socketio,t),void 0===this.socket)throw new Error("Can't create Socket.io object");this.socket.on("connecting",(function(t){e.onSocketConnecting(t)})),this.socket.on("connect",(function(){e.onSocketConnect()})),this.socket.on("connect_failed",(function(t){e.onSocketConnectFailed(t)})),this.socket.on("disconnect",(function(t){e.onSocketDisconnect(t)})),this.socket.on("reconnect",(function(){e.onSocketReconnect()})),this.socket.on("reconnect_failed",(function(t){e.onSocketReconnectFailed(t)})),this.socket.on("reconnecting",(function(){e.onSocketReconnecting()})),this.socket.on("error",(function(t){e.onSocketError(t)})),this.socket.on("message",(function(t){e.onSocketMessage(t)})),this.socket.on("trouter.connected",(function(t){e.onTrouterConnected(t)})),this.socket.on("trouter.reconnect",(function(t){e.onTrouterReconnect(t)})),this.socket.on("trouter.message_loss",(function(t){e.onTrouterMessageLoss(t)}))},e.prototype.stopSocketIo=function(){if(this.socket){this.logger.info("clearing socket.io");try{for(var e=0,t=["connecting","connect","connect_failed","disconnect","reconnect","reconnect_failed","reconnecting","error","message","trouter.connected","trouter.reconnect","trouter.message_loss"];e<t.length;e++){var n=t[e];this.socket.removeAllListeners(n)}this.socket.disconnect(),this.logger.debug("cleared socket"),this.socket=void 0}catch(e){this.logger.error("exception in disconnecting previous socket. Error: "+i.toJson(e.stack))}}},e.prototype.dispatchConnected=function(){this.logger.info("dispatching connected"),this.manager.onConnected(this)},e.prototype.dispatchRegistered=function(){this.logger.info("dispatching registered"),this.manager.onRegistered(this)},e.prototype.dispatchUnregistered=function(){this.logger.info("dispatching unregistered"),this.manager.onUnregistered(this)},e.prototype.dispatchDownstreamRequest=function(e){var t=this;this.logger.info("dispatching downstream request");try{var n=new v(e,new s.ResponseData(e.id),(function(e,n){return t.logger.info("sending response to downstream"),t.sendResponse(e,n)}));this.manager.onDownstreamRequest(this,e,n)}catch(e){this.logger.error("exception in socket.on message. Error : "+i.toJson(e.stack))}},e.prototype.dispatchReconnecting=function(){this.logger.info("dispatching reconnecting"),this.manager.onReconnecting(this)},e.prototype.dispatchReconnectIsRequired=function(e){this.logger.info("dispatching reconnect is required by server"),this.manager.onReconnectIsRequired(this,e)},e.prototype.dispatchDisconnected=function(){this.logger.info("dispatching disconnected"),this.manager.onDisconnected(this)},e.prototype.dispatchTrouterMessageLost=function(e){this.logger.info("dispatching trouter lost message"),this.manager.onTrouterMessageLost(e)},e.prototype.sendProcessedDroppedIndicators=function(e){var t=this;try{this.logger.info("emitting processed flow tags to the server");var n=new b("trouter.processed_message_loss");n.args={droppedIndicators:e},this.sendDownstreamEvent(n,(function(){t.logger.info("emitted processed flow tags to the server")}))}catch(e){var r=i.toJson(e.stack);this.logger.error("unable to send processed message loss event. Error: "+r),this.connectionTracker.trackError("trouter.processed_message_loss",r,!1)}},e.prototype.resetAllocationConnectionParams=function(){this.allocateResult&&(this.logger.info("Resetting allocation connection parameters"),this.allocateResult=void 0)},e.prototype.sendAllocateRequest=function(e){var t=this;this.connectionAttempt++,this.connectionTracker.trackNewConnection();var n,o=this.options.trouterUrl,s=o;if(this.allocateResult)s=this.getReconnectUrlFromAllocateResult(this.allocateResult),n=this.allocateResult.connectparams;else{var a=this.externalConnectParams;a&&a.se&&parseInt(a.se,10)<=Date.now()+36e5&&(this.logger.warn("Dropping expired cached connection parameters: "+new Date(parseInt(a.se,10))),this.externalConnectParams=a=void 0),a&&a.serviceUrl!==s&&(this.logger.warn("Dropping cached connection parameters for a different environment ("+a.serviceUrl+", now "+s+")"),this.externalConnectParams=a=void 0),a&&a.reconnectUrl?(s=a.reconnectUrl,n=r({},a,{reconnectUrl:void 0})):n=a}s=this.appendCorrelationIds(s,!1),s=this.appendEndpointId(s,!1),n&&(s+="&"+this.buildQuery(n),n.v||(s+="&v=v4"));var c=new Request(s,{method:"POST",mode:"cors",headers:new Headers({"X-Skypetoken":e,"Content-Type":"text/plain"})});this.logger.info("sendAllocateRequest: POST "+s),this.connectionTracker.trackStart("allocation");var u=-1;i.fetchWithTimeout(c,this.timeoutOptions.fetchTimeoutMs).then((function(e){if(u=e.status,!e.ok)throw new Error(e.statusText);var n=e.headers.get("content-type");if(!n||"application/json"!==n&&"application/json;"!==n.substring(0,17))throw new Error("Content-type '"+n+"' is unexpected");return t.connectionTracker.trackEnd("allocation"),e.json()})).then((function(e){t.allocationErrorsInRow=0,t.onAllocationResponse(e,o)})).catch((function(e){t.allocationErrorsInRow++;var n=e+", status code "+u;t.logger.error(t.allocationErrorsInRow+" failed allocation attempts in a row. Error: "+n),t.connectionTracker.trackError("allocation",n),t.allocationErrorsInRow>=2&&t.resetAllocationConnectionParams(),t.externalConnectParams&&t.connectionAttempt>2&&(u>=400&&u<=599?(t.logger.warn(t.connectionAttempt+" connection attempts, server-side failure: erasing external connection parameters"),t.externalConnectParams=void 0):t.externalConnectParams.reconnectUrl&&(t.logger.warn(t.connectionAttempt+" connection attempts, erasing reconnect URL"),delete t.externalConnectParams.reconnectUrl)),t.fsm.onAllocationFailed(401===u)}))},e.prototype.sendPingRequest=function(){var e=this;if(this.socket&&void 0===this.pingResponseTimerId)try{this.logger.info("emitting ping event"),this.socket.emit("ping",(function(){e.onPingResponse()})),this.pingResponseTimerId=setTimeout((function(){e.logger.error("Ping response timeout is fired"),e.clearPingResponseTimer(),e.fsm.onPingResponseTimeout()}),this.timeoutOptions.pongTimeoutMs)}catch(e){var t=i.toJson(e.stack);this.logger.error("unable to send ping. Error: "+t),this.connectionTracker.trackError("ping",t,!1)}},e.prototype.setUserActivityState=function(e){var t=e.state!==this.userActivityState.state;this.userActivityState=e,this.fsm.onSetUserActivityState(e,t)},e.prototype.sendUserActivityState=function(e,t){this.userActivityState.state!==u.UserActivityState.Unknown&&("websocket"===this.transportTypeName&&t?e===l.UserActivityEventReason.Connected?this.sendUserActivityStateMultiple(2):this.sendUserActivityStateMultiple(1):"xhr-polling"===this.transportTypeName&&e===l.UserActivityEventReason.Modified&&this.fsm.forceReconnect())},e.prototype.sendRegisterRequest=function(){var e=this;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");if(!this.allocateResult)throw new Error("Allocate result is undefined in sendRegisterRequest()");this.logger.info("sending register request");var t=new i.Timespan;this.connectionTracker.trackStart("registration"),this.registrarClient.register({appId:this.options.registration.pnhAppId,aesKey:"",languageId:"en-US",platform:this.options.registration.platform,templateKey:this.options.registration.pnhTemplateKey,platformUIVersion:this.options.registration.platformUIVersion,productContext:this.options.registration.productContext},{TROUTER:[{context:this.options.registration.context,path:this.allocateResult.surl,ttl:this.getRegistrationTtl()}]}).then((function(){e.logger.info("Register request successful"),e.connectionTracker.trackEnd("registration"),e.fsm.onRegistrationSucceed(),e.connectionTracker.sendTelemetry(s.ClientEventName.Registration,{duration:t.duration},[])})).catch((function(n){e.logger.error("Register request failed. Error: "+n),e.connectionTracker.trackError("registration",n.message),e.fsm.onRegistrationFailed(!1),e.connectionTracker.sendTelemetry(s.ClientEventName.Registration,{duration:t.duration},[])}))},e.prototype.sendUnregisterRequest=function(){var e=this;this.logger.info("sending unregister request");var t=new i.Timespan;if(!this.options.registration||!this.registrarClient)throw new Error("Internal error - options.registration is undefined");this.connectionTracker.trackStart("unregistration"),this.registrarClient.unregister().then((function(){e.logger.info("Unregister request successful"),e.connectionTracker.trackEnd("unregistration"),e.fsm.onUnregistrationSucceed(),e.connectionTracker.sendTelemetry(s.ClientEventName.Unregistration,{duration:t.duration},[])})).catch((function(n){e.logger.error("Unregister request failed. Error: "+n),e.connectionTracker.trackError("unregistration",n.message),e.fsm.onUnregistrationFailed(!1),e.connectionTracker.sendTelemetry(s.ClientEventName.Unregistration,{duration:t.duration},[])}))},e.prototype.resetTokenBackoff=function(){this.tokenBackoff.reset()},e.prototype.resetRegisterBackoff=function(){this.registrarClient&&this.registrarClient.cancelPendingRequests()},e.prototype.clearTimers=function(){this.logger.debug("Clearing all pending downstream events related timers");for(var e=0,t=Object.keys(this.pendingTimers);e<t.length;e++){var n=t[e];this.clearTimer(Number(n))}},e.prototype.restartIncallModeTimer=function(){var e=this;this.clearIncallModeTimerId(),this.logger.debug("Restarting incall mode timer"),this.incallModeTimerId=setTimeout((function(){e.logger.info("Call mode timer fired"),e.fsm.onIncallModeTimer()}),this.options.incallModeTimeoutMs)},e.prototype.enterIncallMode=function(){this.logger.info("Entering incall mode"),this.timeoutOptions=this.options.incallTimeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!0},e.prototype.exitIncallMode=function(){this.logger.info("Exiting incall mode"),this.clearIncallModeTimerId(),this.timeoutOptions=this.options.timeoutOptions,this.healthBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.tokenBackoff.setMaxBackoffMs(this.timeoutOptions.maxBackoffMs),this.inIncallMode=!1},e.prototype.isIncallMode=function(){return this.inIncallMode},e.prototype.onSocketConnecting=function(e){this.logger.info("onSocketConnecting("+e+")"),this.transportTypeName=e,this.connectionTracker.trackProgress("connecting",this.transportTypeName),this.fsm.onConnecting()},e.prototype.onSocketConnect=function(){this.logger.info("onSocketConnect")},e.prototype.onSocketConnectFailed=function(e){this.logger.error("onSocketConnectFailed"),this.connectionTracker.trackError("connect_failed",e,!0,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onConnectingFailed()},e.prototype.onSocketDisconnect=function(e){this.logger.error("onSocketDisconnect, reason: "+e);var t={reason:e,serverClosed:!this.fsm.isActive()};this.connectionTracker.trackDisconnected(t),this.connectionTracker.clearConnectedInfo();var n=t.sessionLengthMS||0;"dup"===e&&"dup"===this.lastDisconnectReason&&n<this.options.duplicateDisconnectThresholdMs&&(this.logger.warn("Socket was closed by server as Duplicate for the second time in a row after "+n+" ms which is below the threshold of "+this.options.duplicateDisconnectThresholdMs+" ms. Resetting cached connection parameters and making a new allocation."),this.resetAllocationConnectionParams()),this.lastDisconnectReason=e,this.fsm.onSocketError(void 0),this.connectionExpireTimestampInSecs=void 0},e.prototype.onSocketReconnect=function(){this.logger.error("onSocketReconnect"),this.fsm.onTrouterConnected()},e.prototype.onSocketReconnectFailed=function(e){this.logger.error("onSocketReconnectFailed with '"+e+"'"),this.fsm.onSocketError("string"==typeof e?e:void 0)},e.prototype.onSocketReconnecting=function(){this.logger.error("onSocketReconnecting")},e.prototype.onSocketError=function(e){this.logger.error("onSocketError with '"+i.toJson(e)+"'"),this.connectionTracker.trackError("connectSocket",e),this.fsm.onSocketError("string"==typeof e?e:void 0)},e.prototype.onSocketMessage=function(e){var t,n=this;this.logger.info("onSocketMessage");try{var r=(t=new y(e)).headers&&t.headers["X-Microsoft-Skype-Chain-ID"],o=r?" Chain-Id "+r:"";this.logger.info("Received request N "+t.id+o+" CV "+t.correlationVector+" to '"+t.url+"'"),t.startTS=Date.now(),t.url&&this.urlPath&&0===t.url.indexOf(this.urlPath)&&(t.shortUrl=t.url.substring(this.urlPath.length))}catch(e){var a=i.toJson(e.stack);return this.logger.error("unable to parse request. Error: "+a),this.connectionTracker.trackRequest(void 0,a),void this.connectionTracker.sendResponseError("unable to parse request, error: "+e)}t.timeoutTimerId=setTimeout((function(){if(!t.replied){n.logger.error("Request "+t.id+" timed out");var e=new s.ResponseData(t.id);e.status=504,e.headers={"Trouter-Responder":"ClientLib"},n.sendResponse(t,e),t.timedout=!0}}),this.timeoutOptions.requestTimeoutMs);try{this.connectionTracker.trackRequest(t),this.fsm.onDownstreamRequest(t)}catch(e){this.logger.error("exception in socket.on message. Error: "+i.toJson(e.stack)),this.connectionTracker.sendResponseError(e.message,t,void 0)}},e.prototype.onTrouterConnected=function(e){if(this.allocateResult){this.logger.info("onTrouterConnected: "+this.allocateResult.url),this.socket&&this.socket.socket&&this.socket.socket.options&&this.socket.socket.options.query&&(this.socket.socket.options.query+="&connected=true"),this.urlPath=this.allocateResult.url.replace(/https?:\/\/([A-z0-9\:\$\-\_\.\+\!\*\"\(\)\,]*)\//,"/");var t=this.connectedUrl!==this.allocateResult.url;this.connectedUrl=this.allocateResult.url,this.connectionExpireTimestampInSecs=i.calculateExpireTsInSec(e.ttl),this.connectionTracker.trackEnd("connectSocket"),this.connectionTracker.trackConnected(t,this.transportTypeName?this.transportTypeName:this.UNKNOWN_TRANSPORT),this.fsm.onTrouterConnected()}else this.logger.error("Invalid internal state - received onTrouterConnected while allocateResult is not set")},e.prototype.onTrouterReconnect=function(e){var t=e.target;this.logger.info("onTrouterReconnect target: "+t),"self"===t?this.fsm.onReconnectRequired(!0):this.fsm.onReconnectRequired(!1)},e.prototype.onTrouterMessageLoss=function(e){this.logger.info("onTrouterMessageLoss"),this.fsm.onTrouterMessageLost(e.droppedIndicators)},e.prototype.getReconnectUrlFromAllocateResult=function(e){return e.socketio+"v4/a"},e.prototype.onAllocationResponse=function(e,t){this.logger.info("Received allocation response "+JSON.stringify(e)),this.allocateResult=e,this.externalConnectParams=void 0;var n=+e.ttl;if(this.connectionExpireTimestampInSecs=i.calculateExpireTsInSec(n),this.connectionId=this.allocateResult.id||"",this.connectedClientId=this.allocateResult.ccid,this.logger.info("connected client id set {connectedClientId:"+this.connectedClientId+"}"),this.c2cUrlBase=e.curlb||"",""===this.c2cUrlBase){var o=e.surl.indexOf("://");o>=0&&(o=e.surl.indexOf("/",o+3))>=5&&":3443"===e.surl.substr(o-5,5)&&(this.c2cUrlBase=e.surl.substr(0,o-5))}var s=r({serviceUrl:t,reconnectUrl:this.getReconnectUrlFromAllocateResult(this.allocateResult)},e.connectparams);this.manager.onConnectionParametersUpdated(s),this.fsm.onAllocationSucceed()},e.prototype.onPingResponse=function(){this.logger.info("onPingResponse"),this.connectionTracker.increasePingResponseCount(),this.clearPingResponseTimer(),this.fsm.onPingResponse()},e.prototype.clearPingResponseTimer=function(){void 0!==this.pingResponseTimerId&&(clearTimeout(this.pingResponseTimerId),this.pingResponseTimerId=void 0)},e.prototype.buildQuery=function(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++){var o=r[n];e.hasOwnProperty(o)&&void 0!==e[o]&&t.push(o+"="+e[o])}return t.join("&")},e.prototype.appendConnectedClientIds=function(e,t){var n="";e.indexOf("ccid=")<0&&(n="ccid="+this.connectedClientId+"&"),this.domId&&(n+="dom="+this.domId+"&"),n.length>0&&(n=n.slice(0,-1));var r=t||-1!==e.indexOf("?")?"&":"?";return this.appendCorrelationIds(e+r+n,t)},e.prototype.appendEndpointId=function(e,t){var n=t||-1!==e.indexOf("?")?"&":"?";return e.indexOf("epid")<0&&this.options.endpointId?""+e+n+"epid="+this.options.endpointId:e},e.prototype.appendCorrelationIds=function(e,t){var n=t||-1!==e.indexOf("?")?"&":"?";return e.indexOf("cor_id")<0?""+e+n+"cor_id="+this.options.clientCorrelationID+"&con_num="+this.clientID+"_"+this.connectionAttempt:e},e.prototype.getHealthUrl=function(e){return e.substring(0,e.lastIndexOf("/a"))+"/h"},e.prototype.safeString=function(e){return"string"==typeof e?e:""},e.prototype.sendResponse=function(e,t){if(e.timedout)return this.logger.error("Request "+e.id+" already timed out"),1;if(e.replied)return this.logger.error("Response for request "+e.id+" already sent"),2;clearTimeout(e.timeoutTimerId),e.timeoutTimerId=0,e.replied=!0,t.headers=t.headers||{};var n=e.correlationVector;this.logger.info("Sending response for request N "+e.id+" CV "+n+" with status "+t.status),n&&(t.headers[g]=n),e.headers&&e.headers["trouter-request"]&&!t.headers["trouter-request"]&&(t.headers["trouter-request"]=e.headers["trouter-request"]);var r=Date.now()-e.startTS;if(t.headers["trouter-client"]=i.toJson({cd:r}),this.logger.debug("response: "+i.toJson(t)),!this.socket)return this.connectionTracker.sendResponseError("no socket",e,t),4;try{return this.socket.send(i.toJson(t)),t.sentTS=Date.now(),e.incrementCorrelationVector(),this.connectionTracker.trackResponse(e,r,t),"websocket"===this.transportTypeName&&this.sendPingRequest(),0}catch(n){var o="unable to send data on response.end. Error: "+i.toJson(n.stack);return this.logger.error(o),this.connectionTracker.sendResponseError(o,e,t),4}},e.prototype.sendUserActivityStateMultiple=function(e){var t=this,n=new b("user.activity"),r=this.userActivityState.toEventObject();n.args=r,this.userActivityState.correlationVector.increase(),this.logger.debug("Sending user activity '"+this.userActivityState.toEventJSON()+"', remaining "+(e-1)),this.sendDownstreamEvent(n,(function(){if(t.logger.info("User activity state: "+r.state+", cv: "+r.cv+" accepted"),t.manager.onUserActivityStateAccepted&&t.manager.onUserActivityStateAccepted(r.cv),t.clearTimer(n.timeoutTimerId),e>1){var o=setTimeout((function(){t.clearTimer(o),t.sendUserActivityStateMultiple(e-1)}),t.options.userActivitySecondResendDelayMs);t.registerTimer(o,"user.activity/resend")}})),n.timeoutTimerId=setTimeout((function(){t.logger.error("Activity state response timeout is fired"),t.fsm.onActivityStateResponseTimeout(),t.clearTimer(n.timeoutTimerId)}),this.timeoutOptions.userActivityResponseTimeoutMs),this.registerTimer(n.timeoutTimerId,"user.activity/response")},e.prototype.sendDownstreamEvent=function(e,t){this.logger.info("Sending downstream event "+e.name),this.socket&&this.socket.emit(e.name,e.args,t)},e.prototype.registerTimer=function(e,t){this.logger.debug("registering timer "+e+" -> "+t),this.pendingTimers[e]=t},e.prototype.clearTimer=function(e){var t=this.pendingTimers[e];this.logger.debug("clearing timer "+e+" -> "+t),delete this.pendingTimers[e],clearTimeout(e)},e.prototype.getRegistrationTtl=function(){var e=i.calculateTtlInSec(this.connectionExpireTimestampInSecs);return this.logger.debug("Current connectionID will expire in "+e+" seconds"),this.options.registration&&this.options.registration.registrarTtlSec&&e>0?Math.min(this.options.registration.registrarTtlSec,e):this.options.registration&&this.options.registration.registrarTtlSec?this.options.registration.registrarTtlSec:e>0?e:3600},e.prototype.clearIncallModeTimerId=function(){void 0!==this.incallModeTimerId&&(this.logger.debug("Clearing in-call mode timer"),clearTimeout(this.incallModeTimerId),this.incallModeTimerId=void 0)},e.prototype.applyConnectionTrackerOptions=function(e){try{e.eventLogger&&"function"==typeof e.eventLogger.logEvent?(this.connectionTracker.mergeSettings(e.telemetrySettings),this.connectionTracker.enable(e.eventLogger)):this.logger.warn("Trouter client event logging disabled due to invalid configuration.")}catch(e){this.logger.warn("Trouter client event logging disabled. Error: "+i.toJson(e.stack)),this.connectionTracker.disable()}},e}();t.TrouterConnection=T},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r,o,i=n(4),s=n(0);!function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Allocating=2]="Allocating",e[e.Handshaking=3]="Handshaking",e[e.Connecting=4]="Connecting",e[e.Connected=5]="Connected",e[e.UnregisteringRetrievingToken=6]="UnregisteringRetrievingToken",e[e.Unregistering=7]="Unregistering"}(r=t.State||(t.State={})),function(e){e[e.Initial=0]="Initial",e[e.RetrievingToken=1]="RetrievingToken",e[e.Registering=2]="Registering",e[e.Registered=3]="Registered",e[e.NotRegistered=4]="NotRegistered"}(o||(o={}));var a=function(){function e(e,t,n){this.worker=t,this.incallModeEnabled=n,this.state=r.Initial,this.connectionErrors=0,this.autoReconnect=!0,this.logger=new s.Logger("ConnectionFsm",e),this.connectedSubstate=o.Initial}return e.prototype.getState=function(){return this.state},e.prototype.isActive=function(){return this.state===r.Allocating||this.state===r.Connected||this.state===r.Handshaking||this.state===r.Connecting||this.state===r.RetrievingToken},e.prototype.start=function(){return this.state===r.Initial?(this.setState(r.RetrievingToken),this.worker.getToken(!0,!1),!0):(this.showIgnored("start"),!1)},e.prototype.stop=function(e){e&&(this.connectedSubstate=o.Initial),this.worker.isIncallMode()&&this.worker.exitIncallMode(),this.worker.resetTokenBackoff(),this.worker.resetRegisterBackoff(),this.worker.stopConnectionTimer(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopRegisterTimer(),this.state!==r.Connecting&&this.state!==r.Handshaking&&this.state!==r.Connected||this.worker.stopSocketIo(),this.isRegistered()&&this.state!==r.UnregisteringRetrievingToken&&this.state!==r.Unregistering?(this.setState(r.UnregisteringRetrievingToken),this.worker.getToken(!0,!1)):(this.setState(r.Initial),this.worker.dispatchDisconnected())},e.prototype.onTokenReceived=function(e){this.state===r.RetrievingToken?(this.setState(r.Allocating),this.worker.startConnectionTimer(),this.worker.sendAllocateRequest(e)):this.state===r.Connected&&this.connectedSubstate===o.RetrievingToken?(this.connectedSubstate=o.Registering,this.worker.sendRegisterRequest()):this.state===r.UnregisteringRetrievingToken?(this.setState(r.Unregistering),this.worker.sendUnregisterRequest()):this.showIgnored("onTokenReceived")},e.prototype.checkConnection=function(e){e&&this.onPingInterval()},e.prototype.onAllocationSucceed=function(){return this.state===r.Allocating?(this.setState(r.Handshaking),this.connectedSubstate===o.Registered&&this.worker.dispatchUnregistered(),this.connectedSubstate=o.Initial,this.worker.startSocketIo(),!0):(this.showIgnored("onAllocationSucceed"),!1)},e.prototype.onAllocationFailed=function(e){this.state===r.Allocating?(this.setState(r.RetrievingToken),this.worker.stopConnectionTimer(),this.worker.getToken(!e,!0)):this.showIgnored("onAllocationFailed")},e.prototype.onConnectingTimeout=function(){this.state===r.Allocating||this.state===r.Connecting||this.state===r.Handshaking?(this.setState(r.RetrievingToken),this.resetAllocationIfNecessary(void 0),this.worker.stopSocketIo(),this.worker.getToken(!0,!1)):this.showIgnored("onConnectingTimeout")},e.prototype.onConnecting=function(){this.state===r.Handshaking?this.setState(r.Connecting):this.showIgnored("onConnecting")},e.prototype.onConnectingFailed=function(){this.state===r.Connecting?this.onConnectingTimeout():this.state===r.Handshaking?(this.logger.error("Unexpected error in Socket.io - no valid transports"),this.onConnectingTimeout()):this.showIgnored("onConnectingFailed")},e.prototype.onSocketError=function(e){this.state===r.Handshaking||this.state===r.Connected?(this.worker.stopSocketIo(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopConnectionTimer(),this.state!==r.Connected&&this.worker.resetAllocationConnectionParams(),this.autoReconnect?(this.setState(r.RetrievingToken),this.worker.resetRegisterBackoff(),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)):(this.logger.debug("Socket error/disconnect occurred and automatic reconnect is disabled. Connection will stop."),this.stop(!0))):this.showIgnored("onSocketError")},e.prototype.onTrouterConnected=function(){this.state===r.Connecting?(this.setState(r.Connected),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.sendUserActivityState(i.UserActivityEventReason.Connected,!0),this.worker.startPingTimer(),this.worker.dispatchConnected(),this.connectionErrors=0,this.worker.shouldSkipRegistration()?(this.connectedSubstate=o.NotRegistered,this.worker.dispatchRegistered()):(this.connectedSubstate=o.RetrievingToken,this.worker.getToken(!0,!1))):this.showIgnored("onTrouterConnected")},e.prototype.onReconnectRequired=function(e){this.worker.dispatchReconnectIsRequired(e)},e.prototype.disableAutoReconnect=function(){this.autoReconnect=!1},e.prototype.onDownstreamRequest=function(e){this.state===r.Connected?(this.switchToIncallModeIfEnabled(),this.worker.dispatchDownstreamRequest(e)):this.showIgnored("onDownstreamRequest")},e.prototype.onTrouterMessageLost=function(e){this.state===r.Connected?this.worker.dispatchTrouterMessageLost(e):this.showIgnored("onTrouterMessageLost")},e.prototype.onPingInterval=function(){this.state===r.Connected?this.worker.sendPingRequest():this.showIgnored("onPingInterval")},e.prototype.onPingResponseTimeout=function(){this.onMissedResponse("onPingResponseTimeout")},e.prototype.onPingResponse=function(){this.state===r.Connected||this.showIgnored("onPingResponse")},e.prototype.onRegistrationFailed=function(e){this.state===r.Connected&&this.connectedSubstate===o.Registering?(this.connectedSubstate=o.RetrievingToken,this.worker.getToken(!e,!0)):this.showIgnored("onRegistrationFailed")},e.prototype.onRegistrationSucceed=function(){this.state===r.Connected?(this.connectedSubstate===o.Registering&&(this.connectedSubstate=o.Registered,this.worker.dispatchRegistered()),this.worker.hasCustomRegisterTtl()&&this.worker.startRegisterTimer()):this.showIgnored("onRegistrationSucceed")},e.prototype.onRegistrationTimeout=function(){this.state===r.Connected&&this.connectedSubstate!==o.NotRegistered?(this.connectedSubstate=o.RetrievingToken,this.worker.getToken(!0,!1)):this.showIgnored("onRegistrationTimeout")},e.prototype.onUnregistrationFailed=function(e){this.state===r.Unregistering?(this.setState(r.UnregisteringRetrievingToken),this.worker.getToken(!e,!e)):this.showIgnored("onUnregistrationFailed")},e.prototype.onUnregistrationSucceed=function(){this.state===r.Unregistering?(this.setState(r.Initial),this.worker.dispatchUnregistered(),this.worker.dispatchDisconnected()):this.showIgnored("onUnregistrationSucceed")},e.prototype.onIncallModeTimer=function(){this.worker.exitIncallMode(),this.state===r.Connected?(this.worker.stopPingTimer(),this.worker.startPingTimer()):this.showIgnored("onIncallModeTimer")},e.prototype.onSetUserActivityState=function(e,t){t?(this.logger.info("Changing user activity state to '"+e.toEventJSON()+"'"),this.worker.sendUserActivityState(i.UserActivityEventReason.Modified,this.state===r.Connected)):this.logger.debug("Not changing the same user activity state '"+e.toEventJSON()+"'")},e.prototype.onActivityStateResponseTimeout=function(){this.onMissedResponse("onActivityStateResponseTimeout")},e.prototype.forceReconnect=function(){this.setState(r.RetrievingToken),this.worker.resetTokenBackoff(),this.worker.stopConnectionTimer(),this.worker.resetRegisterBackoff(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopSocketIo(),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)},e.prototype.onMissedResponse=function(e){this.state===r.Connected?(this.setState(r.RetrievingToken),this.worker.resetRegisterBackoff(),this.worker.stopPingTimer(),this.worker.clearTimers(),this.worker.stopSocketIo(),this.worker.dispatchReconnecting(),this.worker.getToken(!0,!1)):this.showIgnored(e)},e.prototype.showIgnored=function(e){this.logger.debug("Ignoring event '"+e+"' in state '"+r[this.state]+"'")},e.prototype.setState=function(e){this.logger.info("Switching from state '"+r[this.state]+"' to state '"+r[e]+"'"),this.state!==e?this.state=e:this.logger.error("Attempt to switching into the current state '"+r[e]+"'")},e.prototype.resetAllocationIfNecessary=function(e){this.connectionErrors++,this.connectionErrors>=2||void 0!==e&&/^4\d\d /.test(e)?(this.logger.error("Connection error count is "+this.connectionErrors+" - will reset allocation"),this.connectionErrors=0):this.logger.info("Connection error count is "+this.connectionErrors+" - will NOT reset allocation")},e.prototype.isRegistered=function(){return this.connectedSubstate===o.Registered||this.connectedSubstate===o.Registering},e.prototype.switchToIncallModeIfEnabled=function(){this.incallModeEnabled&&(this.worker.isIncallMode()||(this.worker.enterIncallMode(),this.worker.stopPingTimer(),this.worker.startPingTimer()),this.worker.restartIncallModeTimer())},e}();t.TrouterFsm=a},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(0),i=function(){function e(e,t){this.worker=t,this.state=r.TrouterState.Unknown,this.logger=new o.Logger("ManagerFsm",e)}return e.prototype.start=function(){this.state===r.TrouterState.Unknown?(this.setState(r.TrouterState.Disconnected),this.worker.forceStopLingeringConnection(),this.worker.startFirstConnection()):this.showIgnored("start")},e.prototype.stop=function(e){this.state!==r.TrouterState.Unknown?(this.setState(r.TrouterState.Unknown),this.worker.stopFirstConnection(!0===e),this.worker.stopSecondConnection(!0===e)):this.showIgnored("stop")},e.prototype.getState=function(){return this.state},e.prototype.onConnected=function(e){this.state===r.TrouterState.Disconnected&&e?this.worker.doesSecondConnectionExist()?this.setState(r.TrouterState.Switching):(this.setState(r.TrouterState.Connected),this.worker.dispatchConnected()):this.showIgnored("onConnected("+e+")")},e.prototype.onRegistered=function(e){this.state!==r.TrouterState.Disconnected||e?this.state!==r.TrouterState.Switching||e||(this.setState(r.TrouterState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnectionDelayed(),this.worker.dispatchConnected()):(this.setState(r.TrouterState.Connected),this.worker.switchConnections(),this.worker.stopSecondConnection(!0),this.worker.dispatchConnected()),this.worker.dispatchRegistrationState(!0)},e.prototype.onUnregistered=function(e){e&&this.worker.dispatchRegistrationState(!1)},e.prototype.onReconnecting=function(e){this.state===r.TrouterState.Connected&&e||this.state===r.TrouterState.Switching&&e?(this.setState(r.TrouterState.Disconnected),this.worker.dispatchReconnecting()):this.showIgnored("onReconnecting("+e+")")},e.prototype.onReconnectionRequired=function(e,t){this.state===r.TrouterState.Connected&&e?(this.setState(r.TrouterState.Switching),this.worker.startSecondConnection(t)):this.state===r.TrouterState.Disconnected&&e?this.worker.startSecondConnection(t):this.showIgnored("onReconnectionRequired("+e+")")},e.prototype.onDisconnected=function(e){this.state===r.TrouterState.Unknown&&e?this.worker.dispatchStopped():this.showIgnored("onDisconnected("+e+")")},e.prototype.showIgnored=function(e){this.logger.info("Ignoring event '"+e+"' in state '"+r.TrouterState[this.state]+"'")},e.prototype.setState=function(e){this.logger.info("Switching from state '"+r.TrouterState[this.state]+"' to state '"+r.TrouterState[e]+"'"),this.state!==e?this.state=e:this.logger.error("Attempt to switching into the current state '"+r.TrouterState[e]+"'")},e}();t.TrouterManagerFsm=i},function(e,t,n){function r(e,t){if(!t)return e;var n=i({},e,{enabled:t.TelemetryEnabled});return void 0!==t.ClientTelemetryEventEnabled&&(n=i({},n,t.ClientTelemetryEventEnabled)),n}function o(e,t){return{clientInfo:{ua:e.trouterSettings.productName,v:e.trouterSettings.version},ioOptions:{ackTimeoutMs:5e3},clientCorrelationID:e.trouterSettings.sessionId,environment:e.trouterSettings.environment,telemetrySettings:r(e.telemetryConfig.settings,t),eventLogger:e.telemetryConfig.eventLogger,endpointId:e.trouterSettings.registrationId,trouterUrl:t&&t.TrouterConnectionUrl||e.trouterSettings.trouterServiceUrl,registration:e.trouterSettings.registrarServiceUrl?{registrarUrl:e.trouterSettings.registrarServiceUrl,registrationId:e.trouterSettings.registrationId||"",pnhAppId:e.trouterSettings.pnhAppId||"",platform:e.trouterSettings.platform||"",pnhTemplateKey:e.trouterSettings.pnhTemplate||"",platformUIVersion:e.trouterSettings.platformUIVersion||"",productContext:e.trouterSettings.pnhProductContext||void 0,context:e.trouterSettings.pnhContext||"",registrarTtlSec:(e.trouterSettings.maxRegistrationTimeInMs||0)/1e3}:void 0,timeoutOptions:i({connectionTimeoutMs:e.trouterSettings.trouterConnectTimeoutInMs||3e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:3e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},e.trouterSettings.timeoutOptions),incallTimeoutOptions:i({connectionTimeoutMs:1e4,fetchTimeoutMs:5e3,pingTimeoutMs:5e3,pongTimeoutMs:2e3,maxBackoffMs:1e4,requestTimeoutMs:5e3,userActivityResponseTimeoutMs:1e4},e.trouterSettings.incallTimeoutOptions),incallModeTimeoutMs:e.trouterSettings.incallModeTimeoutMs||0,lingeringConnectionDelayMs:6e4,userActivitySecondResendDelayMs:e.trouterSettings.userActivitySecondResendDelayMs||1e4,duplicateDisconnectThresholdMs:1e4,connectionCache:e.connectionCache,registrationStateCallback:e.registrationStateCallbackForAcsDoNotUse}}var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=(s=c.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,s,a,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a};Object.defineProperty(t,"__esModule",{value:!0});var c=n(1),u=n(2);t.TrouterState=u.TrouterState,t.UserActivityState=u.UserActivityState;var l=n(0),d=n(5),p=n(6),h=n(7),f=n(8),m=function(){function e(e){this.logProvider=e,this.stateChangedListeners=[],this.logger=new l.Logger("Trouter",e),this.trouterUrlPromise=new f.TrouterUrlPromise(e),this.messageHandlers=new d.MessageHandlerRegistry(e),this.listeners={},this.connectionInfo=null,this.logger.info("Created TrouterService version "+c.CLIENT_VERSION)}return e.prototype.start=function(e){if(this.logger.info("Start"),!e.trouterSettings.disableInternalSkypeTokenCache){var t=e.skypeTokenProvider;e.skypeTokenProvider=p.addCacheAsBackupTo(t)}this.trouterCfg=e;var n=o(e,this.ecsCfg);void 0===this.trouterServer&&(this.trouterServer=new h.TrouterManager(this.logProvider,n,e.skypeTokenProvider,this)),this.trouterServer.start()},e.prototype.stop=function(e){this.logger.info("close connection"),this.trouterUrlPromise.rejectUrl(new Error("TrouterService is stopped")),void 0!==this.trouterServer&&this.trouterServer.stop(e)},e.prototype.setEcsConfig=function(e){return s(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return[2,new Promise((function(n,r){if(t.ecsCfg=e.TrouterJScriptClient,t.logger.info("Setting ECS configuration to "+JSON.stringify(t.ecsCfg)),void 0!==t.trouterServer&&void 0!==t.trouterCfg){var i=o(t.trouterCfg,t.ecsCfg);t.trouterServer.configure(i)}n()}))]}))}))},e.prototype.checkConnection=function(e){void 0!==this.trouterServer&&this.trouterServer.checkConnection(e||!1)},e.prototype.resendRegistration=function(){return s(this,void 0,void 0,(function(){return a(this,(function(e){if(!this.trouterServer)throw new Error("resendRegistration called too early");return[2,this.trouterServer.resendRegistration()]}))}))},e.prototype.registerListener=function(e,t){return""===t||"/"!==t[0]||t.indexOf("?")>=0||t.indexOf("#")>=0?(this.logger.error("Listener path '"+t+"' is not valid"),!1):this.listeners[t]?(this.logger.error("Another listener is already registered for path '"+t+"'"),!1):(this.listeners[t]=e,this.logger.debug("Listener for path '"+t+"' registered"),this.connectionInfo&&e.onTrouterConnected(this.connectionInfo.baseEndpointUrl+t,this.connectionInfo),!0)},e.prototype.unregisterListener=function(e){for(var t=[],n=0,r=Object.keys(this.listeners);n<r.length;n++){var o=r[n];this.listeners[o]===e&&t.push(o)}if(0===t.length)return!1;for(var i=0,s=t;i<s.length;i++)o=s[i],delete this.listeners[o];return this.logger.debug("Listener for path(s) '"+t.join("', '")+"' unregistered"),!0},e.prototype.onTrouterConnected=function(e,t){this.logger.debug("Trouter is now connected");for(var n=0,r=Object.keys(this.listeners);n<r.length;n++){var o=r[n];try{this.listeners[o].onTrouterConnected(t.baseEndpointUrl+o,t)}catch(e){this.logger.error("Listener '"+o+"' threw an exception from onTrouterConnected(): "+e)}}this.connectionInfo=t,this.trouterUrlPromise.resolveUrl(e),this.notifyStateChanged(u.TrouterState.Connected,{url:e,getRemainingTtlInSec:function(){return t.connectionTtlSec}})},e.prototype.onTrouterDisconnected=function(){this.logger.debug("Trouter is now disconnected"),this.connectionInfo=null;for(var e=0,t=Object.keys(this.listeners);e<t.length;e++){var n=t[e],r=this.listeners[n];if(r.onTrouterDisconnected)try{r.onTrouterDisconnected()}catch(e){this.logger.error("Listener '"+n+"' threw an exception from onTrouterDisconnected(): "+e)}}this.notifyStateChanged(u.TrouterState.Disconnected)},e.prototype.onTrouterRequest=function(e,t){for(var n="",r=0,o=Object.keys(this.listeners);r<o.length;r++){var i=o[r];e.path.substring(0,i.length)===i&&i.length>n.length&&(n=i)}if(""===n)this.tryMessageHandlers(e,t)||(t.status=404,t.headers={"Trouter-Responder":"ClientLib"},t.send());else try{this.listeners[n].onTrouterRequest(e,t)}catch(e){this.logger.error("Listener '"+n+"' threw an exception from onTrouterRequest(): "+e),t.status=500,t.headers={"Trouter-Responder":"ClientLib"},t.send()}},e.prototype.onTrouterMessageLoss=function(e){this.logger.info("onTrouterMessageLoss called with value "+e);for(var t=!0,n=0,r=Object.keys(this.listeners);n<r.length;n++){var o=r[n],i=this.listeners[o];if(i.onTrouterMessageLoss)try{void 0===(t=i.onTrouterMessageLoss(e)&&t)&&(this.logger.error("Listener '"+o+"' did not response with boolean value onTrouterMessageLoss()"),t=!1)}catch(e){this.logger.error("Listener '"+o+"' threw an exception from onTrouterMessageLoss(): "+e),t=!1}}return t},e.prototype.onTrouterUserActivityStateAccepted=function(e){this.logger.debug("onTrouterUserActivityStateAccepted cv: "+e);for(var t=0,n=Object.keys(this.listeners);t<n.length;t++){var r=n[t],o=this.listeners[r];if(o.onTrouterUserActivityStateAccepted)try{o.onTrouterUserActivityStateAccepted(e)}catch(e){this.logger.error("Listener '"+r+"' threw an exception from onTrouterUserActivityStateAccepted(): "+e)}}},e.prototype.setUserActivityState=function(e,t){if(e!==u.UserActivityState.Active&&e!==u.UserActivityState.Inactive)throw new Error("setUserActivityState called with unsupported value "+e);if(this.logger.info("setUserActivityState called with value "+u.UserActivityState[e]),!this.trouterServer||this.state()===u.TrouterState.Unknown)throw new Error("setUserActivityState called too early");this.trouterServer.setUserActivityState(e,t)},e.prototype.state=function(){return void 0!==this.trouterServer?this.trouterServer.getState():u.TrouterState.Unknown},e.prototype.getServerState=function(){if(void 0!==this.trouterServer)return this.trouterServer.getServerState()},e.prototype.getTrouterUrlAsync=function(){return void 0!==this.trouterServer?this.trouterUrlPromise.getPromise():Promise.reject(new Error("TrouterService has not been started"))},e.prototype.onStateChanged=function(e){if(this.logger.info("onStateChanged called"),void 0===e)this.stateChangedListeners=this.stateChangedListeners.filter((function(e){return void 0===e.wrappedCallback}));else{this.offStateChanged(e);var t=function(t,n){e(t,n?n.url:"")};t.wrappedCallback=e,this.stateChangedListeners.push(t)}},e.prototype.offStateChanged=function(e){this.logger.info("offStateChanged called");var t=this.stateChangedListeners.length;return this.stateChangedListeners=this.stateChangedListeners.filter((function(t){return t.wrappedCallback!==e})),t>this.stateChangedListeners.length},e.prototype.addCallback=function(e){this.logger.info("addListener called"),-1===this.stateChangedListeners.indexOf(e,0)&&void 0!==e&&this.stateChangedListeners.push(e)},e.prototype.removeCallback=function(e){this.logger.info("removeListener called");var t=this.stateChangedListeners.indexOf(e,0);return t>-1&&(this.stateChangedListeners.splice(t,1),!0)},e.prototype.registerMessageHandler=function(e){this.logger.info("registerMessageHandler is called"),this.messageHandlers.register(e)},e.prototype.clearMessageHandlers=function(){this.logger.info("clearMessageHandlers is called"),this.messageHandlers.clear()},e.prototype.notifyStateChanged=function(e,t){var n=this;this.logger.info("notifyStateChanged called, will forward to "+this.stateChangedListeners.length+" listeners"),this.stateChangedListeners.forEach((function(r){try{r(e,t)}catch(e){n.logger.error("Error in callback "+e)}}))},e.prototype.tryMessageHandlers=function(e,t){if(!this.messageHandlers.active())return!1;var n,r=null;try{r=(n=JSON.parse(e.body))&&(n.evt||n.eventId)||null}catch(e){}var o={eventId:r,url:(this.connectionInfo?this.connectionInfo.baseEndpointUrl:"")+e.path,body:n,rawBody:e.body,headers:e.headers},i=this.messageHandlers.handleMessage(o);return!!i.isHandled&&(t.status=i.resultCode,i.responseHeaders&&(t.headers=i.responseHeaders),i.responseBody&&(t.body=i.responseBody),t.send(),!0)},e}();t.TrouterService=m,t.createTrouterService=function(e){return new m(e)},t.getTrouterServiceVersion=function(){return c.CLIENT_VERSION},t.replaceTrouterUrlBase=function(e,t){var n=e.indexOf("://");if(n>=0){var r=e.indexOf("/",n+3);if(r>=0)return t+e.substr(r)}return""}},function(e,t){e.exports=n}]))}));s(u);var l=a((function(e,t){var n,r;t.__esModule=!0,t.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES=3,t.GCCHIGH_TROUTER_SERVICE_URL="https://go.trouter.gov.teams.microsoft.us/v4/a",t.GCCHIGH_REGISTRAR_SERVICE_URL="https://registrar.gov.teams.microsoft.us/V3/registrations",t.DOD_TROUTER_SERVICE_URL="https://go.trouter.dod.teams.microsoft.us/v4/a",t.DOD_REGISTRAR_SERVICE_URL="https://registrar.dod.teams.microsoft.us/V3/registrations",t.INT_TROUTER_SERVICE_URL="https://go.trouter-int.skype.net/v4/a",t.INT_REGISTRAR_SERVICE_URL="https://edge.skype.net/registrar/testenv/v3/registrations",t.PUBLIC_TROUTER_SERVICE_URL="https://go.trouter.skype.com/v4/a",t.PUBLIC_REGISTRAR_SERVICE_URL="https://edge.skype.com/registrar/prod/v3/registrations",(r=t.CloudType||(t.CloudType={})).Public="Public",r.GccHigh="GCC High",r.Dod="DoD",(n=t.CloudPrefix||(t.CloudPrefix={})).OrgId="orgid",n.Acs="acs",n.Spool="spool",n.GccHigh="gcch",n.GccHighAcs="gcch-acs",n.Dod="dod",n.DodAcs="dod-acs"}));s(l),l.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES,l.GCCHIGH_TROUTER_SERVICE_URL,l.GCCHIGH_REGISTRAR_SERVICE_URL,l.DOD_TROUTER_SERVICE_URL,l.DOD_REGISTRAR_SERVICE_URL,l.INT_TROUTER_SERVICE_URL,l.INT_REGISTRAR_SERVICE_URL,l.PUBLIC_TROUTER_SERVICE_URL,l.PUBLIC_REGISTRAR_SERVICE_URL,l.CloudType,l.CloudPrefix;var d=a((function(e,t){var n=i&&i.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},r=i&&i.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var s=new Map([["chatMessageReceived",200],["typingIndicatorReceived",245],["readReceiptReceived",246],["chatMessageEdited",247],["chatMessageDeleted",248],["chatThreadCreated",257],["chatThreadPropertiesUpdated",258],["chatThreadDeleted",259],["participantsAdded",260],["participantsRemoved",261]]),a="8:orgid:",c="8:dod:",u="8:gcch:",d="8:teamsvisitor:";t.toMessageHandler=function(e,t){var n=s.get(e);return{handleMessage:function(r){var o=null;if((null==r?void 0:r.rawBody)&&(o=JSON.parse(r.rawBody)),null!==o&&o.eventId===n){var i=p(e,o);if(null!==i)return t(i),{isHandled:!0,resultCode:200}}}}};var p=function(e,t){if("chatMessageReceived"===e)return{threadId:(n=t).groupId,sender:h(n.senderId),senderDisplayName:n.senderDisplayName,recipient:h(n.recipientMri),id:n.messageId,createdOn:new Date(n.originalArrivalTime),version:n.version,type:n.messageType,message:n.messageBody,metadata:f(n.acsChatMessageMetadata)};if("chatMessageEdited"===e)return{threadId:(n=t).groupId,sender:h(n.senderId),senderDisplayName:n.senderDisplayName,recipient:h(n.recipientMri),id:n.messageId,createdOn:new Date(n.originalArrivalTime),version:n.version,message:n.messageBody,editedOn:new Date(n.edittime),type:n.messageType,metadata:f(n.acsChatMessageMetadata)};if("chatMessageDeleted"===e)return{threadId:(n=t).groupId,sender:h(n.senderId),senderDisplayName:n.senderDisplayName,recipient:h(n.recipientMri),id:n.messageId,createdOn:new Date(n.originalArrivalTime),version:n.version,deletedOn:new Date(n.deletetime),type:n.messageType};if("typingIndicatorReceived"===e)return{threadId:(n=t).groupId,sender:h(n.senderId),senderDisplayName:n.senderDisplayName,recipient:h(n.recipientMri),version:n.version,receivedOn:new Date(n.originalArrivalTime)};if("readReceiptReceived"===e){var n=t,r=JSON.parse(n.messageBody).consumptionhorizon.split(";");return{threadId:n.groupId,sender:h(n.senderId),senderDisplayName:"",recipient:h(n.recipientMri),chatMessageId:n.messageId,readOn:new Date(+r[1])}}if("chatThreadCreated"===e){n=t;var o=JSON.parse(unescape(n.createdBy)),i=JSON.parse(unescape(n.members)),s=JSON.parse(unescape(n.properties)),a={id:h(o.participantId),displayName:o.displayName},c=i.map((function(e){return{id:h(e.participantId),displayName:e.displayName}}));return{threadId:n.threadId,createdOn:new Date(n.createTime),createdBy:a,version:n.version,participants:c,properties:s}}if("chatThreadPropertiesUpdated"===e){n=t;var u=JSON.parse(unescape(n.editedBy)),l=(s=JSON.parse(unescape(n.properties)),{id:h(u.participantId),displayName:u.displayName});return{threadId:n.threadId,updatedOn:new Date(n.editTime),updatedBy:l,version:n.version,properties:s}}if("chatThreadDeleted"===e){n=t;var d=JSON.parse(unescape(n.deletedBy)),p={id:h(d.participantId),displayName:d.displayName};return{threadId:n.threadId,deletedOn:new Date(n.deleteTime),deletedBy:p,version:n.version}}if("participantsAdded"===e){n=t;var m=JSON.parse(unescape(n.addedBy)),g=JSON.parse(unescape(n.participantsAdded)),y={id:h(m.participantId),displayName:m.displayName};return c=g.map((function(e){return{id:h(e.participantId),displayName:e.displayName,shareHistoryTime:new Date(e.shareHistoryTime)}})),{threadId:n.threadId,addedOn:new Date(n.time),addedBy:y,version:n.version,participantsAdded:c}}if("participantsRemoved"===e){n=t;var v=JSON.parse(unescape(n.removedBy)),b=JSON.parse(unescape(n.participantsRemoved)),T={id:h(v.participantId),displayName:v.displayName};return c=b.map((function(e){return{id:h(e.participantId),displayName:e.displayName,shareHistoryTime:new Date(e.shareHistoryTime)}})),{threadId:n.threadId,removedOn:new Date(n.time),removedBy:T,version:n.version,participantsRemoved:c}}return null};t.toLogProvider=function(e){return{log:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.info(t)},warn:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.warning(t)},error:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.error(t)},debug:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.verbose(t)},info:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.verbose(t)}}},t.toTelemetrySender=function(e){return{logEvent:function(t){return e.info(t)}}};var h=function(e){return e.startsWith(a)?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(a.length),isAnonymous:!1,cloud:"public"}:e.startsWith(c)?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(c.length),isAnonymous:!1,cloud:"dod"}:e.startsWith(u)?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(u.length),isAnonymous:!1,cloud:"gcch"}:e.startsWith(d)?{kind:"microsoftTeamsUser",rawId:e,microsoftTeamsUserId:e.substring(d.length),isAnonymous:!0}:e.startsWith("4:")?{kind:"phoneNumber",rawId:e,phoneNumber:e.substring("4:".length)}:e.startsWith("8:acs:")||e.startsWith("8:gcch-acs:")||e.startsWith("8:dod-acs:")||e.startsWith("8:spool:")?{kind:"communicationUser",communicationUserId:e}:{kind:"unknown",id:e}},f=function(e){return null==e||""===e||"null"===e?{}:JSON.parse(e)};function m(e){return o.isNode?Buffer.from(e,"base64").toString():atob(e)}function g(e){switch(e.substring(0,e.indexOf(":"))){case l.CloudPrefix.OrgId:case l.CloudPrefix.Acs:case l.CloudPrefix.Spool:return l.CloudType.Public;case l.CloudPrefix.GccHigh:case l.CloudPrefix.GccHighAcs:return l.CloudType.GccHigh;case l.CloudPrefix.Dod:case l.CloudPrefix.DodAcs:return l.CloudType.Dod;default:return l.CloudType.Public}}t.base64decode=m,t.getCloudTypeFromCredential=function(e){return n(void 0,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:return[4,e.getToken()];case 1:return t=r.sent(),n=null==t?void 0:t.token,[2,g(function(e){var t=(null==e?void 0:e.split("."))[1];if(void 0===t)throw new Error("Invalid token");return t=t.replace(/-/g,"+").replace(/_/g,"/"),JSON.parse(decodeURIComponent(escape(m(t))))}(n).skypeid)]}}))}))}}));s(d),d.toMessageHandler,d.toLogProvider,d.toTelemetrySender,d.base64decode,d.getCloudTypeFromCredential;var p=a((function(e,t){var n=i&&i.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},r=i&&i.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var s={version:"1.0.0",registrationId:"",sessionId:"",pnhAppId:"AcsWeb",pnhTemplate:"AcsWeb_Chat_1.2",platform:"SPOOL",platformUIVersion:"0.0.0",environment:"",productName:"acs-chat-web",trouterServiceUrl:l.PUBLIC_TROUTER_SERVICE_URL,registrarServiceUrl:l.PUBLIC_REGISTRAR_SERVICE_URL,registrarRefreshTimeoutInMs:35e4,timeoutOptions:{connectionTimeoutMs:2e4,fetchTimeoutMs:1e4,pingTimeoutMs:4e4,pongTimeoutMs:5e3,maxBackoffMs:5e4,requestTimeoutMs:5e3},maxRegistrationTimeInMs:72e5},a=function(){var e=s;return e.registrationId=o.generateUuid(),e.sessionId=o.generateUuid(),e};t.createSettings=function(e,t){return n(void 0,void 0,void 0,(function(){var n,o,i;return r(this,(function(r){switch(r.label){case 0:return"INT"!==(null==t?void 0:t.environment)?[3,1]:(n=function(){var e=a();return e.pnhAppId="cns-e2e-test",e.pnhTemplate="cns-e2e-test:1.2",e.registrarServiceUrl=l.INT_REGISTRAR_SERVICE_URL,e.trouterServiceUrl=l.INT_TROUTER_SERVICE_URL,e}(),[3,3]);case 1:return[4,d.getCloudTypeFromCredential(e)];case 2:o=r.sent(),n=o===l.CloudType.GccHigh?function(){var e=a();return e.registrarServiceUrl=l.GCCHIGH_REGISTRAR_SERVICE_URL,e.trouterServiceUrl=l.GCCHIGH_TROUTER_SERVICE_URL,e}():o===l.CloudType.Dod?function(){var e=a();return e.registrarServiceUrl=l.DOD_REGISTRAR_SERVICE_URL,e.trouterServiceUrl=l.DOD_TROUTER_SERVICE_URL,e}():a(),r.label=3;case 3:return n.maxRegistrationTimeInMs=null!==(i=null==t?void 0:t.registrationTimeInMs)&&void 0!==i?i:s.maxRegistrationTimeInMs,[2,n]}}))}))},t.defaultTelemetrySettings={enabled:!1}}));s(p),p.createSettings,p.defaultTelemetrySettings;var h=a((function(e,t){var n=i&&i.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},r=i&&i.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var o=function(){function e(e,t,n){this.credential=e,this.logger=t,this.options=n,this.stateChangedListener=null,this.tokenFetchRetries=0,this.trouter=u.createTrouterService(d.toLogProvider(t))}return e.prototype.start=function(){return n(this,void 0,void 0,(function(){var e,t,o=this;return r(this,(function(i){switch(i.label){case 0:return void 0!==this.config?[3,2]:(e=this,t={},[4,p.createSettings(this.credential,this.options)]);case 1:e.config=(t.trouterSettings=i.sent(),t.skypeTokenProvider=function(e){return n(o,void 0,void 0,(function(){var t,n;return r(this,(function(r){switch(r.label){case 0:return e?(this.tokenFetchRetries+=1,this.tokenFetchRetries>l.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES?[4,this.stop(!0)]:[3,2]):[3,3];case 1:throw r.sent(),new Error("Access token is expired and failed to fetch a valid one after "+l.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES+" retries");case 2:return[3,4];case 3:this.tokenFetchRetries=0,r.label=4;case 4:return n=(t=Promise).resolve,[4,this.credential.getToken()];case 5:return[2,n.apply(t,[r.sent().token])]}}))}))},t.telemetryConfig={eventLogger:d.toTelemetrySender(this.logger),settings:p.defaultTelemetrySettings},t),i.label=2;case 2:return this.trouter.start(this.config),this.trouter.setUserActivityState(u.UserActivityState.Active),[2]}}))}))},e.prototype.stop=function(e){return n(this,void 0,void 0,(function(){return r(this,(function(t){return this.trouter.offStateChanged(this.stateChangedListener),this.trouter.clearMessageHandlers(),this.trouter.stop(null!=e?e:this.tokenFetchRetries>l.MAX_NUMBER_OF_TOKEN_FETCH_RETRIES),[2]}))}))},e.prototype.on=function(e,t){if("connectionChanged"===e)return this.trouter.offStateChanged(this.stateChangedListener),this.stateChangedListener=function(e,n){return t(e)},void this.trouter.onStateChanged(this.stateChangedListener);this.trouter.registerMessageHandler(d.toMessageHandler(e,t))},e}();t.CommunicationSignalingClient=o}));s(h),h.CommunicationSignalingClient;var f=s(a((function(e,t){t.__esModule=!0,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(h)})));e.exports=f},696:(e,t,n)=>{function r(e){return e.toLowerCase()}function o(e){if(e&&"object"==typeof e){const t=e;if("function"==typeof t.rawHeaders&&"function"==typeof t.clone&&"function"==typeof t.get&&"function"==typeof t.set&&"function"==typeof t.contains&&"function"==typeof t.remove&&"function"==typeof t.headersArray&&"function"==typeof t.headerValues&&"function"==typeof t.headerNames&&"function"==typeof t.toJson)return!0}return!1}n.r(t),n.d(t,{AccessTokenRefresher:()=>zt,ApiKeyCredentials:()=>Ht,BaseRequestPolicy:()=>ae,BasicAuthenticationCredentials:()=>Bt,Constants:()=>De,DefaultHttpClient:()=>te,ExpiringAccessTokenCache:()=>Lt,HttpHeaders:()=>i,HttpPipelineLogLevel:()=>ie,MapperType:()=>q,QueryCollectionFormat:()=>et,RequestPolicyOptions:()=>ce,RestError:()=>ee,RetryMode:()=>$e,Serializer:()=>k,ServiceClient:()=>Mt,TopicCredentials:()=>Ft,URLBuilder:()=>L,URLQuery:()=>j,WebResource:()=>U,XML_ATTRKEY:()=>c,XML_CHARKEY:()=>u,applyMixins:()=>w,bearerTokenAuthenticationPolicy:()=>rt,createPipelineFromOptions:()=>_t,createSpanFunction:()=>jt,delay:()=>je,deserializationPolicy:()=>ve,deserializeResponseBody:()=>Ce,disableResponseDecompressionPolicy:()=>it,encodeUri:()=>h,executePromisesSequentially:()=>v,exponentialRetryPolicy:()=>ze,flattenResponse:()=>Dt,generateClientRequestIdPolicy:()=>st,generateUuid:()=>y,getDefaultProxySettings:()=>dt,getDefaultUserAgentValue:()=>We,isDuration:()=>C,isNode:()=>p,isTokenCredential:()=>Ke,isValidUuid:()=>g,keepAlivePolicy:()=>ke,logPolicy:()=>Ve,operationOptionsToRequestOptionsBase:()=>se,parseXML:()=>de,promiseToCallback:()=>b,promiseToServiceCallback:()=>T,proxyPolicy:()=>pt,redirectPolicy:()=>Ie,serializeObject:()=>A,signingPolicy:()=>gt,stringifyXML:()=>me,stripRequest:()=>m,stripResponse:()=>f,systemErrorRetryPolicy:()=>vt,throttlingRetryPolicy:()=>Rt,tracingPolicy:()=>It,userAgentPolicy:()=>Ye});class i{constructor(e){if(this._headersMap={},e)for(const t in e)this.set(t,e[t])}set(e,t){this._headersMap[r(e)]={name:e,value:t.toString()}}get(e){const t=this._headersMap[r(e)];return t?t.value:void 0}contains(e){return!!this._headersMap[r(e)]}remove(e){const t=this.contains(e);return delete this._headersMap[r(e)],t}rawHeaders(){return this.toJson({preserveCase:!0})}headersArray(){const e=[];for(const t in this._headersMap)e.push(this._headersMap[t]);return e}headerNames(){const e=[],t=this.headersArray();for(let n=0;n<t.length;++n)e.push(t[n].name);return e}headerValues(){const e=[],t=this.headersArray();for(let n=0;n<t.length;++n)e.push(t[n].value);return e}toJson(e={}){const t={};if(e.preserveCase)for(const e in this._headersMap){const n=this._headersMap[e];t[n.name]=n.value}else for(const e in this._headersMap){const n=this._headersMap[e];t[r(n.name)]=n.value}return t}toString(){return JSON.stringify(this.toJson({preserveCase:!0}))}clone(){const e={};for(const t in this._headersMap){const n=this._headersMap[t];e[n.name]=n.value}return new i(e)}}function s(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function a(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}const c="$",u="_";var l=n(586);const d=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i,p="undefined"!=typeof process&&!!process.version&&!!process.versions&&!!process.versions.node;function h(e){return encodeURIComponent(e).replace(/!/g,"%21").replace(/"/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")}function f(e){const t={};return t.body=e.bodyAsText,t.headers=e.headers,t.status=e.status,t}function m(e){const t=e.clone();return t.headers&&t.headers.remove("authorization"),t}function g(e){return d.test(e)}function y(){return(0,l.Z)()}function v(e,t){let n=Promise.resolve(t);return e.forEach((e=>{n=n.then(e)})),n}function b(e){if("function"!=typeof e.then)throw new Error("The provided input is not a Promise.");return t=>{e.then((e=>t(void 0,e))).catch((e=>{t(e)}))}}function T(e){if("function"!=typeof e.then)throw new Error("The provided input is not a Promise.");return t=>{e.then((e=>process.nextTick(t,void 0,e.parsedBody,e.request,e))).catch((e=>{process.nextTick(t,e)}))}}function w(e,t){const n=e;t.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((t=>{n.prototype[t]=e.prototype[t]}))}))}const R=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function C(e){return R.test(e)}function S(e,t,n){return e&&t?e.split(t).join(n||""):e}class k{constructor(e={},t){this.modelMappers=e,this.isXML=t}validateConstraints(e,t,n){const r=(e,r)=>{throw new Error(`"${n}" with value "${t}" should satisfy the constraint "${e}": ${r}.`)};if(e.constraints&&null!=t){const n=t,{ExclusiveMaximum:o,ExclusiveMinimum:i,InclusiveMaximum:s,InclusiveMinimum:a,MaxItems:c,MaxLength:u,MinItems:l,MinLength:d,MultipleOf:p,Pattern:h,UniqueItems:f}=e.constraints;null!=o&&n>=o&&r("ExclusiveMaximum",o),null!=i&&n<=i&&r("ExclusiveMinimum",i),null!=s&&n>s&&r("InclusiveMaximum",s),null!=a&&n<a&&r("InclusiveMinimum",a);const m=t;if(null!=c&&m.length>c&&r("MaxItems",c),null!=u&&m.length>u&&r("MaxLength",u),null!=l&&m.length<l&&r("MinItems",l),null!=d&&m.length<d&&r("MinLength",d),null!=p&&n%p!=0&&r("MultipleOf",p),h){const e="string"==typeof h?new RegExp(h):h;"string"==typeof t&&null!==t.match(e)||r("Pattern",h)}f&&m.some(((e,t,n)=>n.indexOf(e)!==t))&&r("UniqueItems",f)}}serialize(e,t,n,r={}){var o,i,a;const l={rootName:null!==(o=r.rootName)&&void 0!==o?o:"",includeRoot:null!==(i=r.includeRoot)&&void 0!==i&&i,xmlCharKey:null!==(a=r.xmlCharKey)&&void 0!==a?a:u};let d={};const p=e.type.name;n||(n=e.serializedName),null!==p.match(/^Sequence$/i)&&(d=[]),e.isConstant&&(t=e.defaultValue);const{required:h,nullable:f}=e;if(h&&f&&void 0===t)throw new Error(`${n} cannot be undefined.`);if(h&&!f&&null==t)throw new Error(`${n} cannot be null or undefined.`);if(!h&&!1===f&&null===t)throw new Error(`${n} cannot be null.`);return null==t?d=t:(this.validateConstraints(e,t,n),null!==p.match(/^any$/i)?d=t:null!==p.match(/^(Number|String|Boolean|Object|Stream|Uuid)$/i)?d=function(e,t,n){if(null!=n)if(null!==e.match(/^Number$/i)){if("number"!=typeof n)throw new Error(`${t} with value ${n} must be of type number.`)}else if(null!==e.match(/^String$/i)){if("string"!=typeof n.valueOf())throw new Error(`${t} with value "${n}" must be of type string.`)}else if(null!==e.match(/^Uuid$/i)){if("string"!=typeof n.valueOf()||!g(n))throw new Error(`${t} with value "${n}" must be of type string and a valid uuid.`)}else if(null!==e.match(/^Boolean$/i)){if("boolean"!=typeof n)throw new Error(`${t} with value ${n} must be of type boolean.`)}else if(null!==e.match(/^Stream$/i)){const e=typeof n;if(!("string"===e||"function"===e||n instanceof ArrayBuffer||ArrayBuffer.isView(n)||("function"==typeof Blob||"object"==typeof Blob)&&n instanceof Blob))throw new Error(`${t} must be a string, Blob, ArrayBuffer, ArrayBufferView, or a function returning NodeJS.ReadableStream.`)}return n}(p,n,t):null!==p.match(/^Enum$/i)?d=function(e,t,n){if(!t)throw new Error(`Please provide a set of allowedValues to validate ${e} as an Enum Type.`);if(!t.some((e=>"string"==typeof e.valueOf()?e.toLowerCase()===n.toLowerCase():e===n)))throw new Error(`${n} is not a valid value for ${e}. The valid values are: ${JSON.stringify(t)}.`);return n}(n,e.type.allowedValues,t):null!==p.match(/^(Date|DateTime|TimeSpan|DateTimeRfc1123|UnixTime)$/i)?d=function(e,t,n){if(null!=t)if(null!==e.match(/^Date$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in ISO8601 format.`);t=t instanceof Date?t.toISOString().substring(0,10):new Date(t).toISOString().substring(0,10)}else if(null!==e.match(/^DateTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in ISO8601 format.`);t=t instanceof Date?t.toISOString():new Date(t).toISOString()}else if(null!==e.match(/^DateTimeRfc1123$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in RFC-1123 format.`);t=t instanceof Date?t.toUTCString():new Date(t).toUTCString()}else if(null!==e.match(/^UnixTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in RFC-1123/ISO8601 format for it to be serialized in UnixTime/Epoch format.`);t=function(e){if(e)return"string"==typeof e.valueOf()&&(e=new Date(e)),Math.floor(e.getTime()/1e3)}(t)}else if(null!==e.match(/^TimeSpan$/i)&&!C(t))throw new Error(`${n} must be a string in ISO 8601 format. Instead was "${t}".`);return t}(p,t,n):null!==p.match(/^ByteArray$/i)?d=function(e,t){let n="";if(null!=t){if(!(t instanceof Uint8Array))throw new Error(`${e} must be of type Uint8Array.`);n=s(t)}return n}(n,t):null!==p.match(/^Base64Url$/i)?d=function(e,t){let n="";if(null!=t){if(!(t instanceof Uint8Array))throw new Error(`${e} must be of type Uint8Array.`);n=function(e){if(e){if(!(e instanceof Uint8Array))throw new Error("Please provide an input of type Uint8Array for converting to Base64Url.");return function(e,t){let n=e.length;for(;n-1>=0&&"="===e[n-1];)--n;return e.substr(0,n)}(s(e)).replace(/\+/g,"-").replace(/\//g,"_")}}(t)||""}return n}(n,t):null!==p.match(/^Sequence$/i)?d=function(e,t,n,r,o,i){if(!Array.isArray(n))throw new Error(`${r} must be of type Array.`);const s=t.type.element;if(!s||"object"!=typeof s)throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}.`);const a=[];for(let t=0;t<n.length;t++){const u=e.serialize(s,n[t],r,i);if(o&&s.xmlNamespace){const e=s.xmlNamespacePrefix?`xmlns:${s.xmlNamespacePrefix}`:"xmlns";"Composite"===s.type.name?(a[t]=Object.assign({},u),a[t][c]={[e]:s.xmlNamespace}):(a[t]={},a[t][i.xmlCharKey]=u,a[t][c]={[e]:s.xmlNamespace})}else a[t]=u}return a}(this,e,t,n,Boolean(this.isXML),l):null!==p.match(/^Dictionary$/i)?d=function(e,t,n,r,o,i){if("object"!=typeof n)throw new Error(`${r} must be of type object.`);const s=t.type.value;if(!s||"object"!=typeof s)throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}.`);const a={};for(const t of Object.keys(n)){const c=e.serialize(s,n[t],r,i);a[t]=I(s,c,o,i)}if(o&&t.xmlNamespace){const e=t.xmlNamespacePrefix?`xmlns:${t.xmlNamespacePrefix}`:"xmlns",n=a;return n[c]={[e]:t.xmlNamespace},n}return a}(this,e,t,n,Boolean(this.isXML),l):null!==p.match(/^Composite$/i)&&(d=function(e,t,n,r,o,i){if(N(e,t)&&(t=M(e,t,n,"clientName")),null!=n){const s={},a=P(e,t,r);for(const u of Object.keys(a)){const l=a[u];if(l.readOnly)continue;let d,p=s;if(e.isXML)d=l.xmlIsWrapped?l.xmlName:l.xmlElementName||l.xmlName;else{const e=E(l.serializedName);d=e.pop();for(const t of e)null!=p[t]||null==n[u]&&void 0===l.defaultValue||(p[t]={}),p=p[t]}if(null!=p){if(o&&t.xmlNamespace){const e=t.xmlNamespacePrefix?`xmlns:${t.xmlNamespacePrefix}`:"xmlns";p[c]=Object.assign(Object.assign({},p[c]),{[e]:t.xmlNamespace})}const s=""!==l.serializedName?r+"."+l.serializedName:r;let a=n[u];const h=N(e,t);h&&h.clientName===u&&null==a&&(a=t.serializedName);const f=e.serialize(l,a,s,i);if(void 0!==f&&null!=d){const e=I(l,f,o,i);o&&l.xmlIsAttribute?(p[c]=p[c]||{},p[c][d]=f):o&&l.xmlIsWrapped?p[d]={[l.xmlElementName]:e}:p[d]=e}}}const u=function(e,t,n){const r=t.type.additionalProperties;if(!r&&t.type.className){const r=O(e,t,n);return null==r?void 0:r.type.additionalProperties}return r}(e,t,r);if(u){const t=Object.keys(a);for(const o in n)t.every((e=>e!==o))&&(s[o]=e.serialize(u,n[o],r+'["'+o+'"]',i))}return s}return n}(this,e,t,n,Boolean(this.isXML),l))),d}deserialize(e,t,n,r={}){var o,i,s;const l={rootName:null!==(o=r.rootName)&&void 0!==o?o:"",includeRoot:null!==(i=r.includeRoot)&&void 0!==i&&i,xmlCharKey:null!==(s=r.xmlCharKey)&&void 0!==s?s:u};if(null==t)return this.isXML&&"Sequence"===e.type.name&&!e.xmlIsWrapped&&(t=[]),void 0!==e.defaultValue&&(t=e.defaultValue),t;let d;const p=e.type.name;if(n||(n=e.serializedName),null!==p.match(/^Composite$/i))d=function(e,t,n,r,o){var i;N(e,t)&&(t=M(e,t,n,"serializedName"));const s=P(e,t,r);let a={};const u=[];for(const l of Object.keys(s)){const d=s[l],p=E(s[l].serializedName);u.push(p[0]);const{serializedName:h,xmlName:f,xmlElementName:m}=d;let g=r;""!==h&&void 0!==h&&(g=r+"."+h);const y=d.headerCollectionPrefix;if(y){const t={};for(const r of Object.keys(n))r.startsWith(y)&&(t[r.substring(y.length)]=e.deserialize(d.type.value,n[r],g,o)),u.push(r);a[l]=t}else if(e.isXML)if(d.xmlIsAttribute&&n[c])a[l]=e.deserialize(d,n[c][f],g,o);else{const t=m||f||h;if(d.xmlIsWrapped){const t=n[f],r=null!==(i=null==t?void 0:t[m])&&void 0!==i?i:[];a[l]=e.deserialize(d,r,g,o)}else{const r=n[t];a[l]=e.deserialize(d,r,g,o)}}else{let r,i=n;for(const e of p){if(!i)break;i=i[e]}r=i;const c=t.type.polymorphicDiscriminator;let u;if(c&&l===c.clientName&&null==r&&(r=t.serializedName),Array.isArray(n[l])&&""===s[l].serializedName){r=n[l];const t=e.deserialize(d,r,g,o);for(const[e,n]of Object.entries(a))Object.prototype.hasOwnProperty.call(t,e)||(t[e]=n);a=t}else void 0===r&&void 0===d.defaultValue||(u=e.deserialize(d,r,g,o),a[l]=u)}}const l=t.type.additionalProperties;if(l){const t=e=>{for(const t in s)if(E(s[t].serializedName)[0]===e)return!1;return!0};for(const i in n)t(i)&&(a[i]=e.deserialize(l,n[i],r+'["'+i+'"]',o))}else if(n)for(const e of Object.keys(n))void 0!==a[e]||u.includes(e)||x(e,o)||(a[e]=n[e]);return a}(this,e,t,n,l);else{if(this.isXML){const e=l.xmlCharKey,n=t;null!=n[c]&&null!=n[e]&&(t=n[e])}null!==p.match(/^Number$/i)?(d=parseFloat(t),isNaN(d)&&(d=t)):null!==p.match(/^Boolean$/i)?d="true"===t||"false"!==t&&t:null!==p.match(/^(String|Enum|Object|Stream|Uuid|TimeSpan|any)$/i)?d=t:null!==p.match(/^(Date|DateTime|DateTimeRfc1123)$/i)?d=new Date(t):null!==p.match(/^UnixTime$/i)?d=function(e){if(e)return new Date(1e3*e)}(t):null!==p.match(/^ByteArray$/i)?d=a(t):null!==p.match(/^Base64Url$/i)?d=function(e){if(e){if(e&&"string"!=typeof e.valueOf())throw new Error("Please provide an input of type string for converting to Uint8Array");return a(e=e.replace(/-/g,"+").replace(/_/g,"/"))}}(t):null!==p.match(/^Sequence$/i)?d=function(e,t,n,r,o){const i=t.type.element;if(!i||"object"!=typeof i)throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}`);if(n){Array.isArray(n)||(n=[n]);const t=[];for(let s=0;s<n.length;s++)t[s]=e.deserialize(i,n[s],`${r}[${s}]`,o);return t}return n}(this,e,t,n,l):null!==p.match(/^Dictionary$/i)&&(d=function(e,t,n,r,o){const i=t.type.value;if(!i||"object"!=typeof i)throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}`);if(n){const t={};for(const s of Object.keys(n))t[s]=e.deserialize(i,n[s],r,o);return t}return n}(this,e,t,n,l))}return e.isConstant&&(d=e.defaultValue),d}}function E(e){const t=[];let n="";if(e){const r=e.split(".");for(const e of r)"\\"===e.charAt(e.length-1)?n+=e.substr(0,e.length-1)+".":(n+=e,t.push(n),n="")}return t}function O(e,t,n){const r=t.type.className;if(!r)throw new Error(`Class name for model "${n}" is not provided in the mapper "${JSON.stringify(t,void 0,2)}".`);return e.modelMappers[r]}function P(e,t,n){let r=t.type.modelProperties;if(!r){const o=O(e,t,n);if(!o)throw new Error(`mapper() cannot be null or undefined for model "${t.type.className}".`);if(r=null==o?void 0:o.type.modelProperties,!r)throw new Error(`modelProperties cannot be null or undefined in the mapper "${JSON.stringify(o)}" of type "${t.type.className}" for object "${n}".`)}return r}function I(e,t,n,r){if(!n||!e.xmlNamespace)return t;const o={[e.xmlNamespacePrefix?`xmlns:${e.xmlNamespacePrefix}`:"xmlns"]:e.xmlNamespace};if(["Composite"].includes(e.type.name)){if(t[c])return t;{const e=Object.assign({},t);return e[c]=o,e}}const i={};return i[r.xmlCharKey]=t,i[c]=o,i}function x(e,t){return[c,t.xmlCharKey].includes(e)}function M(e,t,n,r){const o=N(e,t);if(o){const i=o[r];if(null!=i){const r=n[i];if(null!=r){const n=t.type.uberParent||t.type.className,o=r===n?r:n+"."+r,i=e.modelMappers.discriminators[o];i&&(t=i)}}}return t}function N(e,t){return t.type.polymorphicDiscriminator||_(e,t.type.uberParent)||_(e,t.type.className)}function _(e,t){return t&&e.modelMappers[t]&&e.modelMappers[t].type.polymorphicDiscriminator}function A(e){const t=e;if(null!=e){if(e instanceof Uint8Array)return s(e);if(e instanceof Date)return e.toISOString();if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++)t.push(A(e[n]));return t}if("object"==typeof e){const n={};for(const r in e)n[r]=A(t[r]);return n}return e}}const q=function(e){const t={};for(const e of["Base64Url","Boolean","ByteArray","Composite","Date","DateTime","DateTimeRfc1123","Dictionary","Enum","Number","Object","Sequence","String","Stream","TimeSpan","UnixTime"])t[e]=e;return t}();class U{constructor(e,t,n,r,s,a,c,u,l,d,p,h,f,m,g){this.streamResponseBody=a,this.streamResponseStatusCodes=g,this.url=e||"",this.method=t||"GET",this.headers=o(s)?s:new i(s),this.body=n,this.query=r,this.formData=void 0,this.withCredentials=c||!1,this.abortSignal=u,this.timeout=l||0,this.onUploadProgress=d,this.onDownloadProgress=p,this.proxySettings=h,this.keepAlive=f,this.decompressResponse=m,this.requestId=this.headers.get("x-ms-client-request-id")||y()}validateRequestProperties(){if(!this.method)throw new Error("WebResource.method is required.");if(!this.url)throw new Error("WebResource.url is required.")}prepare(e){if(!e)throw new Error("options object is required");if(void 0===e.method||null===e.method||"string"!=typeof e.method.valueOf())throw new Error("options.method must be a string.");if(e.url&&e.pathTemplate)throw new Error("options.url and options.pathTemplate are mutually exclusive. Please provide exactly one of them.");if(!(void 0!==e.pathTemplate&&null!==e.pathTemplate&&"string"==typeof e.pathTemplate.valueOf()||void 0!==e.url&&null!==e.url&&"string"==typeof e.url.valueOf()))throw new Error("Please provide exactly one of options.pathTemplate or options.url.");if(e.url){if("string"!=typeof e.url)throw new Error('options.url must be of type "string".');this.url=e.url}if(e.method){const t=["GET","PUT","HEAD","DELETE","OPTIONS","POST","PATCH","TRACE"];if(-1===t.indexOf(e.method.toUpperCase()))throw new Error('The provided method "'+e.method+'" is invalid. Supported HTTP methods are: '+JSON.stringify(t))}if(this.method=e.method.toUpperCase(),e.pathTemplate){const{pathTemplate:t,pathParameters:n}=e;if("string"!=typeof t)throw new Error('options.pathTemplate must be of type "string".');e.baseUrl||(e.baseUrl="https://management.azure.com");const r=e.baseUrl;let o=r+(r.endsWith("/")?"":"/")+(t.startsWith("/")?t.slice(1):t);const i=o.match(/({[\w-]*\s*[\w-]*})/gi);if(i&&i.length){if(!n)throw new Error(`pathTemplate: ${t} has been provided. Hence, options.pathParameters must also be provided.`);i.forEach((function(e){const r=e.slice(1,-1),i=n[r];if(null==i||"string"!=typeof i&&"object"!=typeof i){const e=JSON.stringify(n,void 0,2);throw new Error(`pathTemplate: ${t} contains the path parameter ${r} however, it is not present in parameters: ${e}.The value of the path parameter can either be a "string" of the form { ${r}: "some sample value" } or it can be an "object" of the form { "${r}": { value: "some sample value", skipUrlEncoding: true } }.`)}if("string"==typeof i.valueOf()&&(o=o.replace(e,encodeURIComponent(i))),"object"==typeof i.valueOf()){if(!i.value)throw new Error(`options.pathParameters[${r}] is of type "object" but it does not contain a "value" property.`);o=i.skipUrlEncoding?o.replace(e,i.value):o.replace(e,encodeURIComponent(i.value))}}))}this.url=o}if(e.queryParameters){const t=e.queryParameters;if("object"!=typeof t)throw new Error('options.queryParameters must be of type object. It should be a JSON object of "query-parameter-name" as the key and the "query-parameter-value" as the value. The "query-parameter-value" may be fo type "string" or an "object" of the form { value: "query-parameter-value", skipUrlEncoding: true }.');this.url&&-1===this.url.indexOf("?")&&(this.url+="?");const n=[];this.query={};for(const e in t){const r=t[e];if(r)if("string"==typeof r)n.push(e+"="+encodeURIComponent(r)),this.query[e]=encodeURIComponent(r);else if("object"==typeof r){if(!r.value)throw new Error(`options.queryParameters[${e}] is of type "object" but it does not contain a "value" property.`);r.skipUrlEncoding?(n.push(e+"="+r.value),this.query[e]=r.value):(n.push(e+"="+encodeURIComponent(r.value)),this.query[e]=encodeURIComponent(r.value))}}this.url+=n.join("&")}if(e.headers){const t=e.headers;for(const n of Object.keys(e.headers))this.headers.set(n,t[n])}return this.headers.get("accept-language")||this.headers.set("accept-language","en-US"),this.headers.get("x-ms-client-request-id")||e.disableClientRequestId||this.headers.set("x-ms-client-request-id",this.requestId),this.headers.get("Content-Type")||this.headers.set("Content-Type","application/json; charset=utf-8"),this.body=e.body,void 0!==e.body&&null!==e.body&&(e.bodyIsStream?(this.headers.get("Transfer-Encoding")||this.headers.set("Transfer-Encoding","chunked"),"application/octet-stream"!==this.headers.get("Content-Type")&&this.headers.set("Content-Type","application/octet-stream")):(e.serializationMapper&&(this.body=new k(e.mappers).serialize(e.serializationMapper,e.body,"requestBody")),e.disableJsonStringifyOnBody||(this.body=JSON.stringify(e.body)))),e.spanOptions&&(this.spanOptions=e.spanOptions),e.tracingContext&&(this.tracingContext=e.tracingContext),this.abortSignal=e.abortSignal,this.onDownloadProgress=e.onDownloadProgress,this.onUploadProgress=e.onUploadProgress,this}clone(){const e=new U(this.url,this.method,this.body,this.query,this.headers&&this.headers.clone(),this.streamResponseBody,this.withCredentials,this.abortSignal,this.timeout,this.onUploadProgress,this.onDownloadProgress,this.proxySettings,this.keepAlive,this.decompressResponse,this.streamResponseStatusCodes);return this.formData&&(e.formData=this.formData),this.operationSpec&&(e.operationSpec=this.operationSpec),this.shouldDeserialize&&(e.shouldDeserialize=this.shouldDeserialize),this.operationResponseGetter&&(e.operationResponseGetter=this.operationResponseGetter),e}}var D=n(679);class j{constructor(){this._rawQuery={}}any(){return Object.keys(this._rawQuery).length>0}keys(){return Object.keys(this._rawQuery)}set(e,t){const n=t;if(e)if(null!=n){const t=Array.isArray(n)?n:n.toString();this._rawQuery[e]=t}else delete this._rawQuery[e]}get(e){return e?this._rawQuery[e]:void 0}toString(){let e="";for(const t in this._rawQuery){e&&(e+="&");const n=this._rawQuery[t];if(Array.isArray(n)){const r=[];for(const e of n)r.push(`${t}=${e}`);e+=r.join("&")}else e+=`${t}=${n}`}return e}static parse(e){const t=new j;if(e){e.startsWith("?")&&(e=e.substring(1));let n="ParameterName",r="",o="";for(let i=0;i<e.length;++i){const s=e[i];switch(n){case"ParameterName":switch(s){case"=":n="ParameterValue";break;case"&":r="",o="";break;default:r+=s}break;case"ParameterValue":"&"===s?(t.set(r,o),r="",o="",n="ParameterName"):o+=s;break;default:throw new Error("Unrecognized URLQuery parse state: "+n)}}"ParameterValue"===n&&t.set(r,o)}return t}}class L{setScheme(e){e?this.set(e,"SCHEME"):this._scheme=void 0}getScheme(){return this._scheme}setHost(e){e?this.set(e,"SCHEME_OR_HOST"):this._host=void 0}getHost(){return this._host}setPort(e){null==e||""===e?this._port=void 0:this.set(e.toString(),"PORT")}getPort(){return this._port}setPath(e){if(e){const t=e.indexOf("://");if(-1!==t){const n=e.lastIndexOf("/",t);this.set(-1===n?e:e.substr(n+1),"SCHEME")}else this.set(e,"PATH")}else this._path=void 0}appendPath(e){if(e){let t=this.getPath();t&&(t.endsWith("/")||(t+="/"),e.startsWith("/")&&(e=e.substring(1)),e=t+e),this.set(e,"PATH")}}getPath(){return this._path}setQuery(e){this._query=e?j.parse(e):void 0}setQueryParameter(e,t){e&&(this._query||(this._query=new j),this._query.set(e,t))}getQueryParameterValue(e){return this._query?this._query.get(e):void 0}getQuery(){return this._query?this._query.toString():void 0}set(e,t){const n=new $(e,t);for(;n.next();){const e=n.current();let t;if(e)switch(e.type){case"SCHEME":this._scheme=e.text||void 0;break;case"HOST":this._host=e.text||void 0;break;case"PORT":this._port=e.text||void 0;break;case"PATH":t=e.text||void 0,this._path&&"/"!==this._path&&"/"===t||(this._path=t);break;case"QUERY":this._query=j.parse(e.text);break;default:throw new Error(`Unrecognized URLTokenType: ${e.type}`)}}}toString(){let e="";return this._scheme&&(e+=`${this._scheme}://`),this._host&&(e+=this._host),this._port&&(e+=`:${this._port}`),this._path&&(this._path.startsWith("/")||(e+="/"),e+=this._path),this._query&&this._query.any()&&(e+=`?${this._query.toString()}`),e}replaceAll(e,t){e&&(this.setScheme(S(this.getScheme(),e,t)),this.setHost(S(this.getHost(),e,t)),this.setPort(S(this.getPort(),e,t)),this.setPath(S(this.getPath(),e,t)),this.setQuery(S(this.getQuery(),e,t)))}static parse(e){const t=new L;return t.set(e,"SCHEME_OR_HOST"),t}}class z{constructor(e,t){this.text=e,this.type=t}static scheme(e){return new z(e,"SCHEME")}static host(e){return new z(e,"HOST")}static port(e){return new z(e,"PORT")}static path(e){return new z(e,"PATH")}static query(e){return new z(e,"QUERY")}}class ${constructor(e,t){this._text=e,this._textLength=e?e.length:0,this._currentState=null!=t?t:"SCHEME_OR_HOST",this._currentIndex=0}current(){return this._currentToken}next(){if(B(this))switch(this._currentState){case"SCHEME":!function(e){const t=function(e){return G(e,(e=>function(e){const t=e.charCodeAt(0);return 48<=t&&t<=57||65<=t&&t<=90||97<=t&&t<=122}(e)))}(e);e._currentToken=z.scheme(t),B(e)?e._currentState="HOST":e._currentState="DONE"}(this);break;case"SCHEME_OR_HOST":!function(e){const t=J(e,":","/","?");B(e)?":"===H(e)?"://"===V(e,3)?(e._currentToken=z.scheme(t),e._currentState="HOST"):(e._currentToken=z.host(t),e._currentState="PORT"):(e._currentToken=z.host(t),"/"===H(e)?e._currentState="PATH":e._currentState="QUERY"):(e._currentToken=z.host(t),e._currentState="DONE")}(this);break;case"HOST":!function(e){"://"===V(e,3)&&F(e,3);const t=J(e,":","/","?");e._currentToken=z.host(t),B(e)?":"===H(e)?e._currentState="PORT":"/"===H(e)?e._currentState="PATH":e._currentState="QUERY":e._currentState="DONE"}(this);break;case"PORT":!function(e){":"===H(e)&&F(e);const t=J(e,"/","?");e._currentToken=z.port(t),B(e)?"/"===H(e)?e._currentState="PATH":e._currentState="QUERY":e._currentState="DONE"}(this);break;case"PATH":!function(e){const t=J(e,"?");e._currentToken=z.path(t),B(e)?e._currentState="QUERY":e._currentState="DONE"}(this);break;case"QUERY":!function(e){"?"===H(e)&&F(e);const t=function(e){let t="";return e._currentIndex<e._textLength&&(t=e._text.substring(e._currentIndex),e._currentIndex=e._textLength),t}(e);e._currentToken=z.query(t),e._currentState="DONE"}(this);break;default:throw new Error(`Unrecognized URLTokenizerState: ${this._currentState}`)}else this._currentToken=void 0;return!!this._currentToken}}function B(e){return e._currentIndex<e._textLength}function H(e){return e._text[e._currentIndex]}function F(e,t){B(e)&&(t||(t=1),e._currentIndex+=t)}function V(e,t){let n=e._currentIndex+t;return e._textLength<n&&(n=e._textLength),e._text.substring(e._currentIndex,n)}function G(e,t){let n="";for(;B(e);){const r=H(e);if(!t(r))break;n+=r,F(e)}return n}function J(e,...t){return G(e,(e=>-1===t.indexOf(e)))}const X="REDACTED",K=["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent"],Q=["api-version"];class W{constructor({allowedHeaderNames:e=[],allowedQueryParameters:t=[]}={}){e=Array.isArray(e)?K.concat(e):K,t=Array.isArray(t)?Q.concat(t):Q,this.allowedHeaderNames=new Set(e.map((e=>e.toLowerCase()))),this.allowedQueryParameters=new Set(t.map((e=>e.toLowerCase())))}sanitize(e){const t=new Set;return JSON.stringify(e,((e,n)=>{if(n instanceof Error)return Object.assign(Object.assign({},n),{name:n.name,message:n.message});if("_headersMap"===e)return this.sanitizeHeaders(n);if("url"===e)return this.sanitizeUrl(n);if("query"===e)return this.sanitizeQuery(n);if("body"!==e&&"response"!==e&&"operationSpec"!==e){if(Array.isArray(n)||!("object"!=typeof(r=n)||null===r||Array.isArray(r)||r instanceof RegExp||r instanceof Date)){if(t.has(n))return"[Circular]";t.add(n)}var r;return n}}),2)}sanitizeHeaders(e){return this.sanitizeObject(e,this.allowedHeaderNames,((e,t)=>e[t].value))}sanitizeQuery(e){return this.sanitizeObject(e,this.allowedQueryParameters,((e,t)=>e[t]))}sanitizeObject(e,t,n){if("object"!=typeof e||null===e)return e;const r={};for(const o of Object.keys(e))t.has(o.toLowerCase())?r[o]=n(e,o):r[o]=X;return r}sanitizeUrl(e){if("string"!=typeof e||null===e)return e;const t=L.parse(e),n=t.getQuery();if(!n)return e;const r=j.parse(n);for(const e of r.keys())this.allowedQueryParameters.has(e.toLowerCase())||r.set(e,X);return t.setQuery(r.toString()),t.toString()}}const Y={},Z=new W;class ee extends Error{constructor(e,t,n,r,o){super(e),this.name="RestError",this.code=t,this.statusCode=n,this.request=r,this.response=o,Object.setPrototypeOf(this,ee.prototype)}[Y](){return`RestError: ${this.message} \n ${Z.sanitize(this)}`}}ee.REQUEST_SEND_ERROR="REQUEST_SEND_ERROR",ee.PARSE_ERROR="PARSE_ERROR";class te{sendRequest(e){var t;const n=new XMLHttpRequest;if(e.proxySettings)throw new Error("HTTP proxy is not supported in browser environment");const r=e.abortSignal;if(r){if(r.aborted)return Promise.reject(new D._("The operation was aborted."));const e=()=>{n.abort()};r.addEventListener("abort",e),n.addEventListener("readystatechange",(()=>{n.readyState===XMLHttpRequest.DONE&&r.removeEventListener("abort",e)}))}if(ne(n.upload,e.onUploadProgress),ne(n,e.onDownloadProgress),e.formData){const t=e.formData,n=new FormData,r=(e,t)=>{t&&Object.prototype.hasOwnProperty.call(t,"value")&&Object.prototype.hasOwnProperty.call(t,"options")?n.append(e,t.value,t.options):n.append(e,t)};for(const e of Object.keys(t)){const n=t[e];if(Array.isArray(n))for(let t=0;t<n.length;t++)r(e,n[t]);else r(e,n)}e.body=n,e.formData=void 0;const o=e.headers.get("Content-Type");o&&-1!==o.indexOf("multipart/form-data")&&e.headers.remove("Content-Type")}n.open(e.method,e.url),n.timeout=e.timeout,n.withCredentials=e.withCredentials;for(const t of e.headers.headersArray())n.setRequestHeader(t.name,t.value);return n.responseType=(null===(t=e.streamResponseStatusCodes)||void 0===t?void 0:t.size)||e.streamResponseBody?"blob":"text",n.send(void 0===e.body?null:e.body),"blob"===n.responseType?new Promise(((t,r)=>{!function(e,t,n,r){e.addEventListener("readystatechange",(()=>{var o;if(e.readyState===XMLHttpRequest.HEADERS_RECEIVED)if(t.streamResponseBody||(null===(o=t.streamResponseStatusCodes)||void 0===o?void 0:o.has(e.status))){const r=new Promise(((n,r)=>{e.addEventListener("load",(()=>{n(e.response)})),oe(t,e,r)}));n({request:t,status:e.status,headers:re(e),blobBody:r})}else e.addEventListener("load",(()=>{if(e.response){const o=new FileReader;o.onload=function(r){var o;const i=null===(o=r.target)||void 0===o?void 0:o.result;n({request:t,status:e.status,headers:re(e),bodyAsText:i})},o.onerror=function(e){r(o.error)},o.readAsText(e.response,"UTF-8")}else n({request:t,status:e.status,headers:re(e)})}))}))}(n,e,t,r),oe(e,n,r)})):new Promise((function(t,r){n.addEventListener("load",(()=>t({request:e,status:n.status,headers:re(n),bodyAsText:n.responseText}))),oe(e,n,r)}))}}function ne(e,t){t&&e.addEventListener("progress",(e=>t({loadedBytes:e.loaded})))}function re(e){const t=new i,n=e.getAllResponseHeaders().trim().split(/[\r\n]+/);for(const e of n){const n=e.indexOf(":"),r=e.slice(0,n),o=e.slice(n+2);t.set(r,o)}return t}function oe(e,t,n){t.addEventListener("error",(()=>n(new ee(`Failed to send request to ${e.url}`,ee.REQUEST_SEND_ERROR,void 0,e))));const r=new D._("The operation was aborted.");t.addEventListener("abort",(()=>n(r))),t.addEventListener("timeout",(()=>n(r)))}var ie;function se(e){var t;const{requestOptions:n,tracingOptions:r}=e;let o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(e,["requestOptions","tracingOptions"]);return n&&(o=Object.assign(Object.assign({},o),n)),r&&(o.tracingContext=r.tracingContext,o.spanOptions=null===(t=r)||void 0===t?void 0:t.spanOptions),o}!function(e){e[e.OFF=0]="OFF",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.INFO=3]="INFO"}(ie||(ie={})),Object.create,Object.create;class ae{constructor(e,t){this._nextPolicy=e,this._options=t}shouldLog(e){return this._options.shouldLog(e)}log(e,t){this._options.log(e,t)}}class ce{constructor(e){this._logger=e}shouldLog(e){return!!this._logger&&e!==ie.OFF&&e<=this._logger.minimumLogLevel}log(e,t){this._logger&&this.shouldLog(e)&&this._logger.log(e,t)}}if(!(self.document&&self.DOMParser&&self.Node&&self.XMLSerializer))throw new Error('This library depends on the following DOM objects: ["document", "DOMParser", "Node", "XMLSerializer"] to parse XML, but some of these are undefined. You may provide a polyfill to make these globally available in order to support your environment. For more information, please refer to https://aka.ms/azsdk/js/web-workers. ');const ue=document.implementation.createDocument(null,null,null),le=new DOMParser;function de(e,t={}){var n,r,o;try{const i={rootName:null!==(n=t.rootName)&&void 0!==n?n:"",includeRoot:null!==(r=t.includeRoot)&&void 0!==r&&r,xmlCharKey:null!==(o=t.xmlCharKey)&&void 0!==o?o:u},s=le.parseFromString(e,"application/xml");let a;return function(e){const t=e.getElementsByTagName("parsererror");if(t.length>0&&function(){var e;if(void 0===pe)try{pe=null!==(e=le.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI)&&void 0!==e?e:""}catch(e){pe=""}return pe}())for(let e=0;e<t.length;e++)if(t[e].namespaceURI===pe)throw new Error(t[e].innerHTML)}(s),a=i.includeRoot?he(s,i):he(s.childNodes[0],i),Promise.resolve(a)}catch(e){return Promise.reject(e)}}let pe;function he(e,t){let n={};const r=e.childNodes.length,o=e.childNodes[0],i=o&&1===r&&o.nodeType===Node.TEXT_NODE&&o.nodeValue||void 0,s=function(e){return function(e){return!!e.attributes}(e)&&e.hasAttributes()?e:void 0}(e);if(s){n[c]={};for(let e=0;e<s.attributes.length;e++){const t=s.attributes[e];n[c][t.nodeName]=t.nodeValue}i&&(n[t.xmlCharKey]=i)}else 0===r?n="":i&&(n=i);if(!i)for(let o=0;o<r;o++){const r=e.childNodes[o];if(r.nodeType!==Node.TEXT_NODE){const e=he(r,t);n[r.nodeName]?Array.isArray(n[r.nodeName])?n[r.nodeName].push(e):n[r.nodeName]=[n[r.nodeName],e]:n[r.nodeName]=e}}return n}const fe=new XMLSerializer;function me(e,t={}){var n,r,o;const i={rootName:null!==(n=t.rootName)&&void 0!==n?n:"root",includeRoot:null!==(r=t.includeRoot)&&void 0!==r&&r,xmlCharKey:null!==(o=t.xmlCharKey)&&void 0!==o?o:u},s=ye(e,i.rootName,i)[0];return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'+fe.serializeToString(s)}function ge(e){const t=[];for(const n of Object.keys(e)){const r=ue.createAttribute(n);r.value=e[n].toString(),t.push(r)}return t}function ye(e,t,n){if(null==e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e){const n=ue.createElement(t);return n.textContent=null==e?"":e.toString(),[n]}if(Array.isArray(e)){const r=[];for(const o of e)for(const e of ye(o,t,n))r.push(e);return r}if("object"==typeof e){const r=ue.createElement(t);for(const t of Object.keys(e))if(t===c)for(const n of ge(e[t]))r.attributes.setNamedItem(n);else if(t===n.xmlCharKey)r.textContent=e[t].toString();else for(const o of ye(e[t],t,n))r.appendChild(o);return[r]}throw new Error(`Illegal value passed to buildObject: ${e}`)}function ve(e,t){return{create:(n,r)=>new Re(n,r,e,t)}}const be=["application/json","text/json"],Te=["application/xml","application/atom+xml"],we={expectedContentTypes:{json:be,xml:Te}};class Re extends ae{constructor(e,t,n,r={}){var o;super(e,t),this.jsonContentTypes=n&&n.json||be,this.xmlContentTypes=n&&n.xml||Te,this.xmlCharKey=null!==(o=r.xmlCharKey)&&void 0!==o?o:u}async sendRequest(e){return this._nextPolicy.sendRequest(e).then((e=>Ce(this.jsonContentTypes,this.xmlContentTypes,e,{xmlCharKey:this.xmlCharKey})))}}function Ce(e,t,n,r={}){var o,i,s;const a={rootName:null!==(o=r.rootName)&&void 0!==o?o:"",includeRoot:null!==(i=r.includeRoot)&&void 0!==i&&i,xmlCharKey:null!==(s=r.xmlCharKey)&&void 0!==s?s:u};return function(e,t,n,r){var o;const i=e=>{const t=`Error "${e}" occurred while parsing the response body - ${n.bodyAsText}.`,r=e.code||ee.PARSE_ERROR,o=new ee(t,r,n.status,n.request,n);return Promise.reject(o)};if(!(null===(o=n.request.streamResponseStatusCodes)||void 0===o?void 0:o.has(n.status))&&!n.request.streamResponseBody&&n.bodyAsText){const o=n.bodyAsText,s=n.headers.get("Content-Type")||"",a=s?s.split(";").map((e=>e.toLowerCase())):[];if(0===a.length||a.some((t=>-1!==e.indexOf(t))))return new Promise((e=>{n.parsedBody=JSON.parse(o),e(n)})).catch(i);if(a.some((e=>-1!==t.indexOf(e))))return de(o,r).then((e=>(n.parsedBody=e,n))).catch(i)}return Promise.resolve(n)}(e,t,n,a).then((e=>{if(!function(e){const t=e.request.shouldDeserialize;let n;return n=void 0===t||("boolean"==typeof t?t:t(e)),n}(e))return e;const t=e.request.operationSpec;if(!t||!t.responses)return e;const o=function(e){let t;const n=e.request,r=n.operationSpec;if(r){const o=n.operationResponseGetter;t=o?o(r,e):r.responses[e.status]}return t}(e),{error:i,shouldReturnResponse:s}=function(e,t,n){var r;const o=200<=e.status&&e.status<300;if(function(e){const t=Object.keys(e.responses);return 0===t.length||1===t.length&&"default"===t[0]}(t)?o:n){if(!n)return{error:null,shouldReturnResponse:!1};if(!n.isError)return{error:null,shouldReturnResponse:!1}}const i=null!=n?n:t.responses.default,s=(null===(r=e.request.streamResponseStatusCodes)||void 0===r?void 0:r.has(e.status))||e.request.streamResponseBody?`Unexpected status code: ${e.status}`:e.bodyAsText,a=new ee(s,void 0,e.status,e.request,e);if(!i)throw a;const c=i.bodyMapper,u=i.headersMapper;try{if(e.parsedBody){const n=e.parsedBody;let r;if(c){let e=n;t.isXML&&c.type.name===q.Sequence&&(e="object"==typeof n?n[c.xmlElementName]:[]),r=t.serializer.deserialize(c,e,"error.response.parsedBody")}const o=n.error||r||n;a.code=o.code,o.message&&(a.message=o.message),c&&(a.response.parsedBody=r)}e.headers&&u&&(a.response.parsedHeaders=t.serializer.deserialize(u,e.headers.rawHeaders(),"operationRes.parsedHeaders"))}catch(t){a.message=`Error "${t.message}" occurred in deserializing the responseBody - "${e.bodyAsText}" for the default response.`}return{error:a,shouldReturnResponse:!1}}(e,t,o);if(i)throw i;if(s)return e;if(o){if(o.bodyMapper){let n=e.parsedBody;t.isXML&&o.bodyMapper.type.name===q.Sequence&&(n="object"==typeof n?n[o.bodyMapper.xmlElementName]:[]);try{e.parsedBody=t.serializer.deserialize(o.bodyMapper,n,"operationRes.parsedBody",r)}catch(t){throw new ee(`Error ${t} occurred in deserializing the responseBody - ${e.bodyAsText}`,void 0,e.status,e.request,e)}}else"HEAD"===t.httpMethod&&(e.parsedBody=n.status>=200&&n.status<300);o.headersMapper&&(e.parsedHeaders=t.serializer.deserialize(o.headersMapper,e.headers.rawHeaders(),"operationRes.parsedHeaders",r))}return e}))}const Se={enable:!0};function ke(e){return{create:(t,n)=>new Ee(t,n,e||Se)}}class Ee extends ae{constructor(e,t,n){super(e,t),this.keepAliveOptions=n}async sendRequest(e){return e.keepAlive=this.keepAliveOptions.enable,this._nextPolicy.sendRequest(e)}}const Oe=["GET","HEAD"],Pe={handleRedirects:!0,maxRetries:20};function Ie(e=20){return{create:(t,n)=>new xe(t,n,e)}}class xe extends ae{constructor(e,t,n=20){super(e,t),this.maxRetries=n}sendRequest(e){return this._nextPolicy.sendRequest(e).then((e=>Me(this,e,0)))}}function Me(e,t,n){const{request:r,status:o}=t,i=t.headers.get("location");if(i&&(300===o||301===o&&Oe.includes(r.method)||302===o&&Oe.includes(r.method)||303===o&&"POST"===r.method||307===o)&&(!e.maxRetries||n<e.maxRetries)){const t=L.parse(r.url);return t.setPath(i),r.url=t.toString(),303===o&&(r.method="GET",delete r.body),e._nextPolicy.sendRequest(r).then((t=>Me(e,t,n+1)))}return Promise.resolve(t)}const Ne=3e4,_e=9e4;function Ae(e){return"number"==typeof e}function qe(e,t,n,r,o){return!!t(r,o)&&n.retryCount<e}function Ue(e,t={retryCount:0,retryInterval:0},n){n&&(t.error&&(n.innerError=t.error),t.error=n),t.retryCount++;let r=Math.pow(2,t.retryCount-1)-1;return r*=.8*e.retryInterval+Math.floor(Math.random()*(.4*e.retryInterval)),t.retryInterval=Math.min(e.minRetryInterval+r,e.maxRetryInterval),t}const De={coreHttpVersion:"2.2.4",HTTP:"http:",HTTPS:"https:",HTTP_PROXY:"HTTP_PROXY",HTTPS_PROXY:"HTTPS_PROXY",NO_PROXY:"NO_PROXY",ALL_PROXY:"ALL_PROXY",HttpConstants:{HttpVerbs:{PUT:"PUT",GET:"GET",DELETE:"DELETE",POST:"POST",MERGE:"MERGE",HEAD:"HEAD",PATCH:"PATCH"},StatusCodes:{TooManyRequests:429,ServiceUnavailable:503}},HeaderConstants:{AUTHORIZATION:"authorization",AUTHORIZATION_SCHEME:"Bearer",RETRY_AFTER:"Retry-After",USER_AGENT:"User-Agent"}};function je(e,t,n){return new Promise(((r,o)=>{let i,s;const a=()=>o(new D._((null==n?void 0:n.abortErrorMsg)?null==n?void 0:n.abortErrorMsg:"The operation was aborted.")),c=()=>{(null==n?void 0:n.abortSignal)&&s&&n.abortSignal.removeEventListener("abort",s)};if(s=()=>(null!=i&&clearTimeout(i),c(),a()),(null==n?void 0:n.abortSignal)&&n.abortSignal.aborted)return a();i=setTimeout((()=>{c(),r(t)}),e),(null==n?void 0:n.abortSignal)&&n.abortSignal.addEventListener("abort",s)}))}const Le=(0,n(901).YR)("core-http");function ze(e,t,n){return{create:(r,o)=>new He(r,o,e,t,n)}}var $e;!function(e){e[e.Exponential=0]="Exponential"}($e||($e={}));const Be={maxRetries:3,retryDelayInMs:Ne,maxRetryDelayInMs:_e};class He extends ae{constructor(e,t,n,r,o){super(e,t),this.retryCount=Ae(n)?n:3,this.retryInterval=Ae(r)?r:Ne,this.maxRetryInterval=Ae(o)?o:_e}sendRequest(e){return this._nextPolicy.sendRequest(e.clone()).then((t=>Fe(this,e,t))).catch((t=>Fe(this,e,t.response,void 0,t)))}}async function Fe(e,t,n,r,o){r=Ue({retryInterval:e.retryInterval,minRetryInterval:0,maxRetryInterval:e.maxRetryInterval},r,o);const i=t.abortSignal&&t.abortSignal.aborted;if(i||!qe(e.retryCount,(function(e){const t=null==e?void 0:e.status;return!(503===t&&(null==n?void 0:n.headers.get(De.HeaderConstants.RETRY_AFTER))||void 0===t||t<500&&408!==t||501===t||505===t)}),r,n)){if(i||o||!n)throw r.error||new ee("Failed to send the request.",ee.REQUEST_SEND_ERROR,n&&n.status,n&&n.request,n);return n}Le.info(`Retrying request in ${r.retryInterval}`);try{await je(r.retryInterval);const n=await e._nextPolicy.sendRequest(t.clone());return Fe(e,t,n,r)}catch(o){return Fe(e,t,n,r,o)}}function Ve(e={}){return{create:(t,n)=>new Ge(t,n,e)}}class Ge extends ae{constructor(e,t,{logger:n=Le.info,allowedHeaderNames:r=[],allowedQueryParameters:o=[]}={}){super(e,t),this.logger=n,this.sanitizer=new W({allowedHeaderNames:r,allowedQueryParameters:o})}get allowedHeaderNames(){return this.sanitizer.allowedHeaderNames}set allowedHeaderNames(e){this.sanitizer.allowedHeaderNames=e}get allowedQueryParameters(){return this.sanitizer.allowedQueryParameters}set allowedQueryParameters(e){this.sanitizer.allowedQueryParameters=e}sendRequest(e){return this.logger.enabled?(this.logRequest(e),this._nextPolicy.sendRequest(e).then((e=>this.logResponse(e)))):this._nextPolicy.sendRequest(e)}logRequest(e){this.logger(`Request: ${this.sanitizer.sanitize(e)}`)}logResponse(e){return this.logger(`Response status code: ${e.status}`),this.logger(`Headers: ${this.sanitizer.sanitize(e.headers)}`),e}}function Je(e){return Xe(e.parameterPath,e.mapper)}function Xe(e,t){let n;return n="string"==typeof e?e:Array.isArray(e)?e.join("."):t.serializedName,n}function Ke(e){const t=e;return t&&"function"==typeof t.getToken&&(void 0===t.signRequest||t.getToken.length>0)}const Qe=function(){return"x-ms-useragent"};function We(){const e=[{key:"core-http",value:De.coreHttpVersion}],t=function(){const e=self.navigator;return[{key:"OS",value:(e.oscpu||e.platform).replace(" ","")}]}();return function(e,t=" ",n="/"){return e.map((e=>{const t=e.value?`${n}${e.value}`:"";return`${e.key}${t}`})).join(t)}(e.concat(t))}function Ye(e){const t=e&&void 0!==e.key&&null!==e.key?e.key:"x-ms-useragent",n=e&&void 0!==e.value&&null!==e.value?e.value:We();return{create:(e,r)=>new Ze(e,r,t,n)}}class Ze extends ae{constructor(e,t,n,r){super(e,t),this._nextPolicy=e,this._options=t,this.headerKey=n,this.headerValue=r}sendRequest(e){return this.addUserAgentHeader(e),this._nextPolicy.sendRequest(e)}addUserAgentHeader(e){e.headers||(e.headers=new i),!e.headers.get(this.headerKey)&&this.headerValue&&e.headers.set(this.headerKey,this.headerValue)}}var et;!function(e){e.Csv=",",e.Ssv=" ",e.Tsv="\t",e.Pipes="|",e.Multi="Multi"}(et||(et={}));const tt=URL,nt={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:12e4};function rt(e,t){const n=function(e,t,n){let r=null,o=null;const i=Object.assign(Object.assign({},nt),n),s={get isRefreshing(){return null!==r},get shouldRefresh(){var e;return!s.isRefreshing&&(null!==(e=null==o?void 0:o.expiresOnTimestamp)&&void 0!==e?e:0)-i.refreshWindowInMs<Date.now()},get mustRefresh(){return null===o||o.expiresOnTimestamp-i.forcedRefreshWindowInMs<Date.now()}};function a(n){var a;return s.isRefreshing||(r=async function(e,t,n){async function r(){if(!(Date.now()<n)){const t=await e();if(null===t)throw new Error("Failed to refresh access token.");return t}try{return await e()}catch(e){return null}}let o=await r();for(;null===o;)await je(t),o=await r();return o}((()=>e.getToken(t,n)),i.retryIntervalInMs,null!==(a=null==o?void 0:o.expiresOnTimestamp)&&void 0!==a?a:Date.now()).then((e=>(r=null,o=e,o))).catch((e=>{throw r=null,o=null,e}))),r}return async e=>s.mustRefresh?a(e):(s.shouldRefresh&&a(e),o)}(e,t);class r extends ae{constructor(e,t){super(e,t)}async sendRequest(e){if(!e.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.");const{token:t}=await n({abortSignal:e.abortSignal,tracingOptions:{tracingContext:e.tracingContext}});return e.headers.set(De.HeaderConstants.AUTHORIZATION,`Bearer ${t}`),this._nextPolicy.sendRequest(e)}}return{create:(e,t)=>new r(e,t)}}const ot=new Error("DisableResponseDecompressionPolicy is not supported in browser environment");function it(){return{create:(e,t)=>{throw ot}}}function st(e="x-ms-client-request-id"){return{create:(t,n)=>new at(t,n,e)}}class at extends ae{constructor(e,t,n){super(e,t),this._requestIdHeaderName=n}sendRequest(e){return e.headers.contains(this._requestIdHeaderName)||e.headers.set(this._requestIdHeaderName,e.requestId),this._nextPolicy.sendRequest(e)}}let ct;class ut extends ae{constructor(e,t){super(e,t)}async sendRequest(e){if("string"==typeof e.body&&e.body.startsWith("[")){const t=JSON.parse(e.body);Array.isArray(t)&&(e.body=t.map((e=>JSON.stringify(e)+"\n")).join(""))}return this._nextPolicy.sendRequest(e)}}const lt=new Error("ProxyPolicy is not supported in browser environment");function dt(e){}function pt(e){return{create:(e,t)=>{throw lt}}}class ht extends ae{constructor(e,t,n=30){super(e,t),this._retryTimeout=n}sendRequest(e){return this._nextPolicy.sendRequest(e.clone()).then((t=>function(e,t,n){if(409===n.status){const r=function(e){let t,n;if(e){try{n=JSON.parse(e)}catch(e){}if(n&&n.error&&n.error.message&&n.error.code&&"MissingSubscriptionRegistration"===n.error.code){const e=n.error.message.match(/.*'(.*)'/i);e&&(t=e.pop())}}return t}(n.bodyAsText);if(r){const o=function(e){let t;const n=e.match(/.*\/subscriptions\/[a-f0-9-]+\//gi);if(!n||!n[0])throw new Error(`Unable to extract subscriptionId from the given url - ${e}.`);return t=n[0],t}(t.url);return async function(e,t,n,r){const o=`${t}providers/${n}/register?api-version=2016-02-01`,i=`${t}providers/${n}?api-version=2016-02-01`,s=ft(r);if(s.method="POST",s.url=o,200!==(await e._nextPolicy.sendRequest(s)).status)throw new Error(`Autoregistration of ${n} failed. Please try registering manually.`);return mt(e,i,r)}(e,o,r,t).catch((()=>!1)).then((r=>r?(t.headers.set("x-ms-client-request-id",y()),e._nextPolicy.sendRequest(t.clone())):n))}}return Promise.resolve(n)}(this,e,t)))}}function ft(e,t=!1){const n=e.clone();return t&&(n.url=e.url),n.headers.set("x-ms-client-request-id",y()),n.headers.set("Content-Type","application/json; charset=utf-8"),n}async function mt(e,t,n){const r=ft(n);r.url=t,r.method="GET";const o=await e._nextPolicy.sendRequest(r),i=o.parsedBody;return!(!o.parsedBody||!i.registrationState||"Registered"!==i.registrationState)||(await je(1e3*e._retryTimeout),mt(e,t,n))}function gt(e){return{create:(t,n)=>new yt(t,n,e)}}class yt extends ae{constructor(e,t,n){super(e,t),this.authenticationProvider=n}signRequest(e){return this.authenticationProvider.signRequest(e)}sendRequest(e){return this.signRequest(e).then((e=>this._nextPolicy.sendRequest(e)))}}function vt(e,t,n,r){return{create:(o,i)=>new bt(o,i,e,t,n,r)}}class bt extends ae{constructor(e,t,n,r,o,i){super(e,t),this.retryCount=Ae(n)?n:3,this.retryInterval=Ae(r)?r:Ne,this.minRetryInterval=Ae(o)?o:3e3,this.maxRetryInterval=Ae(i)?i:_e}sendRequest(e){return this._nextPolicy.sendRequest(e.clone()).catch((t=>Tt(this,e,t.response,t)))}}async function Tt(e,t,n,r,o){if(o=Ue(e,o,r),!qe(e.retryCount,(function(e,t){return!(!t||!t.code||"ETIMEDOUT"!==t.code&&"ESOCKETTIMEDOUT"!==t.code&&"ECONNREFUSED"!==t.code&&"ECONNRESET"!==t.code&&"ENOENT"!==t.code)}),o,n,r))return r?Promise.reject(o.error):n;try{return await je(o.retryInterval),e._nextPolicy.sendRequest(t.clone())}catch(r){return Tt(e,t,n,r,o)}}const wt=De.HttpConstants.StatusCodes;function Rt(){return{create:(e,t)=>new St(e,t)}}const Ct="The operation was aborted.";class St extends ae{constructor(e,t,n){super(e,t),this.numberOfRetries=0,this._handleResponse=n||this._defaultResponseHandler}async sendRequest(e){const t=await this._nextPolicy.sendRequest(e.clone());return t.status!==wt.TooManyRequests&&t.status!==wt.ServiceUnavailable?t:this._handleResponse(e,t)}async _defaultResponseHandler(e,t){var n;const r=t.headers.get(De.HeaderConstants.RETRY_AFTER);if(r){const t=St.parseRetryAfterHeader(r);if(t){if(this.numberOfRetries+=1,await je(t,void 0,{abortSignal:e.abortSignal,abortErrorMsg:Ct}),null===(n=e.abortSignal)||void 0===n?void 0:n.aborted)throw new D._(Ct);return this.numberOfRetries<3?this.sendRequest(e):this._nextPolicy.sendRequest(e)}}return t}static parseRetryAfterHeader(e){const t=Number(e);return Number.isNaN(t)?St.parseDateRetryAfterHeader(e):1e3*t}static parseDateRetryAfterHeader(e){try{const t=Date.now(),n=Date.parse(e)-t;return Number.isNaN(n)?void 0:n}catch(e){return}}}var kt=n(951),Et=n(771),Ot=n(809);const Pt=(0,kt.q)({packagePrefix:"",namespace:""});function It(e={}){return{create:(t,n)=>new xt(t,n,e)}}class xt extends ae{constructor(e,t,n){super(e,t),this.userAgent=n.userAgent}async sendRequest(e){if(!e.tracingContext)return this._nextPolicy.sendRequest(e);const t=this.tryCreateSpan(e);if(!t)return this._nextPolicy.sendRequest(e);try{const n=await this._nextPolicy.sendRequest(e);return this.tryProcessResponse(t,n),n}catch(e){throw this.tryProcessError(t,e),e}}tryCreateSpan(e){var t;try{const{span:n}=Pt(`HTTP ${e.method}`,{tracingOptions:{spanOptions:Object.assign(Object.assign({},e.spanOptions),{kind:Et.MU.CLIENT}),tracingContext:e.tracingContext}});if(!n.isRecording())return void n.end();const r=null===(t=e.tracingContext)||void 0===t?void 0:t.getValue(Symbol.for("az.namespace"));"string"==typeof r&&n.setAttribute("az.namespace",r),n.setAttributes({"http.method":e.method,"http.url":e.url,requestId:e.requestId}),this.userAgent&&n.setAttribute("http.user_agent",this.userAgent);const o=n.spanContext(),i=(0,Ot.O)(o);if(i&&(0,Et.BM)(o)){e.headers.set("traceparent",i);const t=o.traceState&&o.traceState.serialize();t&&e.headers.set("tracestate",t)}return n}catch(e){return void Le.warning(`Skipping creating a tracing span due to an error: ${e.message}`)}}tryProcessError(e,t){try{e.setStatus({code:Et.Qn.ERROR,message:t.message}),t.statusCode&&e.setAttribute("http.status_code",t.statusCode),e.end()}catch(e){Le.warning(`Skipping tracing span processing due to an error: ${e.message}`)}}tryProcessResponse(e,t){try{e.setAttribute("http.status_code",t.status);const n=t.headers.get("x-ms-request-id");n&&e.setAttribute("serviceRequestId",n),e.setStatus({code:Et.Qn.OK}),e.end()}catch(e){Le.warning(`Skipping tracing span processing due to an error: ${e.message}`)}}}class Mt{constructor(e,t){let n;if(t||(t={}),this._withCredentials=t.withCredentials||!1,this._httpClient=t.httpClient||(ct||(ct=new te),ct),this._requestPolicyOptions=new ce(t.httpPipelineLogger),Array.isArray(t.requestPolicyFactories))Le.info("ServiceClient: using custom request policies"),n=t.requestPolicyFactories;else{let r;if(Ke(e)){Le.info("ServiceClient: creating bearer token authentication policy from provided credentials");const n=()=>{let n;const r=this,o=t;return{create(t,i){const s=function(e,t){if(null==e?void 0:e.credentialScopes){const t=e.credentialScopes;return Array.isArray(t)?t.map((e=>new tt(e).toString())):new tt(t).toString()}if(t)return`${t}/.default`}(o,r.baseUri);if(!s)throw new Error("When using credential, the ServiceClient must contain a baseUri or a credentialScopes in ServiceClientOptions. Unable to create a bearerTokenAuthenticationPolicy");return null==n&&(n=rt(e,s)),n.create(t,i)}}};r=n()}else if(e&&"function"==typeof e.signRequest)Le.info("ServiceClient: creating signing policy from provided credentials"),r=gt(e);else if(null!=e)throw new Error("The credentials argument must implement the TokenCredential interface");if(Le.info("ServiceClient: using default request policies"),n=function(e,t){const n=[];t.generateClientRequestIdHeader&&n.push(st(t.clientRequestIdHeaderName)),e&&n.push(e);const r=Nt(t.userAgentHeaderName,Qe),o=Nt(t.userAgent,We);return r&&o&&n.push(Ye({key:r,value:o})),n.push(Ie()),n.push(function(e=30){return{create:(t,n)=>new ht(t,n,e)}}(t.rpRegistrationRetryTimeout)),t.noRetryPolicy||(n.push(ze()),n.push(vt()),n.push(Rt())),n.push(ve(t.deserializationContentTypes)),p&&n.push(pt(t.proxySettings)),n.push(Ve({logger:Le.info})),n}(r,t),t.requestPolicyFactories){const e=t.requestPolicyFactories(n);e&&(n=e)}}this._requestPolicyFactories=n}sendRequest(e){if(null==e||"object"!=typeof e)throw new Error("options cannot be null or undefined and it must be of type object.");let t;try{!function(e){if(e&&"object"==typeof e){const t=e;if("string"==typeof t.url&&"string"==typeof t.method&&"object"==typeof t.headers&&o(t.headers)&&"function"==typeof t.validateRequestProperties&&"function"==typeof t.prepare&&"function"==typeof t.clone)return!0}return!1}(e)?(t=new U,t=t.prepare(e)):(e.validateRequestProperties(),t=e)}catch(e){return Promise.reject(e)}let n=this._httpClient;if(this._requestPolicyFactories&&this._requestPolicyFactories.length>0)for(let e=this._requestPolicyFactories.length-1;e>=0;--e)n=this._requestPolicyFactories[e].create(n,this._requestPolicyOptions);return n.sendRequest(t)}async sendOperationRequest(e,t,n){var r;"function"==typeof e.options&&(n=e.options,e.options=void 0);const o=null===(r=e.options)||void 0===r?void 0:r.serializerOptions,i=new U;let s;try{const n=t.baseUrl||this.baseUri;if(!n)throw new Error("If operationSpec.baseUrl is not specified, then the ServiceClient must have a baseUri string property that contains the base URL to use.");i.method=t.httpMethod,i.operationSpec=t;const r=L.parse(n);if(t.path&&r.appendPath(t.path),t.urlParameters&&t.urlParameters.length>0)for(const n of t.urlParameters){let i=At(this,e,n,t.serializer);i=t.serializer.serialize(n.mapper,i,Je(n),o),n.skipEncoding||(i=encodeURIComponent(i)),r.replaceAll(`{${n.mapper.serializedName||Je(n)}}`,i)}if(t.queryParameters&&t.queryParameters.length>0)for(const n of t.queryParameters){let i=At(this,e,n,t.serializer);if(null!=i){if(i=t.serializer.serialize(n.mapper,i,Je(n),o),void 0!==n.collectionFormat&&null!==n.collectionFormat)if(n.collectionFormat===et.Multi){if(0===i.length)continue;for(const e in i){const t=i[e];i[e]=null==t?"":t.toString()}}else n.collectionFormat!==et.Ssv&&n.collectionFormat!==et.Tsv||(i=i.join(n.collectionFormat));if(!n.skipEncoding)if(Array.isArray(i))for(const e in i)void 0!==i[e]&&null!==i[e]&&(i[e]=encodeURIComponent(i[e]));else i=encodeURIComponent(i);void 0!==n.collectionFormat&&null!==n.collectionFormat&&n.collectionFormat!==et.Multi&&n.collectionFormat!==et.Ssv&&n.collectionFormat!==et.Tsv&&(i=i.join(n.collectionFormat)),r.setQueryParameter(n.mapper.serializedName||Je(n),i)}}i.url=r.toString();const a=t.contentType||this.requestContentType;if(a&&t.requestBody&&i.headers.set("Content-Type",a),t.headerParameters)for(const n of t.headerParameters){let r=At(this,e,n,t.serializer);if(null!=r){r=t.serializer.serialize(n.mapper,r,Je(n),o);const e=n.mapper.headerCollectionPrefix;if(e)for(const t of Object.keys(r))i.headers.set(e+t,r[t]);else i.headers.set(n.mapper.serializedName||Je(n),r)}}const l=e.options;if(l){if(l.customHeaders)for(const e in l.customHeaders)i.headers.set(e,l.customHeaders[e]);l.abortSignal&&(i.abortSignal=l.abortSignal),l.timeout&&(i.timeout=l.timeout),l.onUploadProgress&&(i.onUploadProgress=l.onUploadProgress),l.onDownloadProgress&&(i.onDownloadProgress=l.onDownloadProgress),l.spanOptions&&(i.spanOptions=l.spanOptions),l.tracingContext&&(i.tracingContext=l.tracingContext),void 0!==l.shouldDeserialize&&null!==l.shouldDeserialize&&(i.shouldDeserialize=l.shouldDeserialize)}let d,p;i.withCredentials=this._withCredentials,function(e,t,n,r){var o,i,s,a,l,d;const p=null!==(i=null===(o=n.options)||void 0===o?void 0:o.serializerOptions)&&void 0!==i?i:{},h={rootName:null!==(s=p.rootName)&&void 0!==s?s:"",includeRoot:null!==(a=p.includeRoot)&&void 0!==a&&a,xmlCharKey:null!==(l=p.xmlCharKey)&&void 0!==l?l:u},f=p.xmlCharKey;if(r.requestBody&&r.requestBody.mapper){t.body=At(e,n,r.requestBody,r.serializer);const o=r.requestBody.mapper,{required:i,xmlName:s,xmlElementName:a,serializedName:u,xmlNamespace:l,xmlNamespacePrefix:p}=o,m=o.type.name;try{if(void 0!==t.body&&null!==t.body||i){const e=Je(r.requestBody);t.body=r.serializer.serialize(o,t.body,e,h);const n=m===q.Stream;if(r.isXML){const e=p?`xmlns:${p}`:"xmlns",r=function(e,t,n,r,o){if(e&&!["Composite","Sequence","Dictionary"].includes(n)){const n={};return n[o.xmlCharKey]=r,n[c]={[t]:e},n}return r}(l,e,m,t.body,h);m===q.Sequence?t.body=me(function(e,t,n,r){if(Array.isArray(e)||(e=[e]),!n||!r)return{[t]:e};const o={[t]:e};return o[c]={[n]:r},o}(r,a||s||u,e,l),{rootName:s||u,xmlCharKey:f}):n||(t.body=me(r,{rootName:s||u,xmlCharKey:f}))}else{if(m===q.String&&((null===(d=r.contentType)||void 0===d?void 0:d.match("text/plain"))||"text"===r.mediaType))return;n||(t.body=JSON.stringify(t.body))}}}catch(e){throw new Error(`Error "${e.message}" occurred in serializing the payload - ${JSON.stringify(u,void 0,"  ")}.`)}}else if(r.formDataParameters&&r.formDataParameters.length>0){t.formData={};for(const o of r.formDataParameters){const i=At(e,n,o,r.serializer);if(null!=i){const e=o.mapper.serializedName||Je(o);t.formData[e]=r.serializer.serialize(o.mapper,i,Je(o),h)}}}}(this,i,e,t),void 0===i.streamResponseStatusCodes&&(i.streamResponseStatusCodes=function(e){const t=new Set;for(const n in e.responses){const r=e.responses[n];r.bodyMapper&&r.bodyMapper.type.name===q.Stream&&t.add(Number(n))}return t}(t));try{d=await this.sendRequest(i)}catch(e){p=e}p?(p.response&&(p.details=Dt(p.response,t.responses[p.statusCode]||t.responses.default)),s=Promise.reject(p)):s=Promise.resolve(Dt(d,t.responses[d.status]))}catch(e){s=Promise.reject(e)}const a=n;return a&&s.then((e=>a(null,e._response.parsedBody,e._response.request,e._response))).catch((e=>a(e))),s}}function Nt(e,t){let n;return"string"==typeof e?n=e:(n=t(),"function"==typeof e&&(n=e(n))),n}function _t(e,t){const n=[];let r;if(e.sendStreamingJson&&n.push({create:(e,t)=>new ut(e,t)}),e.userAgentOptions&&e.userAgentOptions.userAgentPrefix){const t=[];t.push(e.userAgentOptions.userAgentPrefix);const n=We();-1===t.indexOf(n)&&t.push(n),r=t.join(" ")}const o=Object.assign(Object.assign({},Se),e.keepAliveOptions),i=Object.assign(Object.assign({},Be),e.retryOptions),s=Object.assign(Object.assign({},Pe),e.redirectOptions);p&&n.push(pt(e.proxyOptions));const a=Object.assign(Object.assign({},we),e.deserializationOptions),c=Object.assign({},e.loggingOptions);return n.push(It({userAgent:r}),ke(o),Ye({value:r}),st(),ve(a.expectedContentTypes),Rt(),vt(),ze(i.maxRetries,i.retryDelayInMs,i.maxRetryDelayInMs)),s.handleRedirects&&n.push(Ie(s.maxRetries)),t&&n.push(t),n.push(Ve(c)),p&&!1===e.decompressResponse&&n.push(it()),{httpClient:e.httpClient,requestPolicyFactories:n}}function At(e,t,n,r){return qt(e,t,n.parameterPath,n.mapper,r)}function qt(e,t,n,r,o){var i;let s;"string"==typeof n&&(n=[n]);const a=null===(i=t.options)||void 0===i?void 0:i.serializerOptions;if(Array.isArray(n)){if(n.length>0){if(r.isConstant)s=r.defaultValue;else{let o=Ut(t,n);o.propertyFound||(o=Ut(e,n));let i=!1;o.propertyFound||(i=r.required||"options"===n[0]&&2===n.length),s=i?r.defaultValue:o.propertyValue}const i=Xe(n,r);o.serialize(r,s,i,a)}}else{r.required&&(s={});for(const i in n){const c=r.type.modelProperties[i],u=n[i],l=qt(e,t,u,c,o),d=Xe(u,c);o.serialize(c,l,d,a),null!=l&&(s||(s={}),s[i]=l)}}return s}function Ut(e,t){const n={propertyFound:!1};let r=0;for(;r<t.length;++r){const n=t[r];if(null==e||!(n in e))break;e=e[n]}return r===t.length&&(n.propertyValue=e,n.propertyFound=!0),n}function Dt(e,t){const n=e.parsedHeaders,r=t&&t.bodyMapper,o=t=>Object.defineProperty(t,"_response",{value:e});if(r){const t=r.type.name;if("Stream"===t)return o(Object.assign(Object.assign({},n),{blobBody:e.blobBody,readableStreamBody:e.readableStreamBody}));const i="Composite"===t&&r.type.modelProperties||{},s=Object.keys(i).some((e=>""===i[e].serializedName));if("Sequence"===t||s){const t=[...e.parsedBody||[]];for(const n of Object.keys(i))i[n].serializedName&&(t[n]=e.parsedBody[n]);if(n)for(const e of Object.keys(n))t[e]=n[e];return o(t),t}if("Composite"===t||"Dictionary"===t)return o(Object.assign(Object.assign({},n),e.parsedBody))}return r||"HEAD"===e.request.method||"object"!=typeof(i=e.parsedBody)&&"function"!=typeof i||null===i?o(Object.assign(Object.assign({},n),{body:e.parsedBody})):o(Object.assign(Object.assign({},n),e.parsedBody));var i}function jt(e){return(0,kt.q)(e)}class Lt{constructor(e=12e4){this.cachedToken=void 0,this.tokenRefreshBufferMs=e}setCachedToken(e){this.cachedToken=e}getCachedToken(){return this.cachedToken&&Date.now()+this.tokenRefreshBufferMs>=this.cachedToken.expiresOnTimestamp&&(this.cachedToken=void 0),this.cachedToken}}class zt{constructor(e,t,n=3e4){this.credential=e,this.scopes=t,this.requiredMillisecondsBeforeNewRefresh=n,this.lastCalled=0}isReady(){return!this.lastCalled||Date.now()-this.lastCalled>this.requiredMillisecondsBeforeNewRefresh}async getToken(e){this.lastCalled=Date.now();const t=await this.credential.getToken(this.scopes,e);return this.promise=void 0,t||void 0}refresh(e){return this.promise||(this.promise=this.getToken(e)),this.promise}}const $t=De.HeaderConstants;class Bt{constructor(e,t,n="Basic"){if(this.authorizationScheme="Basic",null==e||"string"!=typeof e.valueOf())throw new Error("userName cannot be null or undefined and must be of type string.");if(null==t||"string"!=typeof t.valueOf())throw new Error("password cannot be null or undefined and must be of type string.");this.userName=e,this.password=t,this.authorizationScheme=n}signRequest(e){const t=`${this.userName}:${this.password}`,n=`${this.authorizationScheme} ${r=t,btoa(r)}`;var r;return e.headers||(e.headers=new i),e.headers.set($t.AUTHORIZATION,n),Promise.resolve(e)}}class Ht{constructor(e){if(!e||e&&!e.inHeader&&!e.inQuery)throw new Error('options cannot be null or undefined. Either "inHeader" or "inQuery" property of the options object needs to be provided.');this.inHeader=e.inHeader,this.inQuery=e.inQuery}signRequest(e){if(!e)return Promise.reject(new Error('webResource cannot be null or undefined and must be of type "object".'));if(this.inHeader){e.headers||(e.headers=new i);for(const t in this.inHeader)e.headers.set(t,this.inHeader[t])}if(this.inQuery){if(!e.url)return Promise.reject(new Error("url cannot be null in the request object."));e.url.indexOf("?")<0&&(e.url+="?");for(const t in this.inQuery)e.url.endsWith("?")||(e.url+="&"),e.url+=`${t}=${this.inQuery[t]}`}return Promise.resolve(e)}}class Ft extends Ht{constructor(e){if(!e||e&&"string"!=typeof e)throw new Error("topicKey cannot be null or undefined and must be of type string.");super({inHeader:{"aeg-sas-key":e}})}}n(445)},445:()=>{void 0!==typeof Symbol&&Symbol.asyncIterator||(Symbol.asyncIterator=Symbol.for("Symbol.asyncIterator"))},951:(e,t,n)=>{n.d(t,{q:()=>i});var r=n(771),o=n(370);function i(e){return function(t,n){const i=(0,r.Yz)(),s=(null==n?void 0:n.tracingOptions)||{},a=Object.assign({kind:r.MU.INTERNAL},s.spanOptions),c=e.packagePrefix?`${e.packagePrefix}.${t}`:t;let u;u=function(){var e;if("undefined"==typeof process)return!1;const t=null===(e=process.env.AZURE_TRACING_DISABLED)||void 0===e?void 0:e.toLowerCase();return"false"!==t&&"0"!==t&&Boolean(t)}()?o.g4.wrapSpanContext(o.Rr):i.startSpan(c,a,s.tracingContext),e.namespace&&u.setAttribute("az.namespace",e.namespace);let l=s.spanOptions||{};u.isRecording()&&e.namespace&&(l=Object.assign(Object.assign({},s.spanOptions),{attributes:Object.assign(Object.assign({},a.attributes),{"az.namespace":e.namespace})}));const d=Object.assign(Object.assign({},s),{spanOptions:l,tracingContext:(0,r.WZ)(s.tracingContext||r.Do.active(),u)});return{span:u,updatedOptions:Object.assign(Object.assign({},n),{tracingOptions:d})}}}},771:(e,t,n)=>{n.d(t,{BM:()=>s,Do:()=>c,MU:()=>r,Qn:()=>u,WZ:()=>i,Yz:()=>a});var r,o=n(370);function i(e,t){return o.g4.setSpan(e,t)}function s(e){return o.g4.isSpanContextValid(e)}function a(e,t){return o.g4.getTracer(e||"azure/core-tracing",t)}!function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(r||(r={}));const c=o.Do;var u;!function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(u||(u={}))},809:(e,t,n)=>{function r(e){const t=[];if(e.traceId||t.push("traceId"),e.spanId||t.push("spanId"),t.length)return;const n=(e.traceFlags||0).toString(16),r=1===n.length?`0${n}`:n;return`00-${e.traceId}-${e.spanId}-${r}`}n.d(t,{O:()=>r})},901:(e,t,n)=>{n.d(t,{YR:()=>w});const r="undefined"!=typeof process&&process.env&&process.env.DEBUG||void 0;let o,i=[],s=[];const a=[];r&&u(r);const c=Object.assign((e=>d(e)),{enable:u,enabled:l,disable:function(){const e=o||"";return u(""),e},log:function(...e){if(e.length>0){const t=String(e[0]);t.includes(":error")?console.error(...e):t.includes(":warning")?console.warn(...e):t.includes(":info")?console.info(...e):(t.includes(":verbose"),console.debug(...e))}}});function u(e){o=e,i=[],s=[];const t=/\*/g,n=e.split(",").map((e=>e.trim().replace(t,".*?")));for(const e of n)e.startsWith("-")?s.push(new RegExp(`^${e.substr(1)}$`)):i.push(new RegExp(`^${e}$`));for(const e of a)e.enabled=l(e.namespace)}function l(e){if(e.endsWith("*"))return!0;for(const t of s)if(t.test(e))return!1;for(const t of i)if(t.test(e))return!0;return!1}function d(e){const t=Object.assign((function(...n){t.enabled&&(n.length>0&&(n[0]=`${e} ${n[0]}`),t.log(...n))}),{enabled:l(e),destroy:p,log:c.log,namespace:e,extend:h});return a.push(t),t}function p(){const e=a.indexOf(this);return e>=0&&(a.splice(e,1),!0)}function h(e){const t=d(`${this.namespace}:${e}`);return t.log=this.log,t}const f=c,m=new Set,g="undefined"!=typeof process&&process.env&&process.env.AZURE_LOG_LEVEL||void 0;let y;const v=f("azure");v.log=(...e)=>{f.log(...e)};const b=["verbose","info","warning","error"];g&&(k(g)?function(e){if(e&&!k(e))throw new Error(`Unknown log level '${e}'. Acceptable values: ${b.join(",")}`);y=e;const t=[];for(const e of m)S(e)&&t.push(e.namespace);f.enable(t.join(","))}(g):console.error(`AZURE_LOG_LEVEL set to unknown log level '${g}'; logging is not enabled. Acceptable values: ${b.join(", ")}.`));const T={verbose:400,info:300,warning:200,error:100};function w(e){const t=v.extend(e);return R(v,t),{error:C(t,"error"),warning:C(t,"warning"),info:C(t,"info"),verbose:C(t,"verbose")}}function R(e,t){t.log=(...t)=>{e.log(...t)}}function C(e,t){const n=Object.assign(e.extend(t),{level:t});if(R(e,n),S(n)){const e=f.disable();f.enable(e+","+n.namespace)}return m.add(n),n}function S(e){return!!(y&&T[e.level]<=T[y])}function k(e){return b.includes(e)}},370:(e,t,n)=>{n.d(t,{Rr:()=>N,Do:()=>ue,g4:()=>le});var r="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof n.g?n.g:{},o="1.0.4",i=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/,s=function(e){var t=new Set([e]),n=new Set,r=e.match(i);if(!r)return function(){return!1};var o=+r[1],s=+r[2],a=+r[3];if(null!=r[4])return function(t){return t===e};function c(e){return n.add(e),!1}function u(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var r=e.match(i);if(!r)return c(e);var l=+r[1],d=+r[2],p=+r[3];return null!=r[4]||o!==l?c(e):0===o?s===d&&a<=p?u(e):c(e):s<=d?u(e):c(e)}}(o),a=o.split(".")[0],c=Symbol.for("opentelemetry.js.api."+a),u=r;function l(e,t,n,r){var i;void 0===r&&(r=!1);var s=u[c]=null!==(i=u[c])&&void 0!==i?i:{version:o};if(!r&&s[e]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(a.stack||a.message),!1}return s.version!==o?(a=new Error("@opentelemetry/api: All API registration versions must match"),n.error(a.stack||a.message),!1):(s[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v1.0.4."),!0)}function d(e){var t,n,r=null===(t=u[c])||void 0===t?void 0:t.version;if(r&&s(r))return null===(n=u[c])||void 0===n?void 0:n[e]}function p(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v1.0.4.");var n=u[c];n&&delete n[e]}var h,f=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return m("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return m("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return m("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return m("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return m("verbose",this._namespace,e)},e}();function m(e,t,n){var r=d("diag");if(r)return n.unshift(t),r[e].apply(r,n)}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(h||(h={}));var g=function(){function e(){function e(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=d("diag");if(r)return r[e].apply(r,t)}}var t=this;t.setLogger=function(e,n){var r,o;if(void 0===n&&(n=h.INFO),e===t){var i=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=i.stack)&&void 0!==r?r:i.message),!1}var s=d("diag"),a=function(e,t){function n(n,r){var o=t[n];return"function"==typeof o&&e>=r?o.bind(t):function(){}}return e<h.NONE?e=h.NONE:e>h.ALL&&(e=h.ALL),t=t||{},{error:n("error",h.ERROR),warn:n("warn",h.WARN),info:n("info",h.INFO),debug:n("debug",h.DEBUG),verbose:n("verbose",h.VERBOSE)}}(n,e);if(s){var c=null!==(o=(new Error).stack)&&void 0!==o?o:"<failed to generate stacktrace>";s.warn("Current logger will be overwritten from "+c),a.warn("Current logger will overwrite one already registered from "+c)}return l("diag",a,t,!0)},t.disable=function(){p("diag",t)},t.createComponentLogger=function(e){return new f(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),y=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(e){return[e[0],e[1]]}))},e.prototype.setEntry=function(t,n){var r=new e(this._entries);return r._entries.set(t,n),r},e.prototype.removeEntry=function(t){var n=new e(this._entries);return n._entries.delete(t),n},e.prototype.removeEntries=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=new e(this._entries),o=0,i=t;o<i.length;o++){var s=i[o];r._entries.delete(s)}return r},e.prototype.clear=function(){return new e},e}();function v(e){return void 0===e&&(e={}),new y(new Map(Object.entries(e)))}Symbol("BaggageEntryMetadata"),g.instance();var b={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},T={set:function(e,t,n){null!=e&&(e[t]=n)}};function w(e){return Symbol.for(e)}var R,C=new function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var o=new e(n._currentContext);return o._currentContext.set(t,r),o},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}},S=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},k=function(){function e(){}return e.prototype.active=function(){return C},e.prototype.with=function(e,t,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];return t.call.apply(t,S([n],r))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),E=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},O="context",P=new k,I=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return l(O,e,g.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var r,o=[],i=3;i<arguments.length;i++)o[i-3]=arguments[i];return(r=this._getContextManager()).with.apply(r,E([e,t,n],o))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return d(O)||P},e.prototype.disable=function(){this._getContextManager().disable(),p(O,g.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(R||(R={}));var x="0000000000000000",M="00000000000000000000000000000000",N={traceId:M,spanId:x,traceFlags:R.NONE},_=function(){function e(e){void 0===e&&(e=N),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),A=w("OpenTelemetry Context Key SPAN");function q(e){return e.getValue(A)||void 0}function U(e,t){return e.setValue(A,t)}function D(e){return e.deleteValue(A)}function j(e,t){return U(e,new _(t))}function L(e){var t;return null===(t=q(e))||void 0===t?void 0:t.spanContext()}var z=/^([0-9a-f]{32})$/i,$=/^[0-9a-f]{16}$/i;function B(e){return n=e.traceId,z.test(n)&&n!==M&&(t=e.spanId,$.test(t)&&t!==x);var t,n}function H(e){return new _(e)}var F,V,G,J=I.getInstance(),X=function(){function e(){}return e.prototype.startSpan=function(e,t,n){if(Boolean(null==t?void 0:t.root))return new _;var r,o=n&&L(n);return"object"==typeof(r=o)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&B(o)?new _(o):new _},e.prototype.startActiveSpan=function(e,t,n,r){var o,i,s;if(!(arguments.length<2)){2===arguments.length?s=t:3===arguments.length?(o=t,s=n):(o=t,i=n,s=r);var a=null!=i?i:J.active(),c=this.startSpan(e,o,a),u=U(a,c);return J.with(u,s,void 0,c)}},e}(),K=new X,Q=function(){function e(e,t,n){this._provider=e,this.name=t,this.version=n}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,r){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version);return e?(this._delegate=e,this._delegate):K},e}(),W=new(function(){function e(){}return e.prototype.getTracer=function(e,t){return new X},e}()),Y=function(){function e(){}return e.prototype.getTracer=function(e,t){var n;return null!==(n=this.getDelegateTracer(e,t))&&void 0!==n?n:new Q(this,e,t)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:W},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t){var n;return null===(n=this._delegate)||void 0===n?void 0:n.getTracer(e,t)},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(F||(F={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(V||(V={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(G||(G={}));var Z="trace",ee=function(){function e(){this._proxyTracerProvider=new Y,this.wrapSpanContext=H,this.isSpanContextValid=B,this.deleteSpan=D,this.getSpan=q,this.getSpanContext=L,this.setSpan=U,this.setSpanContext=j}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=l(Z,this._proxyTracerProvider,g.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return d(Z)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){p(Z,g.instance()),this._proxyTracerProvider=new Y},e}(),te=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),ne=w("OpenTelemetry Baggage Key");function re(e){return e.getValue(ne)||void 0}function oe(e,t){return e.setValue(ne,t)}function ie(e){return e.deleteValue(ne)}var se="propagation",ae=new te,ce=function(){function e(){this.createBaggage=v,this.getBaggage=re,this.setBaggage=oe,this.deleteBaggage=ie}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return l(se,e,g.instance())},e.prototype.inject=function(e,t,n){return void 0===n&&(n=T),this._getGlobalPropagator().inject(e,t,n)},e.prototype.extract=function(e,t,n){return void 0===n&&(n=b),this._getGlobalPropagator().extract(e,t,n)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){p(se,g.instance())},e.prototype._getGlobalPropagator=function(){return d(se)||ae},e}(),ue=I.getInstance(),le=ee.getInstance();ce.getInstance(),g.instance()},187:e=>{var t,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise((function(n,r){function o(n){e.removeListener(t,i),r(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}m(e,t,i,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,o)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function u(e,t,n,r){var o,i,s,u;if(a(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),void 0===s)s=i[t]=n,++e._eventsCount;else if("function"==typeof s?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(o=c(e))>0&&s.length>o&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=s.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=l.bind(r);return o.listener=n,r.wrapFn=o,o}function p(e,t,n){var r=e._events;if(void 0===r)return[];var o=r[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):f(o,o.length)}function h(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function m(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(i){r.once&&e.removeEventListener(t,o),n(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var o="error"===e,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)r(c,this,t);else{var u=c.length,l=f(c,u);for(n=0;n<u;++n)r(l[n],this,t)}return!0},i.prototype.addListener=function(e,t){return u(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return u(this,e,t,!0)},i.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},i.prototype.removeListener=function(e,t){var n,r,o,i,s;if(a(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){s=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},i.prototype.listeners=function(e){return p(this,e,!0)},i.prototype.rawListeners=function(e){return p(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},i.prototype.listenerCount=h,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},655:(e,t,n)=>{n.d(t,{FC:()=>a,KL:()=>u,V2:()=>c,ZT:()=>o,_T:()=>i,qq:()=>s});var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function s(e){return this instanceof s?(this.v=e,this):new s(e)}function a(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||c(e,t)}))})}function c(e,t){try{(n=o[e](t)).value instanceof s?Promise.resolve(n.value.v).then(u,l):d(i[0][2],n)}catch(e){d(i[0][3],e)}var n}function u(e){c("next",e)}function l(e){c("throw",e)}function d(e,t){e(t),i.shift(),i.length&&c(i[0][0],i[0][1])}}function c(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,o){t[r]=e[r]?function(t){return(n=!n)?{value:s(e[r](t)),done:"return"===r}:o?o(t):t}:o}}function u(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}Object.create,Object.create},586:(e,t,n)=>{var r;n.d(t,{Z:()=>l});var o=new Uint8Array(16);function i(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(o)}const s=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,a=function(e){return"string"==typeof e&&s.test(e)};for(var c=[],u=0;u<256;++u)c.push((u+256).toString(16).substr(1));const l=function(e,t,n){var r=(e=e||{}).random||(e.rng||i)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!a(n))throw TypeError("Stringified UUID is invalid");return n}(r)}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={};n.r(e),n.d(e,{AddChatParticipantsRequest:()=>Ye,AddChatParticipantsResult:()=>Ze,ChatError:()=>Be,ChatMessage:()=>Je,ChatMessageContent:()=>Xe,ChatMessageReadReceipt:()=>Ue,ChatMessageReadReceiptsCollection:()=>qe,ChatMessagesCollection:()=>Ge,ChatParticipant:()=>Ke,ChatParticipantsCollection:()=>We,ChatThreadItem:()=>ot,ChatThreadProperties:()=>nt,ChatThreadsItemCollection:()=>rt,CommunicationErrorResponse:()=>$e,CommunicationIdentifierModel:()=>De,CommunicationUserIdentifierModel:()=>je,CreateChatThreadRequest:()=>et,CreateChatThreadResult:()=>tt,MicrosoftTeamsUserIdentifierModel:()=>ze,PhoneNumberIdentifierModel:()=>Le,SendChatMessageRequest:()=>Fe,SendChatMessageResult:()=>Ve,SendReadReceiptRequest:()=>He,SendTypingNotificationRequest:()=>st,UpdateChatMessageRequest:()=>Qe,UpdateChatThreadRequest:()=>it});var t=n(655);const r=(e,t)=>void 0===t?e:Object.assign(Object.assign({},e),{rawId:t}),o=(e,t)=>{const n=Object.keys(e)[0],r=e[n];if(t in r)return r[t];throw new Error(`Property ${t} is required for identifier of type ${n}.`)},i=e=>{var t,n;const o=(e=>(e=>"string"==typeof e.communicationUserId)(e)?Object.assign(Object.assign({},e),{kind:"communicationUser"}):(e=>"string"==typeof e.phoneNumber)(e)?Object.assign(Object.assign({},e),{kind:"phoneNumber"}):(e=>"string"==typeof e.microsoftTeamsUserId)(e)?Object.assign(Object.assign({},e),{kind:"microsoftTeamsUser"}):Object.assign(Object.assign({},e),{kind:"unknown"}))(e);switch(o.kind){case"communicationUser":return{communicationUser:{id:o.communicationUserId}};case"phoneNumber":return r({phoneNumber:{value:o.phoneNumber}},o.rawId);case"microsoftTeamsUser":return r({microsoftTeamsUser:{userId:o.microsoftTeamsUserId,isAnonymous:null!==(t=o.isAnonymous)&&void 0!==t&&t,cloud:null!==(n=o.cloud)&&void 0!==n?n:"public"}},o.rawId);case"unknown":return{rawId:o.id};default:throw new Error(`Can't serialize an identifier with kind ${o.kind}`)}},s=e=>{(e=>{const{rawId:n}=e,r=(0,t._T)(e,["rawId"]),o=Object.keys(r);if(o.length>1)throw new Error(`Only one of the properties in ${JSON.stringify(o)} should be present.`)})(e);const{communicationUser:n,microsoftTeamsUser:r,phoneNumber:i}=e;return n?{kind:"communicationUser",communicationUserId:o({communicationUser:n},"id")}:i?{kind:"phoneNumber",phoneNumber:o({phoneNumber:i},"value"),rawId:o({phoneNumber:e},"rawId")}:r?{kind:"microsoftTeamsUser",microsoftTeamsUserId:o({microsoftTeamsUser:r},"userId"),isAnonymous:o({microsoftTeamsUser:r},"isAnonymous"),cloud:o({microsoftTeamsUser:r},"cloud"),rawId:o({microsoftTeamsUser:e},"rawId")}:{kind:"unknown",id:o({unknown:e},"rawId")}},a=e=>{const{id:n}=e,r=(0,t._T)(e,["id"]);return Object.assign(Object.assign({},r),{communicationIdentifier:i(n)})},c=e=>{const{communicationIdentifier:n}=e,r=(0,t._T)(e,["communicationIdentifier"]);return Object.assign(Object.assign({},r),{id:s(n)})},u=e=>{const{participants:n,initiatorCommunicationIdentifier:r}=e,o=(0,t._T)(e,["participants","initiatorCommunicationIdentifier"]);let i=Object.assign({},o);if(r){const e=s(r);i=Object.assign(Object.assign({},i),{initiator:e})}return n&&(i=Object.assign(Object.assign({},i),{participants:null==n?void 0:n.map((e=>c(e)))})),i},l=e=>{const{content:n,senderCommunicationIdentifier:r}=e,o=(0,t._T)(e,["content","senderCommunicationIdentifier"]);let i=Object.assign({},o);if(n&&(i=Object.assign(Object.assign({},i),{content:u(n)})),r){const e=s(r);i=Object.assign(Object.assign({},i),{sender:e})}return i},d=e=>{const{createdByCommunicationIdentifier:n}=e,r=(0,t._T)(e,["createdByCommunicationIdentifier"]);return n?Object.assign(Object.assign({},r),{createdBy:s(n)}):Object.assign({},r)},p=e=>{const{senderCommunicationIdentifier:n}=e,r=(0,t._T)(e,["senderCommunicationIdentifier"]);return Object.assign(Object.assign({},r),{sender:s(n)})};function h(e){return e.toLowerCase()}class f{constructor(e){if(this._headersMap=new Map,e)for(const t of Object.keys(e))this.set(t,e[t])}set(e,t){this._headersMap.set(h(e),{name:e,value:String(t)})}get(e){var t;return null===(t=this._headersMap.get(h(e)))||void 0===t?void 0:t.value}has(e){return this._headersMap.has(h(e))}delete(e){this._headersMap.delete(h(e))}toJSON(e={}){const t={};if(e.preserveCase)for(const e of this._headersMap.values())t[e.name]=e.value;else for(const[e,n]of this._headersMap)t[e]=n.value;return t}toString(){return JSON.stringify(this.toJSON({preserveCase:!0}))}[Symbol.iterator](){return function*(e){for(const t of e.values())yield[t.name,t.value]}(this._headersMap)}}function m(e){return new f(e)}var g=n(586);class y{constructor(e){var t,n,r,o,i,s,a;this.url=e.url,this.body=e.body,this.headers=null!==(t=e.headers)&&void 0!==t?t:m(),this.method=null!==(n=e.method)&&void 0!==n?n:"GET",this.timeout=null!==(r=e.timeout)&&void 0!==r?r:0,this.formData=e.formData,this.disableKeepAlive=null!==(o=e.disableKeepAlive)&&void 0!==o&&o,this.proxySettings=e.proxySettings,this.streamResponseStatusCodes=e.streamResponseStatusCodes,this.withCredentials=null!==(i=e.withCredentials)&&void 0!==i&&i,this.abortSignal=e.abortSignal,this.tracingOptions=e.tracingOptions,this.onUploadProgress=e.onUploadProgress,this.onDownloadProgress=e.onDownloadProgress,this.requestId=e.requestId||(0,g.Z)(),this.allowInsecureConnection=null!==(s=e.allowInsecureConnection)&&void 0!==s&&s,this.enableBrowserStreams=null!==(a=e.enableBrowserStreams)&&void 0!==a&&a}}const v="$",b="_",T={};var w,R=n(679);const C="undefined"!=typeof process&&Boolean(process.version)&&Boolean(null===(w=process.versions)||void 0===w?void 0:w.node);function S(e,t,n){return new Promise(((r,o)=>{let i,s;const a=()=>o(new R._((null==n?void 0:n.abortErrorMsg)?null==n?void 0:n.abortErrorMsg:"The operation was aborted.")),c=()=>{(null==n?void 0:n.abortSignal)&&s&&n.abortSignal.removeEventListener("abort",s)};if(s=()=>(i&&clearTimeout(i),c(),a()),(null==n?void 0:n.abortSignal)&&n.abortSignal.aborted)return a();i=setTimeout((()=>{c(),r(t)}),e),(null==n?void 0:n.abortSignal)&&n.abortSignal.addEventListener("abort",s)}))}function k(e,t){const n=e.headers.get(t);if(!n)return;const r=Number(n);return Number.isNaN(r)?void 0:r}const E=URL,O=(URLSearchParams,"REDACTED"),P=["x-ms-client-request-id","x-ms-return-client-request-id","x-ms-useragent","x-ms-correlation-request-id","x-ms-request-id","client-request-id","ms-cv","return-client-request-id","traceparent","Access-Control-Allow-Credentials","Access-Control-Allow-Headers","Access-Control-Allow-Methods","Access-Control-Allow-Origin","Access-Control-Expose-Headers","Access-Control-Max-Age","Access-Control-Request-Headers","Access-Control-Request-Method","Origin","Accept","Accept-Encoding","Cache-Control","Connection","Content-Length","Content-Type","Date","ETag","Expires","If-Match","If-Modified-Since","If-None-Match","If-Unmodified-Since","Last-Modified","Pragma","Request-Id","Retry-After","Server","Transfer-Encoding","User-Agent","WWW-Authenticate"],I=["api-version"];class x{constructor({additionalAllowedHeaderNames:e=[],additionalAllowedQueryParameters:t=[]}={}){e=P.concat(e),t=I.concat(t),this.allowedHeaderNames=new Set(e.map((e=>e.toLowerCase()))),this.allowedQueryParameters=new Set(t.map((e=>e.toLowerCase())))}sanitize(e){const t=new Set;return JSON.stringify(e,((e,n)=>{if(n instanceof Error)return Object.assign(Object.assign({},n),{name:n.name,message:n.message});if("headers"===e)return this.sanitizeHeaders(n);if("url"===e)return this.sanitizeUrl(n);if("query"===e)return this.sanitizeQuery(n);if("body"!==e&&"response"!==e&&"operationSpec"!==e){if(Array.isArray(n)||!("object"!=typeof(r=n)||null===r||Array.isArray(r)||r instanceof RegExp||r instanceof Date)){if(t.has(n))return"[Circular]";t.add(n)}var r;return n}}),2)}sanitizeHeaders(e){const t={};for(const n of Object.keys(e))this.allowedHeaderNames.has(n.toLowerCase())?t[n]=e[n]:t[n]=O;return t}sanitizeQuery(e){if("object"!=typeof e||null===e)return e;const t={};for(const n of Object.keys(e))this.allowedQueryParameters.has(n.toLowerCase())?t[n]=e[n]:t[n]=O;return t}sanitizeUrl(e){if("string"!=typeof e||null===e)return e;const t=new E(e);if(!t.search)return e;for(const[e]of t.searchParams)this.allowedQueryParameters.has(e.toLowerCase())||t.searchParams.set(e,O);return t.toString()}}const M=new x;class N extends Error{constructor(e,t={}){super(e),this.name="RestError",this.code=t.code,this.statusCode=t.statusCode,this.request=t.request,this.response=t.response,Object.setPrototypeOf(this,N.prototype)}[T](){return`RestError: ${this.message} \n ${M.sanitize(this)}`}}function _(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function A(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}N.REQUEST_SEND_ERROR="REQUEST_SEND_ERROR",N.PARSE_ERROR="PARSE_ERROR";const q=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,U=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i;function D(e,t){var n,r;const o=e.parsedHeaders;if("HEAD"===e.request.method)return Object.assign(Object.assign({},o),{body:e.parsedBody});const i=t&&t.bodyMapper,s=Boolean(null==i?void 0:i.nullable),a=null==i?void 0:i.type.name;if("Stream"===a)return Object.assign(Object.assign({},o),{blobBody:e.blobBody,readableStreamBody:e.readableStreamBody});const c="Composite"===a&&i.type.modelProperties||{},u=Object.keys(c).some((e=>""===c[e].serializedName));if("Sequence"===a||u){const t=null!==(n=e.parsedBody)&&void 0!==n?n:[];for(const n of Object.keys(c))c[n].serializedName&&(t[n]=null===(r=e.parsedBody)||void 0===r?void 0:r[n]);if(o)for(const e of Object.keys(o))t[e]=o[e];return!s||e.parsedBody||o||0!==Object.getOwnPropertyNames(c).length?t:null}return function(e){const t=Object.assign(Object.assign({},e.headers),e.body);return e.hasNullableType&&0===Object.getOwnPropertyNames(t).length?e.shouldWrapBody?{body:null}:null:e.shouldWrapBody?Object.assign(Object.assign({},e.headers),{body:e.body}):t}({body:e.parsedBody,headers:o,hasNullableType:s,shouldWrapBody:(l=e.parsedBody,d=a,"Composite"!==d&&"Dictionary"!==d&&("string"==typeof l||"number"==typeof l||"boolean"==typeof l||null!==(null==d?void 0:d.match(/^(Date|DateTime|DateTimeRfc1123|UnixTime|ByteArray|Base64Url)$/i))||null==l))});var l,d}class j{constructor(e={},t=!1){this.modelMappers=e,this.isXML=t}validateConstraints(e,t,n){const r=(e,r)=>{throw new Error(`"${n}" with value "${t}" should satisfy the constraint "${e}": ${r}.`)};if(e.constraints&&null!=t){const{ExclusiveMaximum:n,ExclusiveMinimum:o,InclusiveMaximum:i,InclusiveMinimum:s,MaxItems:a,MaxLength:c,MinItems:u,MinLength:l,MultipleOf:d,Pattern:p,UniqueItems:h}=e.constraints;if(void 0!==n&&t>=n&&r("ExclusiveMaximum",n),void 0!==o&&t<=o&&r("ExclusiveMinimum",o),void 0!==i&&t>i&&r("InclusiveMaximum",i),void 0!==s&&t<s&&r("InclusiveMinimum",s),void 0!==a&&t.length>a&&r("MaxItems",a),void 0!==c&&t.length>c&&r("MaxLength",c),void 0!==u&&t.length<u&&r("MinItems",u),void 0!==l&&t.length<l&&r("MinLength",l),void 0!==d&&t%d!=0&&r("MultipleOf",d),p){const e="string"==typeof p?new RegExp(p):p;"string"==typeof t&&null!==t.match(e)||r("Pattern",p)}h&&t.some(((e,t,n)=>n.indexOf(e)!==t))&&r("UniqueItems",h)}}serialize(e,t,n,r={xml:{}}){var o,i,s;const a={xml:{rootName:null!==(o=r.xml.rootName)&&void 0!==o?o:"",includeRoot:null!==(i=r.xml.includeRoot)&&void 0!==i&&i,xmlCharKey:null!==(s=r.xml.xmlCharKey)&&void 0!==s?s:b}};let c={};const u=e.type.name;n||(n=e.serializedName),null!==u.match(/^Sequence$/i)&&(c=[]),e.isConstant&&(t=e.defaultValue);const{required:l,nullable:d}=e;if(l&&d&&void 0===t)throw new Error(`${n} cannot be undefined.`);if(l&&!d&&null==t)throw new Error(`${n} cannot be null or undefined.`);if(!l&&!1===d&&null===t)throw new Error(`${n} cannot be null.`);return null==t?c=t:(this.validateConstraints(e,t,n),null!==u.match(/^any$/i)?c=t:null!==u.match(/^(Number|String|Boolean|Object|Stream|Uuid)$/i)?c=function(e,t,n){if(null!=n)if(null!==e.match(/^Number$/i)){if("number"!=typeof n)throw new Error(`${t} with value ${n} must be of type number.`)}else if(null!==e.match(/^String$/i)){if("string"!=typeof n.valueOf())throw new Error(`${t} with value "${n}" must be of type string.`)}else if(null!==e.match(/^Uuid$/i)){if("string"!=typeof n.valueOf()||(r=n,!U.test(r)))throw new Error(`${t} with value "${n}" must be of type string and a valid uuid.`)}else if(null!==e.match(/^Boolean$/i)){if("boolean"!=typeof n)throw new Error(`${t} with value ${n} must be of type boolean.`)}else if(null!==e.match(/^Stream$/i)&&!("string"==typeof n||"function"==typeof n.pipe||n instanceof ArrayBuffer||ArrayBuffer.isView(n)||("function"==typeof Blob||"object"==typeof Blob)&&n instanceof Blob))throw new Error(`${t} must be a string, Blob, ArrayBuffer, ArrayBufferView, or NodeJS.ReadableStream.`);var r;return n}(u,n,t):null!==u.match(/^Enum$/i)?c=function(e,t,n){if(!t)throw new Error(`Please provide a set of allowedValues to validate ${e} as an Enum Type.`);if(!t.some((e=>"string"==typeof e.valueOf()?e.toLowerCase()===n.toLowerCase():e===n)))throw new Error(`${n} is not a valid value for ${e}. The valid values are: ${JSON.stringify(t)}.`);return n}(n,e.type.allowedValues,t):null!==u.match(/^(Date|DateTime|TimeSpan|DateTimeRfc1123|UnixTime)$/i)?c=function(e,t,n){if(null!=t)if(null!==e.match(/^Date$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in ISO8601 format.`);t=t instanceof Date?t.toISOString().substring(0,10):new Date(t).toISOString().substring(0,10)}else if(null!==e.match(/^DateTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in ISO8601 format.`);t=t instanceof Date?t.toISOString():new Date(t).toISOString()}else if(null!==e.match(/^DateTimeRfc1123$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in RFC-1123 format.`);t=t instanceof Date?t.toUTCString():new Date(t).toUTCString()}else if(null!==e.match(/^UnixTime$/i)){if(!(t instanceof Date||"string"==typeof t.valueOf()&&!isNaN(Date.parse(t))))throw new Error(`${n} must be an instanceof Date or a string in RFC-1123/ISO8601 format for it to be serialized in UnixTime/Epoch format.`);t=function(e){if(e)return"string"==typeof e.valueOf()&&(e=new Date(e)),Math.floor(e.getTime()/1e3)}(t)}else if(null!==e.match(/^TimeSpan$/i)&&!function(e){return q.test(e)}(t))throw new Error(`${n} must be a string in ISO 8601 format. Instead was "${t}".`);return t}(u,t,n):null!==u.match(/^ByteArray$/i)?c=function(e,t){if(null!=t){if(!(t instanceof Uint8Array))throw new Error(`${e} must be of type Uint8Array.`);t=_(t)}return t}(n,t):null!==u.match(/^Base64Url$/i)?c=function(e,t){if(null!=t){if(!(t instanceof Uint8Array))throw new Error(`${e} must be of type Uint8Array.`);t=function(e){if(e){if(!(e instanceof Uint8Array))throw new Error("Please provide an input of type Uint8Array for converting to Base64Url.");return function(e,t){let n=e.length;for(;n-1>=0&&"="===e[n-1];)--n;return e.substr(0,n)}(_(e)).replace(/\+/g,"-").replace(/\//g,"_")}}(t)}return t}(n,t):null!==u.match(/^Sequence$/i)?c=function(e,t,n,r,o,i){var s;if(!Array.isArray(n))throw new Error(`${r} must be of type Array.`);let a=t.type.element;if(!a||"object"!=typeof a)throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}.`);"Composite"===a.type.name&&a.type.className&&(a=null!==(s=e.modelMappers[a.type.className])&&void 0!==s?s:a);const c=[];for(let t=0;t<n.length;t++){const s=e.serialize(a,n[t],r,i);if(o&&a.xmlNamespace){const e=a.xmlNamespacePrefix?`xmlns:${a.xmlNamespacePrefix}`:"xmlns";"Composite"===a.type.name?(c[t]=Object.assign({},s),c[t][v]={[e]:a.xmlNamespace}):(c[t]={},c[t][i.xml.xmlCharKey]=s,c[t][v]={[e]:a.xmlNamespace})}else c[t]=s}return c}(this,e,t,n,Boolean(this.isXML),a):null!==u.match(/^Dictionary$/i)?c=function(e,t,n,r,o,i){if("object"!=typeof n)throw new Error(`${r} must be of type object.`);const s=t.type.value;if(!s||"object"!=typeof s)throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}.`);const a={};for(const t of Object.keys(n)){const c=e.serialize(s,n[t],r,i);a[t]=H(s,c,o,i)}if(o&&t.xmlNamespace){const e=t.xmlNamespacePrefix?`xmlns:${t.xmlNamespacePrefix}`:"xmlns",n=a;return n[v]={[e]:t.xmlNamespace},n}return a}(this,e,t,n,Boolean(this.isXML),a):null!==u.match(/^Composite$/i)&&(c=function(e,t,n,r,o,i){if(G(e,t)&&(t=V(e,t,n,"clientName")),null!=n){const s={},a=B(e,t,r);for(const c of Object.keys(a)){const u=a[c];if(u.readOnly)continue;let l,d=s;if(e.isXML)l=u.xmlIsWrapped?u.xmlName:u.xmlElementName||u.xmlName;else{const e=z(u.serializedName);l=e.pop();for(const t of e){null==d[t]&&(void 0!==n[c]&&null!==n[c]||void 0!==u.defaultValue)&&(d[t]={}),d=d[t]}}if(null!=d){if(o&&t.xmlNamespace){const e=t.xmlNamespacePrefix?`xmlns:${t.xmlNamespacePrefix}`:"xmlns";d[v]=Object.assign(Object.assign({},d[v]),{[e]:t.xmlNamespace})}const s=""!==u.serializedName?r+"."+u.serializedName:r;let a=n[c];const p=G(e,t);p&&p.clientName===c&&null==a&&(a=t.serializedName);const h=e.serialize(u,a,s,i);if(void 0!==h&&null!=l){const e=H(u,h,o,i);o&&u.xmlIsAttribute?(d[v]=d[v]||{},d[v][l]=h):o&&u.xmlIsWrapped?d[l]={[u.xmlElementName]:e}:d[l]=e}}}const c=function(e,t,n){const r=t.type.additionalProperties;if(!r&&t.type.className){const r=$(e,t,n);return null==r?void 0:r.type.additionalProperties}return r}(e,t,r);if(c){const t=Object.keys(a);for(const o in n)t.every((e=>e!==o))&&(s[o]=e.serialize(c,n[o],r+'["'+o+'"]',i))}return s}return n}(this,e,t,n,Boolean(this.isXML),a))),c}deserialize(e,t,n,r={xml:{}}){var o,i,s;const a={xml:{rootName:null!==(o=r.xml.rootName)&&void 0!==o?o:"",includeRoot:null!==(i=r.xml.includeRoot)&&void 0!==i&&i,xmlCharKey:null!==(s=r.xml.xmlCharKey)&&void 0!==s?s:b}};if(null==t)return this.isXML&&"Sequence"===e.type.name&&!e.xmlIsWrapped&&(t=[]),void 0!==e.defaultValue&&(t=e.defaultValue),t;let c;const u=e.type.name;if(n||(n=e.serializedName),null!==u.match(/^Composite$/i))c=function(e,t,n,r,o){var i;G(e,t)&&(t=V(e,t,n,"serializedName"));const s=B(e,t,r);let a={};const c=[];for(const u of Object.keys(s)){const l=s[u],d=z(s[u].serializedName);c.push(d[0]);const{serializedName:p,xmlName:h,xmlElementName:f}=l;let m=r;""!==p&&void 0!==p&&(m=r+"."+p);const g=l.headerCollectionPrefix;if(g){const t={};for(const r of Object.keys(n))r.startsWith(g)&&(t[r.substring(g.length)]=e.deserialize(l.type.value,n[r],m,o)),c.push(r);a[u]=t}else if(e.isXML)if(l.xmlIsAttribute&&n[v])a[u]=e.deserialize(l,n[v][h],m,o);else{const t=f||h||p;if(l.xmlIsWrapped){const t=n[h],r=null!==(i=null==t?void 0:t[f])&&void 0!==i?i:[];a[u]=e.deserialize(l,r,m,o)}else{const r=n[t];a[u]=e.deserialize(l,r,m,o)}}else{let r,i=n;for(const e of d){if(!i)break;i=i[e]}r=i;const c=t.type.polymorphicDiscriminator;let p;if(c&&u===c.clientName&&null==r&&(r=t.serializedName),Array.isArray(n[u])&&""===s[u].serializedName){r=n[u];const t=e.deserialize(l,r,m,o);for(const[e,n]of Object.entries(a))Object.prototype.hasOwnProperty.call(t,e)||(t[e]=n);a=t}else void 0===r&&void 0===l.defaultValue||(p=e.deserialize(l,r,m,o),a[u]=p)}}const u=t.type.additionalProperties;if(u){const t=e=>{for(const t in s)if(z(s[t].serializedName)[0]===e)return!1;return!0};for(const i in n)t(i)&&(a[i]=e.deserialize(u,n[i],r+'["'+i+'"]',o))}else if(n)for(const e of Object.keys(n))void 0!==a[e]||c.includes(e)||F(e,o)||(a[e]=n[e]);return a}(this,e,t,n,a);else{if(this.isXML){const e=a.xml.xmlCharKey;void 0!==t[v]&&void 0!==t[e]&&(t=t[e])}null!==u.match(/^Number$/i)?(c=parseFloat(t),isNaN(c)&&(c=t)):null!==u.match(/^Boolean$/i)?c="true"===t||"false"!==t&&t:null!==u.match(/^(String|Enum|Object|Stream|Uuid|TimeSpan|any)$/i)?c=t:null!==u.match(/^(Date|DateTime|DateTimeRfc1123)$/i)?c=new Date(t):null!==u.match(/^UnixTime$/i)?c=function(e){if(e)return new Date(1e3*e)}(t):null!==u.match(/^ByteArray$/i)?c=A(t):null!==u.match(/^Base64Url$/i)?c=function(e){if(e){if(e&&"string"!=typeof e.valueOf())throw new Error("Please provide an input of type string for converting to Uint8Array");return A(e=e.replace(/-/g,"+").replace(/_/g,"/"))}}(t):null!==u.match(/^Sequence$/i)?c=function(e,t,n,r,o){var i;let s=t.type.element;if(!s||"object"!=typeof s)throw new Error(`element" metadata for an Array must be defined in the mapper and it must of type "object" in ${r}`);if(n){Array.isArray(n)||(n=[n]),"Composite"===s.type.name&&s.type.className&&(s=null!==(i=e.modelMappers[s.type.className])&&void 0!==i?i:s);const t=[];for(let i=0;i<n.length;i++)t[i]=e.deserialize(s,n[i],`${r}[${i}]`,o);return t}return n}(this,e,t,n,a):null!==u.match(/^Dictionary$/i)&&(c=function(e,t,n,r,o){const i=t.type.value;if(!i||"object"!=typeof i)throw new Error(`"value" metadata for a Dictionary must be defined in the mapper and it must of type "object" in ${r}`);if(n){const t={};for(const s of Object.keys(n))t[s]=e.deserialize(i,n[s],r,o);return t}return n}(this,e,t,n,a))}return e.isConstant&&(c=e.defaultValue),c}}function L(e={},t=!1){return new j(e,t)}function z(e){const t=[];let n="";if(e){const r=e.split(".");for(const e of r)"\\"===e.charAt(e.length-1)?n+=e.substr(0,e.length-1)+".":(n+=e,t.push(n),n="")}return t}function $(e,t,n){const r=t.type.className;if(!r)throw new Error(`Class name for model "${n}" is not provided in the mapper "${JSON.stringify(t,void 0,2)}".`);return e.modelMappers[r]}function B(e,t,n){let r=t.type.modelProperties;if(!r){const o=$(e,t,n);if(!o)throw new Error(`mapper() cannot be null or undefined for model "${t.type.className}".`);if(r=null==o?void 0:o.type.modelProperties,!r)throw new Error(`modelProperties cannot be null or undefined in the mapper "${JSON.stringify(o)}" of type "${t.type.className}" for object "${n}".`)}return r}function H(e,t,n,r){if(!n||!e.xmlNamespace)return t;const o={[e.xmlNamespacePrefix?`xmlns:${e.xmlNamespacePrefix}`:"xmlns"]:e.xmlNamespace};if(["Composite"].includes(e.type.name)){if(t[v])return t;{const e=Object.assign({},t);return e[v]=o,e}}const i={};return i[r.xml.xmlCharKey]=t,i[v]=o,i}function F(e,t){return[v,t.xml.xmlCharKey].includes(e)}function V(e,t,n,r){const o=G(e,t);if(o){let i=o[r];if(i){"serializedName"===r&&(i=i.replace(/\\/gi,""));const o=n[i];if(null!=o){const n=t.type.uberParent||t.type.className,r=o===n?o:n+"."+o,i=e.modelMappers.discriminators[r];i&&(t=i)}}}return t}function G(e,t){return t.type.polymorphicDiscriminator||J(e,t.type.uberParent)||J(e,t.type.className)}function J(e,t){return t&&e.modelMappers[t]&&e.modelMappers[t].type.polymorphicDiscriminator}const X="Sequence",K="Stream";function Q(e,t,n){let r=t.parameterPath;const o=t.mapper;let i;if("string"==typeof r&&(r=[r]),Array.isArray(r)){if(r.length>0)if(o.isConstant)i=o.defaultValue;else{let t=W(e,r);!t.propertyFound&&n&&(t=W(n,r));let s=!1;t.propertyFound||(s=o.required||"options"===r[0]&&2===r.length),i=s?o.defaultValue:t.propertyValue}}else{o.required&&(i={});for(const t in r){const s=o.type.modelProperties[t],a=Q(e,{parameterPath:r[t],mapper:s},n);void 0!==a&&(i||(i={}),i[t]=a)}}return i}function W(e,t){const n={propertyFound:!1};let r=0;for(;r<t.length;++r){const n=t[r];if(!e||!(n in e))break;e=e[n]}return r===t.length&&(n.propertyValue=e,n.propertyFound=!0),n}const Y=new WeakMap;function Z(e){let t=Y.get(e);return t||(t={},Y.set(e,t)),t}const ee=["application/json","text/json"],te=["application/xml","application/atom+xml"];const ne=new Set(["Deserialize","Serialize","Retry","Sign"]);class re{constructor(e=[]){this._policies=[],this._policies=e,this._orderedPolicies=void 0}addPolicy(e,t={}){if(t.phase&&t.afterPhase)throw new Error("Policies inside a phase cannot specify afterPhase.");if(t.phase&&!ne.has(t.phase))throw new Error(`Invalid phase name: ${t.phase}`);if(t.afterPhase&&!ne.has(t.afterPhase))throw new Error(`Invalid afterPhase name: ${t.afterPhase}`);this._policies.push({policy:e,options:t}),this._orderedPolicies=void 0}removePolicy(e){const t=[];return this._policies=this._policies.filter((n=>!(e.name&&n.policy.name===e.name||e.phase&&n.options.phase===e.phase)||(t.push(n.policy),!1))),this._orderedPolicies=void 0,t}sendRequest(e,t){return this.getOrderedPolicies().reduceRight(((e,t)=>n=>t.sendRequest(n,e)),(t=>e.sendRequest(t)))(t)}getOrderedPolicies(){return this._orderedPolicies||(this._orderedPolicies=this.orderPolicies()),this._orderedPolicies}clone(){return new re(this._policies)}static create(){return new re}orderPolicies(){const e=[],t=new Map;function n(e){return{name:e,policies:new Set,hasRun:!1}}const r=n("Serialize"),o=n("None"),i=n("Deserialize"),s=n("Retry"),a=n("Sign"),c=[r,o,i,s,a];function u(e){return"Retry"===e?s:"Serialize"===e?r:"Deserialize"===e?i:"Sign"===e?a:o}for(const e of this._policies){const n=e.policy,r=e.options,o=n.name;if(t.has(o))throw new Error("Duplicate policy names not allowed in pipeline");const i={policy:n,dependsOn:new Set,dependants:new Set};r.afterPhase&&(i.afterPhase=u(r.afterPhase)),t.set(o,i),u(r.phase).policies.add(i)}for(const e of this._policies){const{policy:n,options:r}=e,o=n.name,i=t.get(o);if(!i)throw new Error(`Missing node for policy ${o}`);if(r.afterPolicies)for(const e of r.afterPolicies){const n=t.get(e);n&&(i.dependsOn.add(n),n.dependants.add(i))}if(r.beforePolicies)for(const e of r.beforePolicies){const n=t.get(e);n&&(n.dependsOn.add(i),i.dependants.add(n))}}function l(n){n.hasRun=!0;for(const r of n.policies)if((!r.afterPhase||r.afterPhase.hasRun&&!r.afterPhase.policies.size)&&0===r.dependsOn.size){e.push(r.policy);for(const e of r.dependants)e.dependsOn.delete(r);t.delete(r.policy.name),n.policies.delete(r)}}function d(){for(const e of c)if(l(e),e.policies.size>0&&e!==o)return void(o.hasRun||l(o))}let p=0;for(;t.size>0;){p++;const t=e.length;if(d(),e.length<=t&&p>1)throw new Error("Cannot satisfy policy dependencies due to requirements cycle.")}return e}}const oe=new Error("decompressResponsePolicy is not supported in browser environment");var ie=n(901);const se=(0,ie.YR)("core-rest-pipeline"),ae=new Error("proxyPolicy is not supported in browser environment"),ce=["GET","HEAD"];function ue(e={}){const{maxRetries:t=20}=e;return{name:"redirectPolicy",async sendRequest(e,n){const r=await n(e);return le(n,r,t)}}}async function le(e,t,n,r=0){const{request:o,status:i,headers:s}=t,a=s.get("location");if(a&&(300===i||301===i&&ce.includes(o.method)||302===i&&ce.includes(o.method)||303===i&&"POST"===o.method||307===i)&&r<n){const t=new E(a,o.url);o.url=t.toString(),303===i&&(o.method="GET",o.headers.delete("Content-Length"),delete o.body),o.headers.delete("Authorization");const s=await e(o);return le(e,s,n,r+1)}return t}var de=n(951),pe=n(809),he=n(771);function fe(e){const t=new Map;t.set("core-rest-pipeline","1.8.0"),function(e){const t=self.navigator;e.set("OS",(t.oscpu||t.platform).replace(" ",""))}(t);const n=function(e){const t=[];for(const[n,r]of e){const e=r?`${n}/${r}`:n;t.push(e)}return t.join(" ")}(t);return e?`${e} ${n}`:n}const me=(0,de.q)({packagePrefix:"",namespace:""});const ge="x-ms-useragent",ye="Retry-After",ve=["retry-after-ms","x-ms-retry-after-ms",ye];function be(e){if(e&&[429,503].includes(e.status))try{for(const t of ve){const n=k(e,t);if(0===n||n)return n*(t===ye?1e3:1)}const t=e.headers.get(ye);if(!t)return;const n=Date.parse(t)-Date.now();return Number.isFinite(n)?Math.max(0,n):void 0}catch(e){return}}function Te(e={}){var t,n;const r=null!==(t=e.retryDelayInMs)&&void 0!==t?t:1e3,o=null!==(n=e.maxRetryDelayInMs)&&void 0!==n?n:64e3;let i=r;return{name:"exponentialRetryStrategy",retry({retryCount:t,response:n,responseError:r}){const s=!!(d=r)&&("ETIMEDOUT"===d.code||"ESOCKETTIMEDOUT"===d.code||"ECONNREFUSED"===d.code||"ECONNRESET"===d.code||"ENOENT"===d.code),a=s&&e.ignoreSystemErrors,c=function(e){return Boolean(e&&void 0!==e.status&&(e.status>=500||408===e.status)&&501!==e.status&&505!==e.status)}(n),u=c&&e.ignoreHttpStatusCodes,l=n&&(function(e){return Number.isFinite(be(e))}(n)||!c);var d;if(l||u||a)return{skipStrategy:!0};if(r&&!s&&!c)return{errorToThrow:r};const p=i*Math.pow(2,t),h=Math.min(o,p);var f,m;return i=h/2+(f=0,m=h/2,f=Math.ceil(f),m=Math.floor(m),Math.floor(Math.random()*(m-f+1))+f),{retryAfterInMs:i}}}}const we=(0,ie.YR)("core-rest-pipeline retryPolicy");function Re(e,t={maxRetries:3}){const n=t.logger||we;return{name:"retryPolicy",async sendRequest(r,o){var i,s;let a,c,u=-1;e:for(;;){u+=1,a=void 0,c=void 0;try{n.info(`Retry ${u}: Attempting to send request`,r.requestId),a=await o(r),n.info(`Retry ${u}: Received a response from request`,r.requestId)}catch(e){if(n.error(`Retry ${u}: Received an error from request`,r.requestId),c=e,!e||"RestError"!==c.name)throw e;a=c.response}if(null===(i=r.abortSignal)||void 0===i?void 0:i.aborted)throw n.error(`Retry ${u}: Request aborted.`),new R._;if(u>=(null!==(s=t.maxRetries)&&void 0!==s?s:3)){if(n.info(`Retry ${u}: Maximum retries reached. Returning the last received response, or throwing the last received error.`),c)throw c;if(a)return a;throw new Error("Maximum retries reached with no response or error to throw")}n.info(`Retry ${u}: Processing ${e.length} retry strategies.`);t:for(const t of e){const e=t.logger||we;e.info(`Retry ${u}: Processing retry strategy ${t.name}.`);const n=t.retry({retryCount:u,response:a,responseError:c});if(n.skipStrategy){e.info(`Retry ${u}: Skipped.`);continue t}const{errorToThrow:o,retryAfterInMs:i,redirectTo:s}=n;if(o)throw e.error(`Retry ${u}: Retry strategy ${t.name} throws error:`,o),o;if(i||0===i){e.info(`Retry ${u}: Retry strategy ${t.name} retries after ${i}`),await S(i,void 0,{abortSignal:r.abortSignal});continue e}if(s){e.info(`Retry ${u}: Retry strategy ${t.name} redirects to ${s}`),r.url=s;continue e}}if(c)throw n.info("None of the retry strategies could work with the received error. Throwing it."),c;if(a)return n.info("None of the retry strategies could work with the received response. Returning it."),a}}}}function Ce(e){const t=re.create();return C&&(t.addPolicy(function(){throw ae}(e.proxyOptions)),t.addPolicy(function(){throw oe}())),t.addPolicy({name:"formDataPolicy",async sendRequest(e,t){if(e.formData){const t=e.formData,n=new FormData;for(const e of Object.keys(t)){const r=t[e];if(Array.isArray(r))for(const t of r)n.append(e,t);else n.append(e,r)}e.body=n,e.formData=void 0;const r=e.headers.get("Content-Type");r&&-1!==r.indexOf("application/x-www-form-urlencoded")?e.body=new URLSearchParams(n).toString():r&&-1!==r.indexOf("multipart/form-data")&&e.headers.delete("Content-Type")}return t(e)}}),t.addPolicy(function(e={}){const t=fe(e.userAgentPrefix);return{name:"userAgentPolicy",sendRequest:async(e,n)=>(e.headers.has(ge)||e.headers.set(ge,t),n(e))}}(e.userAgentOptions)),t.addPolicy(function(e="x-ms-client-request-id"){return{name:"setClientRequestIdPolicy",sendRequest:async(t,n)=>(t.headers.has(e)||t.headers.set(e,t.requestId),n(t))}}()),t.addPolicy(function(e={}){var t;return{name:"defaultRetryPolicy",sendRequest:Re([{name:"throttlingRetryStrategy",retry({response:e}){const t=be(e);return Number.isFinite(t)?{retryAfterInMs:t}:{skipStrategy:!0}}},Te(e)],{maxRetries:null!==(t=e.maxRetries)&&void 0!==t?t:3}).sendRequest}}(e.retryOptions),{phase:"Retry"}),t.addPolicy(function(e={}){const t=fe(e.userAgentPrefix);return{name:"tracingPolicy",async sendRequest(e,n){var r;if(!(null===(r=e.tracingOptions)||void 0===r?void 0:r.tracingContext))return n(e);const o=function(e,t){var n,r,o;try{const i=Object.assign(Object.assign({},null===(n=e.tracingOptions)||void 0===n?void 0:n.spanOptions),{kind:he.MU.CLIENT}),{span:s}=me(`HTTP ${e.method}`,{tracingOptions:Object.assign(Object.assign({},e.tracingOptions),{spanOptions:i})});if(!s.isRecording())return void s.end();const a=null===(o=null===(r=e.tracingOptions)||void 0===r?void 0:r.tracingContext)||void 0===o?void 0:o.getValue(Symbol.for("az.namespace"));"string"==typeof a&&s.setAttribute("az.namespace",a),s.setAttributes({"http.method":e.method,"http.url":e.url,requestId:e.requestId}),t&&s.setAttribute("http.user_agent",t);const c=s.spanContext(),u=(0,pe.O)(c);if(u&&(0,he.BM)(c)){e.headers.set("traceparent",u);const t=c.traceState&&c.traceState.serialize();t&&e.headers.set("tracestate",t)}return s}catch(e){return void se.warning(`Skipping creating a tracing span due to an error: ${e.message}`)}}(e,t);if(!o)return n(e);try{const t=await n(e);return function(e,t){try{e.setAttribute("http.status_code",t.status);const n=t.headers.get("x-ms-request-id");n&&e.setAttribute("serviceRequestId",n),e.setStatus({code:he.Qn.OK}),e.end()}catch(e){se.warning(`Skipping tracing span processing due to an error: ${e.message}`)}}(o,t),t}catch(e){throw function(e,t){try{e.setStatus({code:he.Qn.ERROR,message:t.message}),t.statusCode&&e.setAttribute("http.status_code",t.statusCode),e.end()}catch(e){se.warning(`Skipping tracing span processing due to an error: ${e.message}`)}}(o,e),e}}}}(e.userAgentOptions),{afterPhase:"Retry"}),C&&t.addPolicy(ue(e.redirectOptions),{afterPhase:"Retry"}),t.addPolicy(function(e={}){var t;const n=null!==(t=e.logger)&&void 0!==t?t:se.info,r=new x({additionalAllowedHeaderNames:e.additionalAllowedHeaderNames,additionalAllowedQueryParameters:e.additionalAllowedQueryParameters});return{name:"logPolicy",async sendRequest(e,t){if(!n.enabled)return t(e);n(`Request: ${r.sanitize(e)}`);const o=await t(e);return n(`Response status code: ${o.status}`),n(`Headers: ${r.sanitize(o.headers)}`),o}}}(e.loggingOptions),{afterPhase:"Retry"}),t}const Se={forcedRefreshWindowInMs:1e3,retryIntervalInMs:3e3,refreshWindowInMs:12e4};async function ke(e){const{scopes:t,getAccessToken:n,request:r}=e,o={abortSignal:r.abortSignal,tracingOptions:r.tracingOptions},i=await n(t,o);i&&e.request.headers.set("Authorization",`Bearer ${i.token}`)}function Ee(e){var t;const{credential:n,scopes:r,challengeCallbacks:o,logger:i}=e,s=Object.assign({authorizeRequest:null!==(t=null==o?void 0:o.authorizeRequest)&&void 0!==t?t:ke,authorizeRequestOnChallenge:null==o?void 0:o.authorizeRequestOnChallenge},o),a=n?function(e,t){let n=null,r=null;const o=Object.assign(Object.assign({},Se),t),i={get isRefreshing(){return null!==n},get shouldRefresh(){var e;return!i.isRefreshing&&(null!==(e=null==r?void 0:r.expiresOnTimestamp)&&void 0!==e?e:0)-o.refreshWindowInMs<Date.now()},get mustRefresh(){return null===r||r.expiresOnTimestamp-o.forcedRefreshWindowInMs<Date.now()}};function s(t,s){var a;return i.isRefreshing||(n=async function(e,t,n){async function r(){if(!(Date.now()<n)){const t=await e();if(null===t)throw new Error("Failed to refresh access token.");return t}try{return await e()}catch(e){return null}}let o=await r();for(;null===o;)await S(t),o=await r();return o}((()=>e.getToken(t,s)),o.retryIntervalInMs,null!==(a=null==r?void 0:r.expiresOnTimestamp)&&void 0!==a?a:Date.now()).then((e=>(n=null,r=e,r))).catch((e=>{throw n=null,r=null,e}))),n}return async(e,t)=>i.mustRefresh?s(e,t):(i.shouldRefresh&&s(e,t),r)}(n):()=>Promise.resolve(null);return{name:"bearerTokenAuthenticationPolicy",async sendRequest(e,t){if(!e.url.toLowerCase().startsWith("https://"))throw new Error("Bearer token authentication is not permitted for non-TLS protected (non-https) URLs.");let n,o;await s.authorizeRequest({scopes:Array.isArray(r)?r:[r],request:e,getAccessToken:a,logger:i});try{n=await t(e)}catch(e){o=e,n=e.response}if(s.authorizeRequestOnChallenge&&401===(null==n?void 0:n.status)&&function(e){const t=e.headers.get("WWW-Authenticate");if(401===e.status&&t)return t}(n)&&await s.authorizeRequestOnChallenge({scopes:Array.isArray(r)?r:[r],request:e,response:n,getAccessToken:a,logger:i}))return t(e);if(o)throw o;return n}}}function Oe(e){const{parameterPath:t,mapper:n}=e;let r;return r="string"==typeof t?t:Array.isArray(t)?t.join("."):n.serializedName,r}function Pe(e){return Boolean(e&&"function"==typeof e.getReader&&"function"==typeof e.tee)}class Ie{async sendRequest(e){if("https:"!==new URL(e.url).protocol&&!e.allowInsecureConnection)throw new Error(`Cannot connect to ${e.url} while allowInsecureConnection is false.`);if(e.proxySettings)throw new Error("HTTP proxy is not supported in browser environment");try{return await async function(e){const{abortController:t,abortControllerCleanup:n}=function(e){const t=new AbortController;let n,r;if(e.abortSignal){if(e.abortSignal.aborted)throw new R._("The operation was aborted.");r=e=>{"abort"===e.type&&t.abort()},e.abortSignal.addEventListener("abort",r),n=()=>{var t;r&&(null===(t=e.abortSignal)||void 0===t||t.removeEventListener("abort",r))}}return e.timeout>0&&setTimeout((()=>{t.abort()}),e.timeout),{abortController:t,abortControllerCleanup:n}}(e);try{const r=function(e){const t=new Headers;for(const[n,r]of e)t.append(n,r);return t}(e.headers),o=function(e){const t="function"==typeof e.body?e.body():e.body;if(function(e){return e&&"function"==typeof e.pipe}(t))throw new Error("Node streams are not supported in browser environment.");return Pe(t)?xe(t,e.onUploadProgress):t}(e);return async function(e,t){var n,r;const o=function(e){const t=m();for(const[n,r]of e.headers)t.set(n,r);return t}(e),i={request:t,headers:o,status:e.status},s=Pe(e.body)?xe(e.body,t.onDownloadProgress):e.body;if((null===(n=t.streamResponseStatusCodes)||void 0===n?void 0:n.has(Number.POSITIVE_INFINITY))||(null===(r=t.streamResponseStatusCodes)||void 0===r?void 0:r.has(i.status)))if(t.enableBrowserStreams)i.browserStreamBody=null!=s?s:void 0;else{const e=new Response(s);i.blobBody=e.blob()}else{const e=new Response(s);i.bodyAsText=await e.text()}return i}(await fetch(e.url,{body:o,method:e.method,headers:r,signal:t.signal,credentials:e.withCredentials?"include":"same-origin",cache:"no-store"}),e)}finally{n&&n()}}(e)}catch(t){throw function(e,t){var n;return e&&"AbortError"===(null==e?void 0:e.name)?e:new N(`Error sending request: ${e.message}`,{code:null!==(n=null==e?void 0:e.code)&&void 0!==n?n:N.REQUEST_SEND_ERROR,request:t})}(t,e)}}}function xe(e,t){let n=0;if(function(e){return void 0!==e.pipeThrough&&void 0!==self.TransformStream}(e))return e.pipeThrough(new TransformStream({transform(e,r){null!==e?(r.enqueue(e),n+=e.length,t&&t({loadedBytes:n})):r.terminate()}}));{const r=e.getReader();return new ReadableStream({async pull(e){var o;const{done:i,value:s}=await r.read();if(i||!s)return e.close(),void r.releaseLock();n+=null!==(o=null==s?void 0:s.length)&&void 0!==o?o:0,e.enqueue(s),t&&t({loadedBytes:n})}})}}let Me;const Ne={CSV:",",SSV:" ",Multi:"Multi",TSV:"\t",Pipes:"|"};function _e(e,t,n,r){const o=function(e,t,n){var r;const o=new Map;if(null===(r=e.urlParameters)||void 0===r?void 0:r.length)for(const r of e.urlParameters){let i=Q(t,r,n);const s=Oe(r);i=e.serializer.serialize(r.mapper,i,s),r.skipEncoding||(i=encodeURIComponent(i)),o.set(`{${r.mapper.serializedName||s}}`,i)}return o}(t,n,r);let i=!1,s=Ae(e,o);if(t.path){let e=Ae(t.path,o);"/{nextLink}"===t.path&&e.startsWith("/")&&(e=e.substring(1)),e.includes("://")?(s=e,i=!0):s=function(e,t){if(!t)return e;const n=new URL(e);let r=n.pathname;r.endsWith("/")||(r=`${r}/`),t.startsWith("/")&&(t=t.substring(1));const o=t.indexOf("?");if(-1!==o){const e=t.substring(0,o),i=t.substring(o+1);r+=e,i&&(n.search=n.search?`${n.search}&${i}`:i)}else r+=t;return n.pathname=r,n.toString()}(s,e)}const{queryParams:a,sequenceParams:c}=function(e,t,n){var r;const o=new Map,i=new Set;if(null===(r=e.queryParameters)||void 0===r?void 0:r.length)for(const r of e.queryParameters){"Sequence"===r.mapper.type.name&&r.mapper.serializedName&&i.add(r.mapper.serializedName);let s=Q(t,r,n);if(null!=s||r.mapper.required){s=e.serializer.serialize(r.mapper,s,Oe(r));const t=r.collectionFormat?Ne[r.collectionFormat]:"";if(Array.isArray(s)&&(s=s.map((e=>null==e?"":e))),"Multi"===r.collectionFormat&&0===s.length)continue;!Array.isArray(s)||"SSV"!==r.collectionFormat&&"TSV"!==r.collectionFormat||(s=s.join(t)),r.skipEncoding||(s=Array.isArray(s)?s.map((e=>encodeURIComponent(e))):encodeURIComponent(s)),!Array.isArray(s)||"CSV"!==r.collectionFormat&&"Pipes"!==r.collectionFormat||(s=s.join(t)),o.set(r.mapper.serializedName||Oe(r),s)}}return{queryParams:o,sequenceParams:i}}(t,n,r);return s=function(e,t,n,r=!1){if(0===t.size)return e;const o=new URL(e),i=function(e){const t=new Map;if(!e||"?"!==e[0])return t;const n=(e=e.slice(1)).split("&");for(const e of n){const[n,r]=e.split("=",2),o=t.get(n);o?Array.isArray(o)?o.push(r):t.set(n,[o,r]):t.set(n,r)}return t}(o.search);for(const[e,o]of t){const t=i.get(e);if(Array.isArray(t))if(Array.isArray(o)){t.push(...o);const n=new Set(t);i.set(e,Array.from(n))}else t.push(o);else t?(Array.isArray(o)?o.unshift(t):n.has(e)&&i.set(e,[t,o]),r||i.set(e,o)):i.set(e,o)}const s=[];for(const[e,t]of i)if("string"==typeof t)s.push(`${e}=${t}`);else if(Array.isArray(t))for(const n of t)s.push(`${e}=${n}`);else s.push(`${e}=${t}`);return o.search=s.length?`?${s.join("&")}`:"",o.toString()}(s,a,c,i),s}function Ae(e,t){let n=e;for(const[e,r]of t)n=n.split(e).join(r);return n}const qe={type:{name:"Composite",className:"ChatMessageReadReceiptsCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatMessageReadReceipt"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},Ue={type:{name:"Composite",className:"ChatMessageReadReceipt",modelProperties:{senderCommunicationIdentifier:{serializedName:"senderCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},chatMessageId:{serializedName:"chatMessageId",required:!0,type:{name:"String"}},readOn:{serializedName:"readOn",required:!0,type:{name:"DateTime"}}}}},De={type:{name:"Composite",className:"CommunicationIdentifierModel",modelProperties:{rawId:{serializedName:"rawId",type:{name:"String"}},communicationUser:{serializedName:"communicationUser",type:{name:"Composite",className:"CommunicationUserIdentifierModel"}},phoneNumber:{serializedName:"phoneNumber",type:{name:"Composite",className:"PhoneNumberIdentifierModel"}},microsoftTeamsUser:{serializedName:"microsoftTeamsUser",type:{name:"Composite",className:"MicrosoftTeamsUserIdentifierModel"}}}}},je={type:{name:"Composite",className:"CommunicationUserIdentifierModel",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}}}}},Le={type:{name:"Composite",className:"PhoneNumberIdentifierModel",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"String"}}}}},ze={type:{name:"Composite",className:"MicrosoftTeamsUserIdentifierModel",modelProperties:{userId:{serializedName:"userId",required:!0,type:{name:"String"}},isAnonymous:{serializedName:"isAnonymous",type:{name:"Boolean"}},cloud:{serializedName:"cloud",type:{name:"String"}}}}},$e={type:{name:"Composite",className:"CommunicationErrorResponse",modelProperties:{error:{serializedName:"error",type:{name:"Composite",className:"ChatError"}}}}},Be={type:{name:"Composite",className:"ChatError",modelProperties:{code:{serializedName:"code",required:!0,type:{name:"String"}},message:{serializedName:"message",required:!0,type:{name:"String"}},target:{serializedName:"target",readOnly:!0,type:{name:"String"}},details:{serializedName:"details",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}},innerError:{serializedName:"innererror",type:{name:"Composite",className:"ChatError"}}}}},He={type:{name:"Composite",className:"SendReadReceiptRequest",modelProperties:{chatMessageId:{serializedName:"chatMessageId",required:!0,type:{name:"String"}}}}},Fe={type:{name:"Composite",className:"SendChatMessageRequest",modelProperties:{content:{serializedName:"content",required:!0,type:{name:"String"}},senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}},type:{serializedName:"type",type:{name:"Enum",allowedValues:["text","html","topicUpdated","participantAdded","participantRemoved"]}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},Ve={type:{name:"Composite",className:"SendChatMessageResult",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}}}}},Ge={type:{name:"Composite",className:"ChatMessagesCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatMessage"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},Je={type:{name:"Composite",className:"ChatMessage",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},type:{serializedName:"type",required:!0,type:{name:"Enum",allowedValues:["text","html","topicUpdated","participantAdded","participantRemoved"]}},sequenceId:{serializedName:"sequenceId",required:!0,type:{name:"String"}},version:{serializedName:"version",required:!0,type:{name:"String"}},content:{serializedName:"content",type:{name:"Composite",className:"ChatMessageContent"}},senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}},createdOn:{serializedName:"createdOn",required:!0,type:{name:"DateTime"}},senderCommunicationIdentifier:{serializedName:"senderCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},editedOn:{serializedName:"editedOn",type:{name:"DateTime"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},Xe={type:{name:"Composite",className:"ChatMessageContent",modelProperties:{message:{serializedName:"message",type:{name:"String"}},topic:{serializedName:"topic",type:{name:"String"}},participants:{serializedName:"participants",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},initiatorCommunicationIdentifier:{serializedName:"initiatorCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}}}}},Ke={type:{name:"Composite",className:"ChatParticipant",modelProperties:{communicationIdentifier:{serializedName:"communicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},displayName:{serializedName:"displayName",type:{name:"String"}},shareHistoryTime:{serializedName:"shareHistoryTime",type:{name:"DateTime"}}}}},Qe={type:{name:"Composite",className:"UpdateChatMessageRequest",modelProperties:{content:{serializedName:"content",type:{name:"String"}},metadata:{serializedName:"metadata",type:{name:"Dictionary",value:{type:{name:"String"}}}}}}},We={type:{name:"Composite",className:"ChatParticipantsCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},Ye={type:{name:"Composite",className:"AddChatParticipantsRequest",modelProperties:{participants:{serializedName:"participants",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}}}}},Ze={type:{name:"Composite",className:"AddChatParticipantsResult",modelProperties:{invalidParticipants:{serializedName:"invalidParticipants",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}}}}},et={type:{name:"Composite",className:"CreateChatThreadRequest",modelProperties:{topic:{serializedName:"topic",required:!0,type:{name:"String"}},participants:{serializedName:"participants",type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatParticipant"}}}}}}},tt={type:{name:"Composite",className:"CreateChatThreadResult",modelProperties:{chatThread:{serializedName:"chatThread",type:{name:"Composite",className:"ChatThreadProperties"}},invalidParticipants:{serializedName:"invalidParticipants",readOnly:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatError"}}}}}}},nt={type:{name:"Composite",className:"ChatThreadProperties",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},topic:{serializedName:"topic",required:!0,type:{name:"String"}},createdOn:{serializedName:"createdOn",required:!0,type:{name:"DateTime"}},createdByCommunicationIdentifier:{serializedName:"createdByCommunicationIdentifier",type:{name:"Composite",className:"CommunicationIdentifierModel"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}}}}},rt={type:{name:"Composite",className:"ChatThreadsItemCollection",modelProperties:{value:{serializedName:"value",required:!0,type:{name:"Sequence",element:{type:{name:"Composite",className:"ChatThreadItem"}}}},nextLink:{serializedName:"nextLink",readOnly:!0,type:{name:"String"}}}}},ot={type:{name:"Composite",className:"ChatThreadItem",modelProperties:{id:{serializedName:"id",required:!0,type:{name:"String"}},topic:{serializedName:"topic",required:!0,type:{name:"String"}},deletedOn:{serializedName:"deletedOn",type:{name:"DateTime"}},lastMessageReceivedOn:{serializedName:"lastMessageReceivedOn",readOnly:!0,type:{name:"DateTime"}}}}},it={type:{name:"Composite",className:"UpdateChatThreadRequest",modelProperties:{topic:{serializedName:"topic",type:{name:"String"}}}}},st={type:{name:"Composite",className:"SendTypingNotificationRequest",modelProperties:{senderDisplayName:{serializedName:"senderDisplayName",type:{name:"String"}}}}},at={parameterPath:"accept",mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Accept",type:{name:"String"}}},ct={parameterPath:"endpoint",mapper:{serializedName:"endpoint",required:!0,type:{name:"String"}},skipEncoding:!0},ut={parameterPath:"chatThreadId",mapper:{serializedName:"chatThreadId",required:!0,type:{name:"String"}}},lt={parameterPath:["options","maxPageSize"],mapper:{serializedName:"maxPageSize",type:{name:"Number"}}},dt={parameterPath:["options","skip"],mapper:{serializedName:"skip",type:{name:"Number"}}},pt={parameterPath:"apiVersion",mapper:{defaultValue:"2021-09-07",isConstant:!0,serializedName:"api-version",type:{name:"String"}}},ht={parameterPath:["options","contentType"],mapper:{defaultValue:"application/json",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},ft={parameterPath:"sendReadReceiptRequest",mapper:He},mt={parameterPath:"sendChatMessageRequest",mapper:Fe},gt={parameterPath:["options","startTime"],mapper:{serializedName:"startTime",type:{name:"DateTime"}}},yt={parameterPath:"chatMessageId",mapper:{serializedName:"chatMessageId",required:!0,type:{name:"String"}}},vt={parameterPath:["options","contentType"],mapper:{defaultValue:"application/merge-patch+json",isConstant:!0,serializedName:"Content-Type",type:{name:"String"}}},bt={parameterPath:"updateChatMessageRequest",mapper:Qe},Tt={parameterPath:"participantCommunicationIdentifier",mapper:De},wt={parameterPath:"addChatParticipantsRequest",mapper:Ye},Rt={parameterPath:"updateChatThreadRequest",mapper:it},Ct={parameterPath:["options","sendTypingNotificationRequest"],mapper:st},St={parameterPath:"nextLink",mapper:{serializedName:"nextLink",required:!0,type:{name:"String"}},skipEncoding:!0},kt={parameterPath:"createChatThreadRequest",mapper:et};class Et{constructor(e){this.client=e}listChatReadReceipts(e,t){return this.client.sendOperationRequest({chatThreadId:e,options:t},Pt)}sendChatReadReceipt(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,sendReadReceiptRequest:t,options:n},It)}sendChatMessage(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,sendChatMessageRequest:t,options:n},xt)}listChatMessages(e,t){return this.client.sendOperationRequest({chatThreadId:e,options:t},Mt)}getChatMessage(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,options:n},Nt)}updateChatMessage(e,t,n,r){return this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,updateChatMessageRequest:n,options:r},_t)}deleteChatMessage(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,chatMessageId:t,options:n},At)}listChatParticipants(e,t){return this.client.sendOperationRequest({chatThreadId:e,options:t},qt)}removeChatParticipant(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,participantCommunicationIdentifier:t,options:n},Ut)}addChatParticipants(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,addChatParticipantsRequest:t,options:n},Dt)}updateChatThreadProperties(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,updateChatThreadRequest:t,options:n},jt)}getChatThreadProperties(e,t){return this.client.sendOperationRequest({chatThreadId:e,options:t},Lt)}sendTypingNotification(e,t){return this.client.sendOperationRequest({chatThreadId:e,options:t},zt)}listChatReadReceiptsNext(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},$t)}listChatMessagesNext(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},Bt)}listChatParticipantsNext(e,t,n){return this.client.sendOperationRequest({chatThreadId:e,nextLink:t,options:n},Ht)}}const Ot=L(e,!1),Pt={path:"/chat/threads/{chatThreadId}/readReceipts",httpMethod:"GET",responses:{200:{bodyMapper:qe},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},queryParameters:[lt,dt,pt],urlParameters:[ct,ut],headerParameters:[at],serializer:Ot},It={path:"/chat/threads/{chatThreadId}/readReceipts",httpMethod:"POST",responses:{200:{},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},requestBody:ft,queryParameters:[pt],urlParameters:[ct,ut],headerParameters:[at,ht],mediaType:"json",serializer:Ot},xt={path:"/chat/threads/{chatThreadId}/messages",httpMethod:"POST",responses:{201:{bodyMapper:Ve},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},requestBody:mt,queryParameters:[pt],urlParameters:[ct,ut],headerParameters:[at,ht],mediaType:"json",serializer:Ot},Mt={path:"/chat/threads/{chatThreadId}/messages",httpMethod:"GET",responses:{200:{bodyMapper:Ge},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},queryParameters:[lt,pt,gt],urlParameters:[ct,ut],headerParameters:[at],serializer:Ot},Nt={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"GET",responses:{200:{bodyMapper:Je},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},queryParameters:[pt],urlParameters:[ct,ut,yt],headerParameters:[at],serializer:Ot},_t={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"PATCH",responses:{204:{},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},requestBody:bt,queryParameters:[pt],urlParameters:[ct,ut,yt],headerParameters:[at,vt],mediaType:"json",serializer:Ot},At={path:"/chat/threads/{chatThreadId}/messages/{chatMessageId}",httpMethod:"DELETE",responses:{204:{},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},queryParameters:[pt],urlParameters:[ct,ut,yt],headerParameters:[at],serializer:Ot},qt={path:"/chat/threads/{chatThreadId}/participants",httpMethod:"GET",responses:{200:{bodyMapper:We},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},queryParameters:[lt,dt,pt],urlParameters:[ct,ut],headerParameters:[at],serializer:Ot},Ut={path:"/chat/threads/{chatThreadId}/participants/:remove",httpMethod:"POST",responses:{204:{},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},requestBody:Tt,queryParameters:[pt],urlParameters:[ct,ut],headerParameters:[at,ht],mediaType:"json",serializer:Ot},Dt={path:"/chat/threads/{chatThreadId}/participants/:add",httpMethod:"POST",responses:{201:{bodyMapper:Ze},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},requestBody:wt,queryParameters:[pt],urlParameters:[ct,ut],headerParameters:[at,ht],mediaType:"json",serializer:Ot},jt={path:"/chat/threads/{chatThreadId}",httpMethod:"PATCH",responses:{204:{},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},requestBody:Rt,queryParameters:[pt],urlParameters:[ct,ut],headerParameters:[at,vt],mediaType:"json",serializer:Ot},Lt={path:"/chat/threads/{chatThreadId}",httpMethod:"GET",responses:{200:{bodyMapper:nt},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},queryParameters:[pt],urlParameters:[ct,ut],headerParameters:[at],serializer:Ot},zt={path:"/chat/threads/{chatThreadId}/typing",httpMethod:"POST",responses:{200:{},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},requestBody:Ct,queryParameters:[pt],urlParameters:[ct,ut],headerParameters:[at,ht],mediaType:"json",serializer:Ot},$t={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:qe},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},queryParameters:[lt,dt,pt],urlParameters:[ct,ut,St],headerParameters:[at],serializer:Ot},Bt={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:Ge},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},queryParameters:[lt,pt,gt],urlParameters:[ct,ut,St],headerParameters:[at],serializer:Ot},Ht={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:We},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},queryParameters:[lt,dt,pt],urlParameters:[ct,ut,St],headerParameters:[at],serializer:Ot};class Ft{constructor(e){this.client=e}createChatThread(e,t){return this.client.sendOperationRequest({createChatThreadRequest:e,options:t},Gt)}listChatThreads(e){return this.client.sendOperationRequest({options:e},Jt)}deleteChatThread(e,t){return this.client.sendOperationRequest({chatThreadId:e,options:t},Xt)}listChatThreadsNext(e,t){return this.client.sendOperationRequest({nextLink:e,options:t},Kt)}}const Vt=L(e,!1),Gt={path:"/chat/threads",httpMethod:"POST",responses:{201:{bodyMapper:tt},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},requestBody:kt,queryParameters:[pt],urlParameters:[ct],headerParameters:[at,ht,{parameterPath:["options","repeatabilityRequestId"],mapper:{serializedName:"repeatability-request-id",type:{name:"String"}}}],mediaType:"json",serializer:Vt},Jt={path:"/chat/threads",httpMethod:"GET",responses:{200:{bodyMapper:rt},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},queryParameters:[lt,pt,gt],urlParameters:[ct],headerParameters:[at],serializer:Vt},Xt={path:"/chat/threads/{chatThreadId}",httpMethod:"DELETE",responses:{204:{},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},queryParameters:[pt],urlParameters:[ct,ut],headerParameters:[at],serializer:Vt},Kt={path:"{nextLink}",httpMethod:"GET",responses:{200:{bodyMapper:rt},401:{bodyMapper:$e,isError:!0},403:{bodyMapper:$e,isError:!0},429:{bodyMapper:$e,isError:!0},503:{bodyMapper:$e,isError:!0}},queryParameters:[lt,pt,gt],urlParameters:[ct,St],headerParameters:[at],serializer:Vt};class Qt extends class{constructor(e={}){var t;if(this._requestContentType=e.requestContentType,this._baseUri=e.baseUri,this._allowInsecureConnection=e.allowInsecureConnection,this._httpClient=e.httpClient||(Me||(Me=new Ie),Me),this.pipeline=e.pipeline||function(e){const t=function(e){if(e.credentialScopes){const t=e.credentialScopes;return Array.isArray(t)?t.map((e=>new URL(e).toString())):new URL(t).toString()}if(e.baseUri)return`${e.baseUri}/.default`;if(e.credential&&!e.credentialScopes)throw new Error("When using credentials, the ServiceClientOptions must contain either a baseUri or a credentialScopes. Unable to create a bearerTokenAuthenticationPolicy")}(e),n=e.credential&&t?{credentialScopes:t,credential:e.credential}:void 0;return function(e={}){const t=Ce(null!=e?e:{});return e.credentialOptions&&t.addPolicy(Ee({credential:e.credentialOptions.credential,scopes:e.credentialOptions.credentialScopes})),t.addPolicy(function(e={}){const t=e.stringifyXML;return{name:"serializationPolicy",async sendRequest(e,n){const r=Z(e),o=null==r?void 0:r.operationSpec,i=null==r?void 0:r.operationArguments;return o&&i&&(function(e,t,n){var r,o;if(n.headerParameters)for(const r of n.headerParameters){let o=Q(t,r);if(null!=o||r.mapper.required){o=n.serializer.serialize(r.mapper,o,Oe(r));const t=r.mapper.headerCollectionPrefix;if(t)for(const n of Object.keys(o))e.headers.set(t+n,o[n]);else e.headers.set(r.mapper.serializedName||Oe(r),o)}}const i=null===(o=null===(r=t.options)||void 0===r?void 0:r.requestOptions)||void 0===o?void 0:o.customHeaders;if(i)for(const t of Object.keys(i))e.headers.set(t,i[t])}(e,i,o),function(e,t,n,r=function(){throw new Error("XML serialization unsupported!")}){var o,i,s,a,c;const u=null===(o=t.options)||void 0===o?void 0:o.serializerOptions,l={xml:{rootName:null!==(i=null==u?void 0:u.xml.rootName)&&void 0!==i?i:"",includeRoot:null!==(s=null==u?void 0:u.xml.includeRoot)&&void 0!==s&&s,xmlCharKey:null!==(a=null==u?void 0:u.xml.xmlCharKey)&&void 0!==a?a:b}},d=l.xml.xmlCharKey;if(n.requestBody&&n.requestBody.mapper){e.body=Q(t,n.requestBody);const o=n.requestBody.mapper,{required:i,serializedName:s,xmlName:a,xmlElementName:u,xmlNamespace:p,xmlNamespacePrefix:h,nullable:f}=o,m=o.type.name;try{if(void 0!==e.body&&null!==e.body||f&&null===e.body||i){const t=Oe(n.requestBody);e.body=n.serializer.serialize(o,e.body,t,l);const i=m===K;if(n.isXML){const t=h?`xmlns:${h}`:"xmlns",n=function(e,t,n,r,o){if(e&&!["Composite","Sequence","Dictionary"].includes(n)){const n={};return n[o.xml.xmlCharKey]=r,n[v]={[t]:e},n}return r}(p,t,m,e.body,l);m===X?e.body=r(function(e,t,n,r){if(Array.isArray(e)||(e=[e]),!n||!r)return{[t]:e};const o={[t]:e};return o[v]={[n]:r},o}(n,u||a||s,t,p),{rootName:a||s,xmlCharKey:d}):i||(e.body=r(n,{rootName:a||s,xmlCharKey:d}))}else{if("String"===m&&((null===(c=n.contentType)||void 0===c?void 0:c.match("text/plain"))||"text"===n.mediaType))return;i||(e.body=JSON.stringify(e.body))}}}catch(e){throw new Error(`Error "${e.message}" occurred in serializing the payload - ${JSON.stringify(s,void 0,"  ")}.`)}}else if(n.formDataParameters&&n.formDataParameters.length>0){e.formData={};for(const r of n.formDataParameters){const o=Q(t,r);if(null!=o){const t=r.mapper.serializedName||Oe(r);e.formData[t]=n.serializer.serialize(r.mapper,o,Oe(r),l)}}}}(e,i,o,t)),n(e)}}}(e.serializationOptions),{phase:"Serialize"}),t.addPolicy(function(e={}){var t,n,r,o,i,s,a;const c=null!==(n=null===(t=e.expectedContentTypes)||void 0===t?void 0:t.json)&&void 0!==n?n:ee,u=null!==(o=null===(r=e.expectedContentTypes)||void 0===r?void 0:r.xml)&&void 0!==o?o:te,l=e.parseXML,d=e.serializerOptions,p={xml:{rootName:null!==(i=null==d?void 0:d.xml.rootName)&&void 0!==i?i:"",includeRoot:null!==(s=null==d?void 0:d.xml.includeRoot)&&void 0!==s&&s,xmlCharKey:null!==(a=null==d?void 0:d.xml.xmlCharKey)&&void 0!==a?a:b}};return{name:"deserializationPolicy",async sendRequest(e,t){const n=await t(e);return async function(e,t,n,r,o){const i=await async function(e,t,n,r,o){var i;if(!(null===(i=n.request.streamResponseStatusCodes)||void 0===i?void 0:i.has(n.status))&&n.bodyAsText){const i=n.bodyAsText,s=n.headers.get("Content-Type")||"",a=s?s.split(";").map((e=>e.toLowerCase())):[];try{if(0===a.length||a.some((t=>-1!==e.indexOf(t))))return n.parsedBody=JSON.parse(i),n;if(a.some((e=>-1!==t.indexOf(e)))){if(!o)throw new Error("Parsing XML not supported.");const e=await o(i,r.xml);return n.parsedBody=e,n}}catch(e){const t=`Error "${e}" occurred while parsing the response body - ${n.bodyAsText}.`,r=e.code||N.PARSE_ERROR;throw new N(t,{code:r,statusCode:n.status,request:n.request,response:n})}}return n}(e,t,n,r,o);if(!function(e){const t=Z(e.request),n=null==t?void 0:t.shouldDeserialize;let r;return r=void 0===n||("boolean"==typeof n?n:n(e)),r}(i))return i;const s=Z(i.request),a=null==s?void 0:s.operationSpec;if(!a||!a.responses)return i;const c=function(e){let t;const n=Z(e.request),r=null==n?void 0:n.operationSpec;return r&&(t=(null==n?void 0:n.operationResponseGetter)?null==n?void 0:n.operationResponseGetter(r,e):r.responses[e.status]),t}(i),{error:u,shouldReturnResponse:l}=function(e,t,n){var r;const o=200<=e.status&&e.status<300;if(function(e){const t=Object.keys(e.responses);return 0===t.length||1===t.length&&"default"===t[0]}(t)?o:n){if(!n)return{error:null,shouldReturnResponse:!1};if(!n.isError)return{error:null,shouldReturnResponse:!1}}const i=null!=n?n:t.responses.default,s=(null===(r=e.request.streamResponseStatusCodes)||void 0===r?void 0:r.has(e.status))?`Unexpected status code: ${e.status}`:e.bodyAsText,a=new N(s,{statusCode:e.status,request:e.request,response:e});if(!i)throw a;const c=i.bodyMapper,u=i.headersMapper;try{if(e.parsedBody){const n=e.parsedBody;let r;if(c){let e=n;if(t.isXML&&c.type.name===X){e=[];const t=c.xmlElementName;"object"==typeof n&&t&&(e=n[t])}r=t.serializer.deserialize(c,e,"error.response.parsedBody")}const o=n.error||r||n;a.code=o.code,o.message&&(a.message=o.message),c&&(a.response.parsedBody=r)}e.headers&&u&&(a.response.parsedHeaders=t.serializer.deserialize(u,e.headers.toJSON(),"operationRes.parsedHeaders"))}catch(t){a.message=`Error "${t.message}" occurred in deserializing the responseBody - "${e.bodyAsText}" for the default response.`}return{error:a,shouldReturnResponse:!1}}(i,a,c);if(u)throw u;if(l)return i;if(c){if(c.bodyMapper){let e=i.parsedBody;a.isXML&&c.bodyMapper.type.name===X&&(e="object"==typeof e?e[c.bodyMapper.xmlElementName]:[]);try{i.parsedBody=a.serializer.deserialize(c.bodyMapper,e,"operationRes.parsedBody")}catch(e){throw new N(`Error ${e} occurred in deserializing the responseBody - ${i.bodyAsText}`,{statusCode:i.status,request:i.request,response:i})}}else"HEAD"===a.httpMethod&&(i.parsedBody=n.status>=200&&n.status<300);c.headersMapper&&(i.parsedHeaders=a.serializer.deserialize(c.headersMapper,i.headers.toJSON(),"operationRes.parsedHeaders"))}return i}(c,u,n,p,l)}}}(e.deserializationOptions),{phase:"Deserialize"}),t}(Object.assign(Object.assign({},e),{credentialOptions:n}))}(e),null===(t=e.additionalPolicies)||void 0===t?void 0:t.length)for(const{policy:t,position:n}of e.additionalPolicies){const e="perRetry"===n?"Sign":void 0;this.pipeline.addPolicy(t,{afterPhase:e})}}async sendRequest(e){return this.pipeline.sendRequest(this._httpClient,e)}async sendOperationRequest(e,t){const n=t.baseUrl||this._baseUri;if(!n)throw new Error("If operationSpec.baseUrl is not specified, then the ServiceClient must have a baseUri string property that contains the base URL to use.");const r=function(e){return new y(e)}({url:_e(n,t,e,this)});r.method=t.httpMethod;const o=Z(r);o.operationSpec=t,o.operationArguments=e;const i=t.contentType||this._requestContentType;i&&t.requestBody&&r.headers.set("Content-Type",i);const s=e.options;if(s){const e=s.requestOptions;e&&(e.timeout&&(r.timeout=e.timeout),e.onUploadProgress&&(r.onUploadProgress=e.onUploadProgress),e.onDownloadProgress&&(r.onDownloadProgress=e.onDownloadProgress),void 0!==e.shouldDeserialize&&(o.shouldDeserialize=e.shouldDeserialize),e.allowInsecureConnection&&(r.allowInsecureConnection=!0)),s.abortSignal&&(r.abortSignal=s.abortSignal),s.tracingOptions&&(r.tracingOptions=s.tracingOptions)}this._allowInsecureConnection&&(r.allowInsecureConnection=!0),void 0===r.streamResponseStatusCodes&&(r.streamResponseStatusCodes=function(e){const t=new Set;for(const n in e.responses){const r=e.responses[n];r.bodyMapper&&r.bodyMapper.type.name===K&&t.add(Number(n))}return t}(t));try{const e=await this.sendRequest(r),n=D(e,t.responses[e.status]);return(null==s?void 0:s.onResponse)&&s.onResponse(e,n),n}catch(e){if("object"==typeof e&&(null==e?void 0:e.response)){const n=e.response,r=D(n,t.responses[e.statusCode]||t.responses.default);e.details=r,(null==s?void 0:s.onResponse)&&s.onResponse(n,r,e)}throw e}}}{constructor(e,t){var n,r;if(void 0===e)throw new Error("'endpoint' cannot be null");t||(t={});const o="azsdk-js-communication-chat/1.2.0",i=t.userAgentOptions&&t.userAgentOptions.userAgentPrefix?`${t.userAgentOptions.userAgentPrefix} ${o}`:`${o}`;super(Object.assign(Object.assign(Object.assign({},{requestContentType:"application/json; charset=utf-8"}),t),{userAgentOptions:{userAgentPrefix:i},baseUri:null!==(r=null!==(n=t.endpoint)&&void 0!==n?n:t.baseUri)&&void 0!==r?r:"{endpoint}"})),this.endpoint=e,this.apiVersion=t.apiVersion||"2021-09-07",this.chatThread=new Et(this),this.chat=new Ft(this)}}const Wt=(0,ie.YR)("communication-chat"),Yt=(0,de.q)({packagePrefix:"Azure.Communication",namespace:"Microsoft.Communication"}),Zt=e=>Ee({credential:{getToken:(t,n)=>e.getToken({abortSignal:null==n?void 0:n.abortSignal})},scopes:[]});class en{constructor(e,t,n,r={}){this.endpoint=e,this.timeOfLastTypingRequest=void 0,this.threadId=t,this.tokenCredential=n;const o=Object.assign(Object.assign({},r),{loggingOptions:{logger:Wt.info}});this.client=new Qt(this.endpoint,Object.assign({endpoint:this.endpoint},o));const i=Zt(this.tokenCredential);this.client.pipeline.addPolicy(i)}async getProperties(e={}){const{span:t,updatedOptions:n}=Yt("ChatClient-GetProperties",e);try{const e=await this.client.chatThread.getChatThreadProperties(this.threadId,n);return d(e)}catch(e){throw t.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{t.end()}}async updateTopic(e,t={}){const{span:n,updatedOptions:r}=Yt("ChatThreadClient-UpdateTopic",t);try{await this.client.chatThread.updateChatThreadProperties(this.threadId,{topic:e},r)}catch(e){throw n.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{n.end()}}async sendMessage(e,t={}){const{span:n,updatedOptions:r}=Yt("ChatThreadClient-SendMessage",t);try{return this.timeOfLastTypingRequest=void 0,await this.client.chatThread.sendChatMessage(this.threadId,Object.assign(Object.assign({},e),t),r)}catch(e){throw n.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{n.end()}}async getMessage(e,t={}){const{span:n,updatedOptions:r}=Yt("ChatThreadClient-GetMessage",t);try{const t=await this.client.chatThread.getChatMessage(this.threadId,e,r);return l(t)}catch(e){throw n.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{n.end()}}listMessagesPage(e,n={}){return(0,t.FC)(this,arguments,(function*(){if(!e.continuationToken){const r=yield(0,t.qq)(this.client.chatThread.listChatMessages(this.threadId,n));e.continuationToken=r.nextLink,r.value&&(yield yield(0,t.qq)(r.value.map(l,this)))}for(;e.continuationToken;){const r=yield(0,t.qq)(this.client.chatThread.listChatMessagesNext(this.threadId,e.continuationToken,n));if(e.continuationToken=r.nextLink,!r.value)break;yield yield(0,t.qq)(r.value.map(l,this))}}))}listMessagesAll(e){return(0,t.FC)(this,arguments,(function*(){var n,r;try{for(var o,i=(0,t.KL)(this.listMessagesPage({},e));!(o=yield(0,t.qq)(i.next())).done;){const e=o.value;yield(0,t.qq)(yield*(0,t.V2)((0,t.KL)(e)))}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&(yield(0,t.qq)(r.call(i)))}finally{if(n)throw n.error}}}))}listMessages(e={}){const{span:t,updatedOptions:n}=Yt("ChatThreadClient-ListMessages",e);try{const e=this.listMessagesAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listMessagesPage(e,n)}}catch(e){throw t.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{t.end()}}async deleteMessage(e,t={}){const{span:n,updatedOptions:r}=Yt("ChatThreadClient-DeleteMessage",t);try{await this.client.chatThread.deleteChatMessage(this.threadId,e,r)}catch(e){throw n.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{n.end()}}async updateMessage(e,t={}){const{span:n,updatedOptions:r}=Yt("ChatThreadClient-UpdateMessage",t);try{await this.client.chatThread.updateChatMessage(this.threadId,e,t,r)}catch(e){throw n.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{n.end()}}async addParticipants(e,t={}){const{span:n,updatedOptions:r}=Yt("ChatThreadClient-AddParticipants",t);try{const t=await this.client.chatThread.addChatParticipants(this.threadId,(e=>{var t;return{participants:null===(t=e.participants)||void 0===t?void 0:t.map((e=>a(e)))}})(e),r);return t}catch(e){throw n.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{n.end()}}listParticipantsPage(e,n={}){return(0,t.FC)(this,arguments,(function*(){if(!e.continuationToken){const r=yield(0,t.qq)(this.client.chatThread.listChatParticipants(this.threadId,n));e.continuationToken=r.nextLink,r.value&&(yield yield(0,t.qq)(r.value.map(c,this)))}for(;e.continuationToken;){const r=yield(0,t.qq)(this.client.chatThread.listChatParticipantsNext(this.threadId,e.continuationToken,n));if(e.continuationToken=r.nextLink,!r.value)break;yield yield(0,t.qq)(r.value.map(c,this))}}))}listParticipantsAll(e){return(0,t.FC)(this,arguments,(function*(){var n,r;try{for(var o,i=(0,t.KL)(this.listParticipantsPage({},e));!(o=yield(0,t.qq)(i.next())).done;){const e=o.value;yield(0,t.qq)(yield*(0,t.V2)((0,t.KL)(e)))}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&(yield(0,t.qq)(r.call(i)))}finally{if(n)throw n.error}}}))}listParticipants(e={}){const{span:t,updatedOptions:n}=Yt("ChatThreadClient-ListParticipants",e);try{const e=this.listParticipantsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listParticipantsPage(e,n)}}catch(e){throw t.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{t.end()}}async removeParticipant(e,t={}){const{span:n,updatedOptions:r}=Yt("ChatThreadClient-RemoveParticipant",t);try{await this.client.chatThread.removeChatParticipant(this.threadId,i(e),r)}catch(e){throw n.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{n.end()}}async sendTypingNotification(e={}){const{span:n,updatedOptions:r}=Yt("ChatThreadClient-SendTypingNotification",e);try{const e=new Date,{senderDisplayName:o}=r,i=(0,t._T)(r,["senderDisplayName"]);return this.canPostTypingNotification(e)?(this.timeOfLastTypingRequest=e,await this.client.chatThread.sendTypingNotification(this.threadId,Object.assign({sendTypingNotificationRequest:{senderDisplayName:o}},i)),!0):(Wt.info(`Typing Notification NOT Send. [thread_id=${this.threadId}]`),!1)}catch(e){throw n.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{n.end()}}async sendReadReceipt(e,t={}){const{span:n,updatedOptions:r}=Yt("ChatThreadClient-SendReadReceipt",t);try{await this.client.chatThread.sendChatReadReceipt(this.threadId,e,r)}catch(e){throw n.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{n.end()}}listReadReceiptsPage(e,n={}){return(0,t.FC)(this,arguments,(function*(){if(!e.continuationToken){const r=yield(0,t.qq)(this.client.chatThread.listChatReadReceipts(this.threadId,n));e.continuationToken=r.nextLink,r.value&&(yield yield(0,t.qq)(r.value.map(p,this)))}for(;e.continuationToken;){const r=yield(0,t.qq)(this.client.chatThread.listChatReadReceiptsNext(this.threadId,e.continuationToken,n));if(e.continuationToken=r.nextLink,!r.value)break;yield yield(0,t.qq)(r.value.map(p,this))}}))}listReadReceiptsAll(e){return(0,t.FC)(this,arguments,(function*(){var n,r;try{for(var o,i=(0,t.KL)(this.listReadReceiptsPage({},e));!(o=yield(0,t.qq)(i.next())).done;){const e=o.value;yield(0,t.qq)(yield*(0,t.V2)((0,t.KL)(e)))}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&(yield(0,t.qq)(r.call(i)))}finally{if(n)throw n.error}}}))}listReadReceipts(e={}){const{span:t,updatedOptions:n}=Yt("ChatThreadClient-ListChatReadReceipts",e);try{const e=this.listReadReceiptsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listReadReceiptsPage(e,n)}}catch(e){throw t.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{t.end()}}canPostTypingNotification(e){return!(this.timeOfLastTypingRequest&&e.getTime()-this.timeOfLastTypingRequest.getTime()<8e3)||(Wt.info(`Typing interval check failed. [last_request=${this.timeOfLastTypingRequest}]`),!1)}}var tn=n(187),nn=n(181);function rn(e){this.message=e}rn.prototype=new Error,rn.prototype.name="InvalidCharacterError";var on="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new rn("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,o=0,i=0,s="";r=t.charAt(i++);~r&&(n=o%4?64*n+r:r,o++%4)?s+=String.fromCharCode(255&n>>(-2*o&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return s};function sn(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(on(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return on(t)}}function an(e){this.message=e}an.prototype=new Error,an.prototype.name="InvalidTokenError";const cn=e=>{const{exp:t}=function(e,t){if("string"!=typeof e)throw new an("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(sn(e.split(".")[n]))}catch(e){throw new an("Invalid token specified: "+e.message)}}(e);return{token:e,expiresOnTimestamp:1e3*t}},un={token:"",expiresOnTimestamp:-10};class ln{constructor(e){this.expiringSoonIntervalInMs=6e5,this.refreshAfterLifetimePercentage=.5,this.activeTokenFetching=null,this.activeTokenUpdating=null,this.disposed=!1;const{tokenRefresher:t,token:n,refreshProactively:r}=e;this.refresh=t,this.currentToken=n?cn(n):un,this.refreshProactively=null!=r&&r,this.refreshProactively&&this.scheduleRefresh()}async getToken(e){if(!this.isTokenExpiringSoon(this.currentToken))return this.currentToken;if(!this.isTokenValid(this.currentToken)){const t=this.updateTokenAndReschedule(null==e?void 0:e.abortSignal);await t}return this.currentToken}dispose(){this.disposed=!0,this.activeTokenFetching=null,this.activeTokenUpdating=null,this.currentToken=un,this.activeTimeout&&clearTimeout(this.activeTimeout)}async updateTokenAndReschedule(e){if(this.activeTokenUpdating)return this.activeTokenUpdating;this.activeTokenUpdating=this.refreshTokenAndReschedule(e);try{await this.activeTokenUpdating}finally{this.activeTokenUpdating=null}}async refreshTokenAndReschedule(e){const t=await this.refreshToken(e);if(!this.isTokenValid(t))throw new Error("The token returned from the tokenRefresher is expired.");this.currentToken=t,this.refreshProactively&&this.scheduleRefresh()}async refreshToken(e){try{return this.activeTokenFetching||(this.activeTokenFetching=this.refresh(e)),cn(await this.activeTokenFetching)}finally{this.activeTokenFetching=null}}scheduleRefresh(){if(this.disposed)return;this.activeTimeout&&clearTimeout(this.activeTimeout);const e=this.currentToken.expiresOnTimestamp-Date.now();let t=null;t=this.isTokenExpiringSoon(this.currentToken)?e*this.refreshAfterLifetimePercentage:e-this.expiringSoonIntervalInMs,this.activeTimeout=setTimeout((()=>this.updateTokenAndReschedule()),t)}isTokenValid(e){return e&&Date.now()<e.expiresOnTimestamp}isTokenExpiringSoon(e){return!e||Date.now()>=e.expiresOnTimestamp-this.expiringSoonIntervalInMs}}class dn{constructor(e){this.token=e}async getToken(){return this.token}dispose(){}}const pn=document.getElementById("accessToken").value,hn=(document.getElementById("communicationUserId").value,document.getElementById("communicationUserName").value,document.getElementById("threadId").value),fn=document.getElementById("intConversationUserID").value,mn=document.getElementById("accessexpiry").value,gn=document.getElementById("conversations"),yn=document.getElementById("btnSendMessage");let vn;const bn=new class{constructor(e,t,n={}){this.endpoint=e,this.signalingClient=void 0,this.emitter=new tn.EventEmitter,this.isRealtimeNotificationsStarted=!1,this.tokenCredential=t,this.clientOptions=Object.assign({},n);const r=Object.assign(Object.assign({},n),{loggingOptions:{logger:Wt.info}});this.client=new Qt(this.endpoint,Object.assign({endpoint:this.endpoint},r));const o=Zt(this.tokenCredential);this.client.pipeline.addPolicy(o),this.signalingClient=((e,t,n)=>{var r;return new nn.CommunicationSignalingClient(e,t,{environment:null!==(r=null==n?void 0:n.environment)&&void 0!==r?r:void 0})})(t,Wt,n.signalingClientOptions)}getChatThreadClient(e){return new en(this.endpoint,e,this.tokenCredential,this.clientOptions)}async createChatThread(e,n={}){var r,o;const{span:i,updatedOptions:s}=Yt("ChatClient-CreateChatThread",n);try{s.idempotencyToken=null!==(r=s.idempotencyToken)&&void 0!==r?r:(0,g.Z)();const c=(e=>{const{participants:n,idempotencyToken:r}=e,o=(0,t._T)(e,["participants","idempotencyToken"]);return Object.assign({repeatabilityRequestId:r},o)})(s);return(e=>{const{chatThread:n}=e,r=(0,t._T)(e,["chatThread"]);return n?Object.assign(Object.assign({},r),{chatThread:d(n)}):Object.assign({},r)})(await this.client.chat.createChatThread({topic:e.topic,participants:null===(o=n.participants)||void 0===o?void 0:o.map((e=>a(e)))},c))}catch(e){throw i.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{i.end()}}listChatThreadsPage(e,n={}){return(0,t.FC)(this,arguments,(function*(){if(!e.continuationToken){const r=yield(0,t.qq)(this.client.chat.listChatThreads(n));e.continuationToken=r.nextLink,r.value&&(yield yield(0,t.qq)(r.value))}for(;e.continuationToken;){const r=yield(0,t.qq)(this.client.chat.listChatThreadsNext(e.continuationToken,n));if(e.continuationToken=r.nextLink,!r.value)break;yield yield(0,t.qq)(r.value)}}))}listChatThreadsAll(e){return(0,t.FC)(this,arguments,(function*(){var n,r;try{for(var o,i=(0,t.KL)(this.listChatThreadsPage({},e));!(o=yield(0,t.qq)(i.next())).done;){const e=o.value;yield(0,t.qq)(yield*(0,t.V2)((0,t.KL)(e)))}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&(yield(0,t.qq)(r.call(i)))}finally{if(n)throw n.error}}}))}listChatThreads(e={}){const{span:t,updatedOptions:n}=Yt("ChatClient-ListChatThreads",e);try{const e=this.listChatThreadsAll(n);return{next:()=>e.next(),[Symbol.asyncIterator](){return this},byPage:(e={})=>this.listChatThreadsPage(e,n)}}catch(e){throw t.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{t.end()}}async deleteChatThread(e,t={}){const{span:n,updatedOptions:r}=Yt("ChatClient-DeleteChatThread",t);try{await this.client.chat.deleteChatThread(e,r)}catch(e){throw n.setStatus({code:he.Qn.ERROR,message:e.message}),e}finally{n.end()}}async startRealtimeNotifications(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are not supported in node js.");this.isRealtimeNotificationsStarted||(this.isRealtimeNotificationsStarted=!0,await this.signalingClient.start(),this.subscribeToSignalingEvents())}async stopRealtimeNotifications(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are not supported in node js.");this.isRealtimeNotificationsStarted=!1,await this.signalingClient.stop(),this.emitter.removeAllListeners()}on(e,t){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");if(!this.isRealtimeNotificationsStarted&&"realTimeNotificationConnected"!==e&&"realTimeNotificationDisconnected"!==e)throw new Error("You must call startRealtimeNotifications before you can subscribe to events.");this.emitter.on(e,t)}off(e,t){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");this.emitter.removeListener(e,t)}subscribeToSignalingEvents(){if(void 0===this.signalingClient)throw new Error("Realtime notifications are only supported in the browser.");this.signalingClient.on("connectionChanged",(e=>{2===e?this.emitter.emit("realTimeNotificationConnected"):3===e&&this.emitter.emit("realTimeNotificationDisconnected")})),this.signalingClient.on("chatMessageReceived",(e=>{this.emitter.emit("chatMessageReceived",e)})),this.signalingClient.on("chatMessageEdited",(e=>{this.emitter.emit("chatMessageEdited",e)})),this.signalingClient.on("chatMessageDeleted",(e=>{this.emitter.emit("chatMessageDeleted",e)})),this.signalingClient.on("typingIndicatorReceived",(e=>{this.emitter.emit("typingIndicatorReceived",e)})),this.signalingClient.on("readReceiptReceived",(e=>{this.emitter.emit("readReceiptReceived",e)})),this.signalingClient.on("chatThreadCreated",(e=>{this.emitter.emit("chatThreadCreated",e)})),this.signalingClient.on("chatThreadDeleted",(e=>{this.emitter.emit("chatThreadDeleted",e)})),this.signalingClient.on("chatThreadPropertiesUpdated",(e=>{this.emitter.emit("chatThreadPropertiesUpdated",e)})),this.signalingClient.on("participantsAdded",(e=>{this.emitter.emit("participantsAdded",e)})),this.signalingClient.on("participantsRemoved",(e=>{this.emitter.emit("participantsRemoved",e)}))}}("https://chatcommunicationservice.communication.azure.com",new class{constructor(e){this.disposed=!1,this.tokenCredential="string"==typeof e?new dn(cn(e)):new ln(e)}async getToken(e){this.throwIfDisposed();const t=await this.tokenCredential.getToken(e);return this.throwIfDisposed(),t}dispose(){this.disposed=!0,this.tokenCredential.dispose()}throwIfDisposed(){if(this.disposed)throw new Error("User credential is disposed")}}(pn));console.log("Azure Communication Chat client created!"),(async()=>{vn=bn.getChatThreadClient(hn),await bn.startRealtimeNotifications(),bn.on("chatMessageReceived",(e=>{if(console.log("NOTIFICATION: Chat Message Received"),e.threadId==hn){const t=gn.value+"\n"+e.senderDisplayName+": "+e.message;gn.textContent=t}}))})(),yn.addEventListener("click",(async()=>{try{await new Promise(((e,t)=>{const n=document.getElementById("messageToSend").value;let r=new XMLHttpRequest;r.open("POST","http://localhost:7071/api/send-group-message"),r.setRequestHeader("Content-type","application/json"),r.setRequestHeader("accesstoken",pn),r.setRequestHeader("accessexpiry",mn),document.getElementById("messageToSend").value="",document.getElementById("messageToSend").setAttribute("readonly","true"),r.onreadystatechange=function(){return 4==r.readyState&&200==r.status?(document.getElementById("messageToSend").removeAttribute("readonly"),void e("Message Sent")):4==r.readyState&&r.status>=400?(document.getElementById("messageToSend").removeAttribute("readonly"),void t("There was a problem sending your message")):void 0},r.send(JSON.stringify({threadId:hn,intConversationUserID:fn,message:n}))}))}catch(e){console.log(e),alert("There was a problem sending your message")}})),document.querySelector("#messageToSend").addEventListener("keypress",(e=>{"Enter"==e.key&&yn.click()}))})()})();
//# sourceMappingURL=chat_bundle.js.map